/**
 * @license RequireJS text 2.0.14 Copyright (c) 2010-2014, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/text for details
 */

!function(window){function Element(){this.initialize=function(){this.elementType="element",this.serializedProperties=["elementType"],this.propertiesStack=[],this._id=""+(new Date).getTime()},this.distroy=function(){},this.removeHandler=function(){},this.attr=function(t,e){if(null!=t&&null!=e)this[t]=e;else if(null!=t)return this[t];return this},this.save=function(){var t=this,e={};this.serializedProperties.forEach(function(n){e[n]=t[n]}),this.propertiesStack.push(e)},this.restore=function(){if(null!=this.propertiesStack&&0!=this.propertiesStack.length){var t=this,e=this.propertiesStack.pop();this.serializedProperties.forEach(function(n){t[n]=e[n]})}},this.toJson=function(){var t=this,e="{",n=this.serializedProperties.length;return this.serializedProperties.forEach(function(i,o){var r=t[i];"string"==typeof r&&(r='"'+r+'"'),e+='"'+i+'":'+r,n>o+1&&(e+=",")}),e+="}"}}CanvasRenderingContext2D.prototype.JTopoRoundRect=function(t,e,n,i,o){"undefined"==typeof o&&(o=5),this.beginPath(),this.moveTo(t+o,e),this.lineTo(t+n-o,e),this.quadraticCurveTo(t+n,e,t+n,e+o),this.lineTo(t+n,e+i-o),this.quadraticCurveTo(t+n,e+i,t+n-o,e+i),this.lineTo(t+o,e+i),this.quadraticCurveTo(t,e+i,t,e+i-o),this.lineTo(t,e+o),this.quadraticCurveTo(t,e,t+o,e),this.closePath()},CanvasRenderingContext2D.prototype.JTopoDashedLineTo=function(t,e,n,i,o){"undefined"==typeof o&&(o=5);var r=n-t,a=i-e,s=Math.floor(Math.sqrt(r*r+a*a)),l=0>=o?s:s/o,c=a/s*o,h=r/s*o;this.beginPath();for(var d=0;l>d;d++)d%2?this.lineTo(t+d*h,e+d*c):this.moveTo(t+d*h,e+d*c);this.stroke()},JTopo={version:"0.4.8_01",zIndex_Container:1,zIndex_Link:2,zIndex_Node:3,SceneMode:{normal:"normal",drag:"drag",edit:"edit",select:"select"},MouseCursor:{normal:"default",pointer:"pointer",top_left:"nw-resize",top_center:"n-resize",top_right:"ne-resize",middle_left:"e-resize",middle_right:"e-resize",bottom_left:"ne-resize",bottom_center:"n-resize",bottom_right:"nw-resize",move:"move",open_hand:"url(./img/cur/openhand.cur) 8 8, default",closed_hand:"url(./img/cur/closedhand.cur) 8 8, default"},createStageFromJson:function(jsonStr,canvas){eval("var jsonObj = "+jsonStr);var stage=new JTopo.Stage(canvas);for(var k in jsonObj)"childs"!=k&&(stage[k]=jsonObj[k]);var scenes=jsonObj.childs;return scenes.forEach(function(t){var e=new JTopo.Scene(stage);for(var n in t)"childs"!=n&&(e[n]=t[n]),"background"==n&&(e.background=t[n]);var i=t.childs;i.forEach(function(t){var n=null,i=t.elementType;"node"==i?n=new JTopo.Node:"CircleNode"==i&&(n=new JTopo.CircleNode);for(var o in t)n[o]=t[o];e.add(n)})}),stage}},JTopo.Element=Element,window.JTopo=JTopo}(window),function(JTopo){function MessageBus(t){var e=this;this.name=t,this.messageMap={},this.messageCount=0,this.subscribe=function(t,n){var i=e.messageMap[t];null==i&&(e.messageMap[t]=[]),e.messageMap[t].push(n),e.messageCount++},this.unsubscribe=function(t){var n=e.messageMap[t];null!=n&&(e.messageMap[t]=null,delete e.messageMap[t],e.messageCount--)},this.publish=function(t,n,i){var o=e.messageMap[t];if(null!=o)for(var r=0;r<o.length;r++)i?!function(t,e){setTimeout(function(){t(e)},10)}(o[r],n):o[r](n)}}function getDistance(t,e,n,i){var o,r;return null==n&&null==i?(o=e.x-t.x,r=e.y-t.y):(o=n-t,r=i-e),Math.sqrt(o*o+r*r)}function getElementsBound(t){for(var e={left:Number.MAX_VALUE,right:Number.MIN_VALUE,top:Number.MAX_VALUE,bottom:Number.MIN_VALUE},n=0;n<t.length;n++){var i=t[n];i instanceof JTopo.Link||(e.left>i.x&&(e.left=i.x,e.leftNode=i),e.right<i.x+i.width&&(e.right=i.x+i.width,e.rightNode=i),e.top>i.y&&(e.top=i.y,e.topNode=i),e.bottom<i.y+i.height&&(e.bottom=i.y+i.height,e.bottomNode=i))}return e.width=e.right-e.left,e.height=e.bottom-e.top,e}function mouseCoords(t){return t=cloneEvent(t),t.pageX||(t.pageX=t.clientX+document.body.scrollLeft-document.body.clientLeft,t.pageY=t.clientY+document.body.scrollTop-document.body.clientTop),t}function getEventPosition(t){return t=mouseCoords(t)}function rotatePoint(t,e,n,i,o){var r=n-t,a=i-e,s=Math.sqrt(r*r+a*a),l=Math.atan2(a,r)+o;return{x:t+Math.cos(l)*s,y:e+Math.sin(l)*s}}function rotatePoints(t,e,n){for(var i=[],o=0;o<e.length;o++){var r=rotatePoint(t.x,t.y,e[o].x,e[o].y,n);i.push(r)}return i}function $foreach(t,e,n){function i(o){o!=t.length&&(e(t[o]),setTimeout(function(){i(++o)},n))}if(0!=t.length){var o=0;i(o)}}function $for(t,e,n,i){function o(t){t!=e&&(n(e),setTimeout(function(){o(++t)},i))}if(!(t>e)){var r=0;o(r)}}function cloneEvent(t){var e={};for(var n in t)"returnValue"!=n&&"keyLocation"!=n&&(e[n]=t[n]);return e}function clone(t){var e={};for(var n in t)e[n]=t[n];return e}function isPointInRect(t,e){var n=e.x,i=e.y,o=e.width,r=e.height;return t.x>n&&t.x<n+o&&t.y>i&&t.y<i+r}function isPointInLine(t,e,n){var i=JTopo.util.getDistance(e,n),o=JTopo.util.getDistance(e,t),r=JTopo.util.getDistance(n,t),a=Math.abs(o+r-i)<=.5;return a}function removeFromArray(t,e){for(var n=0;n<t.length;n++){var i=t[n];if(i===e){t=t.del(n);break}}return t}function randomColor(){return Math.floor(255*Math.random())+","+Math.floor(255*Math.random())+","+Math.floor(255*Math.random())}function isIntsect(){}function getProperties(t,e){for(var n="",i=0;i<e.length;i++){i>0&&(n+=",");var o=t[e[i]];"string"==typeof o?o='"'+o+'"':void 0==o&&(o=null),n+=e[i]+":"+o}return n}function loadStageFromJson(json,canvas){var obj=eval(json),stage=new JTopo.Stage(canvas);for(var k in stageObj)if("scenes"!=k)stage[k]=obj[k];else for(var scenes=obj.scenes,i=0;i<scenes.length;i++){var sceneObj=scenes[i],scene=new JTopo.Scene(stage);for(var p in sceneObj)if("elements"!=p)scene[p]=sceneObj[p];else for(var nodeMap={},elements=sceneObj.elements,m=0;m<elements.length;m++){var elementObj=elements[m],type=elementObj.elementType,element;"Node"==type&&(element=new JTopo.Node);for(var mk in elementObj)element[mk]=elementObj[mk];nodeMap[element.text]=element,scene.add(element)}}return console.log(stage),stage}function toJson(t){var e="backgroundColor,visible,mode,rotate,alpha,scaleX,scaleY,shadow,translateX,translateY,areaSelect,paintAll".split(","),n="text,elementType,x,y,width,height,visible,alpha,rotate,scaleX,scaleY,fillColor,shadow,transformAble,zIndex,dragable,selected,showSelected,font,fontColor,textPosition,textOffsetX,textOffsetY".split(","),i="{";i+="frames:"+t.frames,i+=", scenes:[";for(var o=0;o<t.childs.length;o++){var r=t.childs[o];i+="{",i+=getProperties(r,e),i+=", elements:[";for(var a=0;a<r.childs.length;a++){var s=r.childs[a];a>0&&(i+=","),i+="{",i+=getProperties(s,n),i+="}"}i+="]}"}return i+="]",i+="}"}function changeColor(t,e,n){var i=n.split(","),o=parseInt(i[0]),r=parseInt(i[1]),a=parseInt(i[2]),s=canvas.width=e.width,l=canvas.height=e.height;t.clearRect(0,0,canvas.width,canvas.height),t.drawImage(e,0,0);for(var c=t.getImageData(0,0,e.width,e.height),h=c.data,d=0;s>d;d++)for(var u=0;l>u;u++){var p=4*(d+u*s);0!=h[p+3]&&(null!=o&&(h[p+0]+=o),null!=r&&(h[p+1]+=r),null!=a&&(h[p+2]+=a))}t.putImageData(c,0,0,0,0,e.width,e.height);var f=canvas.toDataURL();return f}function genImageAlarm(t,e){var n=t.src+e;if(alarmImageCache[n])return alarmImageCache[n];var i=new Image;return i.src=changeColor(graphics,t,e),alarmImageCache[n]=i,i}function getOffsetPosition(t){if(!t)return{left:0,top:0};var e=0,n=0;if("getBoundingClientRect"in document.documentElement)var i=t.getBoundingClientRect(),o=t.ownerDocument,r=o.body,a=o.documentElement,s=a.clientTop||r.clientTop||0,l=a.clientLeft||r.clientLeft||0,e=i.top+(self.pageYOffset||a&&a.scrollTop||r.scrollTop)-s,n=i.left+(self.pageXOffset||a&&a.scrollLeft||r.scrollLeft)-l;else do e+=t.offsetTop||0,n+=t.offsetLeft||0,t=t.offsetParent;while(t);return{left:n,top:e}}function lineF(t,e,n,i){function o(t){return t*r+a}var r=(i-e)/(n-t),a=e-t*r;return o.k=r,o.b=a,o.x1=t,o.x2=n,o.y1=e,o.y2=i,o}function inRange(t,e,n){var i=Math.abs(e-n),o=Math.abs(e-t),r=Math.abs(n-t),a=Math.abs(i-(o+r));return 1e-6>a}function isPointInLineSeg(t,e,n){return inRange(t,n.x1,n.x2)&&inRange(e,n.y1,n.y2)}function intersection(t,e){var n,i;return t.k==e.k?null:(1/0==t.k||t.k==-1/0?(n=t.x1,i=e(t.x1)):1/0==e.k||e.k==-1/0?(n=e.x1,i=t(e.x1)):(n=(e.b-t.b)/(t.k-e.k),i=t(n)),0==isPointInLineSeg(n,i,t)?null:0==isPointInLineSeg(n,i,e)?null:{x:n,y:i})}function intersectionLineBound(t,e){var n=JTopo.util.lineF(e.left,e.top,e.left,e.bottom),i=JTopo.util.intersection(t,n);return null==i&&(n=JTopo.util.lineF(e.left,e.top,e.right,e.top),i=JTopo.util.intersection(t,n),null==i&&(n=JTopo.util.lineF(e.right,e.top,e.right,e.bottom),i=JTopo.util.intersection(t,n),null==i&&(n=JTopo.util.lineF(e.left,e.bottom,e.right,e.bottom),i=JTopo.util.intersection(t,n)))),i}requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||window.oRequestAnimationFrame||function(t){setTimeout(t,1e3/24)},Array.prototype.del=function(t){if("number"!=typeof t){for(var e=0;e<this.length;e++)if(this[e]===t)return this.slice(0,e).concat(this.slice(e+1,this.length));return this}return 0>t?this:this.slice(0,t).concat(this.slice(t+1,this.length))},[].indexOf||(Array.prototype.indexOf=function(t){for(var e=0;e<this.length;e++)if(this[e]===t)return e;return-1}),window.console||(window.console={log:function(){},info:function(){},debug:function(){},warn:function(){},error:function(){}});var canvas=document.createElement("canvas"),graphics=canvas.getContext("2d"),alarmImageCache={};JTopo.util={rotatePoint:rotatePoint,rotatePoints:rotatePoints,getDistance:getDistance,getEventPosition:getEventPosition,mouseCoords:mouseCoords,MessageBus:MessageBus,isFirefox:navigator.userAgent.indexOf("Firefox")>0,isIE:!(!window.attachEvent||-1!==navigator.userAgent.indexOf("Opera")),isChrome:null!=navigator.userAgent.toLowerCase().match(/chrome/),clone:clone,isPointInRect:isPointInRect,isPointInLine:isPointInLine,removeFromArray:removeFromArray,cloneEvent:cloneEvent,randomColor:randomColor,isIntsect:isIntsect,toJson:toJson,loadStageFromJson:loadStageFromJson,getElementsBound:getElementsBound,genImageAlarm:genImageAlarm,getOffsetPosition:getOffsetPosition,lineF:lineF,intersection:intersection,intersectionLineBound:intersectionLineBound},window.$for=$for,window.$foreach=$foreach}(JTopo),function(t){function e(t){return{hgap:16,visible:!1,exportCanvas:document.createElement("canvas"),getImage:function(e,n){var i=t.getBound(),o=1,r=1;this.exportCanvas.width=t.canvas.width,this.exportCanvas.height=t.canvas.height,null!=e&&null!=n?(this.exportCanvas.width=e,this.exportCanvas.height=n,o=e/i.width,r=n/i.height):(i.width>t.canvas.width&&(this.exportCanvas.width=i.width),i.height>t.canvas.height&&(this.exportCanvas.height=i.height));var a=this.exportCanvas.getContext("2d");return t.childs.length>0&&(a.save(),a.clearRect(0,0,this.exportCanvas.width,this.exportCanvas.height),t.childs.forEach(function(t){1==t.visible&&(t.save(),t.translateX=0,t.translateY=0,t.scaleX=1,t.scaleY=1,a.scale(o,r),i.left<0&&(t.translateX=Math.abs(i.left)),i.top<0&&(t.translateY=Math.abs(i.top)),t.paintAll=!0,t.repaint(a),t.paintAll=!1,t.restore())}),a.restore()),this.exportCanvas.toDataURL("image/png")},canvas:document.createElement("canvas"),update:function(){this.eagleImageDatas=this.getData(t)},setSize:function(t,e){this.width=this.canvas.width=t,this.height=this.canvas.height=e},getData:function(e,n){function i(t){var e=t.stage.canvas.width,n=t.stage.canvas.height,i=e/t.scaleX/2,o=n/t.scaleY/2;return{translateX:t.translateX+i-i*t.scaleX,translateY:t.translateY+o-o*t.scaleY}}null!=c&&null!=h?this.setSize(e,n):this.setSize(200,160);var o=this.canvas.getContext("2d");if(t.childs.length>0){o.save(),o.clearRect(0,0,this.canvas.width,this.canvas.height),t.childs.forEach(function(t){1==t.visible&&(t.save(),t.centerAndZoom(null,null,o),t.repaint(o),t.restore())});var r=i(t.childs[0]),a=r.translateX*(this.canvas.width/t.canvas.width)*t.childs[0].scaleX,s=r.translateY*(this.canvas.height/t.canvas.height)*t.childs[0].scaleY,l=t.getBound(),c=t.canvas.width/t.childs[0].scaleX/l.width,h=t.canvas.height/t.childs[0].scaleY/l.height;c>1&&(c=1),h>1&&(c=1),a*=c,s*=h,l.left<0&&(a-=Math.abs(l.left)*(this.width/l.width)),l.top<0&&(s-=Math.abs(l.top)*(this.height/l.height)),o.save(),o.lineWidth=1,o.strokeStyle="rgba(255,0,0,1)",o.strokeRect(-a,-s,o.canvas.width*c,o.canvas.height*h),o.restore();var d=null;try{d=o.getImageData(0,0,o.canvas.width,o.canvas.height)}catch(t){}return d}return null},paint:function(){if(null!=this.eagleImageDatas){var e=t.graphics;e.save(),e.fillStyle="rgba(211,211,211,0.3)",e.fillRect(t.canvas.width-this.canvas.width-2*this.hgap,t.canvas.height-this.canvas.height-1,t.canvas.width-this.canvas.width,this.canvas.height+1),e.fill(),e.save(),e.lineWidth=1,e.strokeStyle="rgba(0,0,0,1)",e.rect(t.canvas.width-this.canvas.width-2*this.hgap,t.canvas.height-this.canvas.height-1,t.canvas.width-this.canvas.width,this.canvas.height+1),e.stroke(),e.restore(),e.putImageData(this.eagleImageDatas,t.canvas.width-this.canvas.width-this.hgap,t.canvas.height-this.canvas.height),e.restore()}else this.eagleImageDatas=this.getData(t)},eventHandler:function(t,e,n){var i=e.x,o=e.y;if(i>n.canvas.width-this.canvas.width&&o>n.canvas.height-this.canvas.height&&(i=e.x-this.canvas.width,o=e.y-this.canvas.height,"mousedown"==t&&(this.lastTranslateX=n.childs[0].translateX,this.lastTranslateY=n.childs[0].translateY),"mousedrag"==t&&n.childs.length>0)){var r=e.dx,a=e.dy,s=n.getBound(),l=this.canvas.width/n.childs[0].scaleX/s.width,c=this.canvas.height/n.childs[0].scaleY/s.height;n.childs[0].translateX=this.lastTranslateX-r/l,n.childs[0].translateY=this.lastTranslateY-a/c}}}}function n(n){function i(e){var n=t.util.getEventPosition(e),i=t.util.getOffsetPosition(p.canvas);return n.offsetLeft=n.pageX-i.left,n.offsetTop=n.pageY-i.top,n.x=n.offsetLeft,n.y=n.offsetTop,n.target=null,n}function o(t){document.onselectstart=function(){return!1},this.mouseOver=!0;var e=i(t);p.dispatchEventToScenes("mouseover",e),p.dispatchEvent("mouseover",e)}function r(t){m=setTimeout(function(){f=!0},500),document.onselectstart=function(){return!0};var e=i(t);p.dispatchEventToScenes("mouseout",e),p.dispatchEvent("mouseout",e),p.needRepaint=0!=p.animate}function a(t){var e=i(t);p.mouseDown=!0,p.mouseDownX=e.x,p.mouseDownY=e.y,p.dispatchEventToScenes("mousedown",e),p.dispatchEvent("mousedown",e)}function s(t){var e=i(t);p.dispatchEventToScenes("mouseup",e),p.dispatchEvent("mouseup",e),p.mouseDown=!1,p.needRepaint=0!=p.animate}function l(t){m&&(window.clearTimeout(m),m=null),f=!1;var e=i(t);p.mouseDown?0==t.button&&(e.dx=e.x-p.mouseDownX,e.dy=e.y-p.mouseDownY,p.dispatchEventToScenes("mousedrag",e),p.dispatchEvent("mousedrag",e),1==p.eagleEye.visible&&p.eagleEye.update()):(p.dispatchEventToScenes("mousemove",e),p.dispatchEvent("mousemove",e))}function c(t){var e=i(t);p.dispatchEventToScenes("click",e),p.dispatchEvent("click",e)}function h(t){var e=i(t);p.dispatchEventToScenes("dbclick",e),p.dispatchEvent("dbclick",e)}function d(t){var e=i(t);p.dispatchEventToScenes("mousewheel",e),p.dispatchEvent("mousewheel",e),null!=p.wheelZoom&&(t.preventDefault?t.preventDefault():(t=t||window.event,t.returnValue=!1),1==p.eagleEye.visible&&p.eagleEye.update())}function u(e){t.util.isIE||!window.addEventListener?(e.onmouseout=r,e.onmouseover=o,e.onmousedown=a,e.onmouseup=s,e.onmousemove=l,e.onclick=c,e.ondblclick=h,e.onmousewheel=d,e.touchstart=a,e.touchmove=l,e.touchend=s):(e.addEventListener("mouseout",r),e.addEventListener("mouseover",o),e.addEventListener("mousedown",a),e.addEventListener("mouseup",s),e.addEventListener("mousemove",l),e.addEventListener("click",c),e.addEventListener("dblclick",h),t.util.isFirefox?e.addEventListener("DOMMouseScroll",d):e.addEventListener("mousewheel",d)),window.addEventListener&&(window.addEventListener("keydown",function(e){p.dispatchEventToScenes("keydown",t.util.cloneEvent(e));var n=e.keyCode;(37==n||38==n||39==n||40==n)&&(e.preventDefault?e.preventDefault():(e=e||window.event,e.returnValue=!1))},!0),window.addEventListener("keyup",function(e){p.dispatchEventToScenes("keyup",t.util.cloneEvent(e));var n=e.keyCode;(37==n||38==n||39==n||40==n)&&(e.preventDefault?e.preventDefault():(e=e||window.event,e.returnValue=!1))},!0))}t.stage=this;var p=this;this.initialize=function(n){u(n),this.canvas=n,this.graphics=n.getContext("2d"),this.childs=[],this.frames=24,this.messageBus=new t.util.MessageBus,this.eagleEye=e(this),this.wheelZoom=null,this.mouseDownX=0,this.mouseDownY=0,this.mouseDown=!1,this.mouseOver=!1,this.needRepaint=!0,this.serializedProperties=["frames","wheelZoom"]},null!=n&&this.initialize(n);var f=!0,m=null;document.oncontextmenu=function(){return f},this.dispatchEventToScenes=function(t,e){if(0!=this.frames&&(this.needRepaint=!0),1==this.eagleEye.visible&&-1!=t.indexOf("mouse")){var n=e.x,i=e.y;if(n>this.width-this.eagleEye.width&&i>this.height-this.eagleEye.height)return void this.eagleEye.eventHandler(t,e,this)}this.childs.forEach(function(n){if(1==n.visible){var i=n[t+"Handler"];if(null==i)throw new Error("Function not found:"+t+"Handler");i.call(n,e)}})},this.add=function(t){for(var e=0;e<this.childs.length;e++)if(this.childs[e]===t)return;t.addTo(this),this.childs.push(t)},this.remove=function(t){if(null==t)throw new Error("Stage.remove出错: 参数为null!");for(var e=0;e<this.childs.length;e++)if(this.childs[e]===t)return t.stage=null,this.childs=this.childs.del(e),this;return this},this.clear=function(){this.childs=[]},this.addEventListener=function(t,e){var n=this,i=function(t){e.call(n,t)};return this.messageBus.subscribe(t,i),this},this.removeEventListener=function(t){this.messageBus.unsubscribe(t)},this.removeAllEventListener=function(){this.messageBus=new t.util.MessageBus},this.dispatchEvent=function(t,e){return this.messageBus.publish(t,e),this};var g="click,dbclick,mousedown,mouseup,mouseover,mouseout,mousemove,mousedrag,mousewheel,touchstart,touchmove,touchend,keydown,keyup".split(","),v=this;g.forEach(function(t){v[t]=function(e){null!=e?this.addEventListener(t,e):this.dispatchEvent(t)}}),this.saveImageInfo=function(t,e){var n=this.eagleEye.getImage(t,e),i=window.open("about:blank");return i.document.write("<img src='"+n+"' alt='from canvas'/>"),this},this.saveAsLocalImage=function(t,e){var n=this.eagleEye.getImage(t,e);return n.replace("image/png","image/octet-stream"),window.location.href=n,this},this.paint=function(){null!=this.canvas&&(this.graphics.save(),this.graphics.clearRect(0,0,this.width,this.height),this.childs.forEach(function(t){1==t.visible&&t.repaint(p.graphics)}),1==this.eagleEye.visible&&this.eagleEye.paint(this),this.graphics.restore())},this.repaint=function(){0!=this.frames&&(this.frames<0&&0==this.needRepaint||(this.paint(),this.frames<0&&(this.needRepaint=!1)))},this.zoom=function(t){this.childs.forEach(function(e){0!=e.visible&&e.zoom(t)})},this.zoomOut=function(t){this.childs.forEach(function(e){0!=e.visible&&e.zoomOut(t)})},this.zoomIn=function(t){this.childs.forEach(function(e){0!=e.visible&&e.zoomIn(t)})},this.centerAndZoom=function(){this.childs.forEach(function(t){0!=t.visible&&t.centerAndZoom()})},this.setCenter=function(t,e){var n=this;this.childs.forEach(function(i){var o=t-n.canvas.width/2,r=e-n.canvas.height/2;i.translateX=-o,i.translateY=-r})},this.getBound=function(){var t={left:Number.MAX_VALUE,right:Number.MIN_VALUE,top:Number.MAX_VALUE,bottom:Number.MIN_VALUE};return this.childs.forEach(function(e){var n=e.getElementsBound();n.left<t.left&&(t.left=n.left,t.leftNode=n.leftNode),n.top<t.top&&(t.top=n.top,t.topNode=n.topNode),n.right>t.right&&(t.right=n.right,t.rightNode=n.rightNode),n.bottom>t.bottom&&(t.bottom=n.bottom,t.bottomNode=n.bottomNode)}),t.width=t.right-t.left,t.height=t.bottom-t.top,t},this.toJson=function(){var e=this,n='{"version":"'+t.version+'",';return this.serializedProperties.length,this.serializedProperties.forEach(function(t){var i=e[t];"string"==typeof i&&(i='"'+i+'"'),n+='"'+t+'":'+i+","}),n+='"childs":[',this.childs.forEach(function(t){n+=t.toJson()}),n+="]",n+="}"},function(){0==p.frames?setTimeout(arguments.callee,100):p.frames<0?(p.repaint(),setTimeout(arguments.callee,1e3/-p.frames)):(p.repaint(),setTimeout(arguments.callee,1e3/p.frames))}(),setTimeout(function(){p.mousewheel(function(t){var e=null==t.wheelDelta?t.detail:t.wheelDelta;null!=this.wheelZoom&&(e>0?this.zoomIn(this.wheelZoom):this.zoomOut(this.wheelZoom))}),p.paint()},300),setTimeout(function(){p.paint()},1e3),setTimeout(function(){p.paint()},3e3)}n.prototype={get width(){return this.canvas.width},get height(){return this.canvas.height},set cursor(t){this.canvas.style.cursor=t},get cursor(){return this.canvas.style.cursor},set mode(t){this.childs.forEach(function(e){e.mode=t})}},t.Stage=n}(JTopo),function(t){function e(n){function i(t,e,n,i){return function(o){o.beginPath(),o.strokeStyle="rgba(0,0,236,0.5)",o.fillStyle="rgba(0,0,236,0.1)",o.rect(t,e,n,i),o.fill(),o.stroke(),o.closePath()}}var o=this;this.initialize=function(){e.prototype.initialize.apply(this,arguments),this.messageBus=new t.util.MessageBus,this.elementType="scene",this.childs=[],this.zIndexMap={},this.zIndexArray=[],this.backgroundColor="255,255,255",this.visible=!0,this.alpha=0,this.scaleX=1,this.scaleY=1,this.mode=t.SceneMode.normal,this.translate=!0,this.translateX=0,this.translateY=0,this.lastTranslateX=0,this.lastTranslateY=0,this.mouseDown=!1,this.mouseDownX=null,this.mouseDownY=null,this.mouseDownEvent=null,this.areaSelect=!0,this.operations=[],this.selectedElements=[],this.paintAll=!1;var n="background,backgroundColor,mode,paintAll,areaSelect,translate,translateX,translateY,lastTranslatedX,lastTranslatedY,alpha,visible,scaleX,scaleY".split(",");this.serializedProperties=this.serializedProperties.concat(n)},this.initialize(),this.setBackground=function(t){this.background=t},this.addTo=function(t){this.stage!==t&&null!=t&&(this.stage=t)},null!=n&&(n.add(this),this.addTo(n)),this.show=function(){this.visible=!0},this.hide=function(){this.visible=!1},this.paint=function(t){if(0!=this.visible&&null!=this.stage){if(t.save(),this.paintBackgroud(t),t.restore(),t.save(),t.scale(this.scaleX,this.scaleY),1==this.translate){var e=this.getOffsetTranslate(t);t.translate(e.translateX,e.translateY)}this.paintChilds(t),t.restore(),t.save(),this.paintOperations(t,this.operations),t.restore()}},this.repaint=function(t){0!=this.visible&&this.paint(t)},this.paintBackgroud=function(t){null!=this.background?t.drawImage(this.background,0,0,t.canvas.width,t.canvas.height):(t.beginPath(),t.fillStyle="rgba("+this.backgroundColor+","+this.alpha+")",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.closePath())},this.getDisplayedElements=function(){for(var t=[],e=0;e<this.zIndexArray.length;e++)for(var n=this.zIndexArray[e],i=this.zIndexMap[n],o=0;o<i.length;o++){var r=i[o];this.isVisiable(r)&&t.push(r)}return t},this.getDisplayedNodes=function(){for(var e=[],n=0;n<this.childs.length;n++){var i=this.childs[n];i instanceof t.Node&&this.isVisiable(i)&&e.push(i)}return e},this.paintChilds=function(e){for(var n=0;n<this.zIndexArray.length;n++)for(var i=this.zIndexArray[n],o=this.zIndexMap[i],r=0;r<o.length;r++){var a=o[r];if(1==this.paintAll||this.isVisiable(a)){if(e.save(),1==a.transformAble){var s=a.getCenterLocation();e.translate(s.x,s.y),a.rotate&&e.rotate(a.rotate),a.scaleX&&a.scaleY?e.scale(a.scaleX,a.scaleY):a.scaleX?e.scale(a.scaleX,1):a.scaleY&&e.scale(1,a.scaleY)}1==a.shadow&&(e.shadowBlur=a.shadowBlur,e.shadowColor=a.shadowColor,e.shadowOffsetX=a.shadowOffsetX,e.shadowOffsetY=a.shadowOffsetY),a instanceof t.InteractiveElement&&(a.selected&&1==a.showSelected&&a.paintSelected(e),1==a.isMouseOver&&a.paintMouseover(e)),a.paint(e),e.restore()}}},this.getOffsetTranslate=function(t){var e=this.stage.canvas.width,n=this.stage.canvas.height;null!=t&&"move"!=t&&(e=t.canvas.width,n=t.canvas.height);var i=e/this.scaleX/2,o=n/this.scaleY/2,r={translateX:this.translateX+(i-i*this.scaleX),translateY:this.translateY+(o-o*this.scaleY)};return r},this.isVisiable=function(e){if(1!=e.visible)return!1;if(e instanceof t.Link)return!0;var n=this.getOffsetTranslate(),i=e.x+n.translateX,o=e.y+n.translateY;i*=this.scaleX,o*=this.scaleY;var r=i+e.width*this.scaleX,a=o+e.height*this.scaleY;return!(i>this.stage.canvas.width||o>this.stage.canvas.height||0>r||0>a)},this.paintOperations=function(t,e){for(var n=0;n<e.length;n++)e[n](t)},this.findElements=function(t){for(var e=[],n=0;n<this.childs.length;n++)1==t(this.childs[n])&&e.push(this.childs[n]);return e},this.getElementsByClass=function(t){return this.findElements(function(e){return e instanceof t})},this.addOperation=function(t){return this.operations.push(t),this},this.clearOperations=function(){return this.operations=[],this},this.getElementByXY=function(e,n){for(var i=null,o=this.zIndexArray.length-1;o>=0;o--)for(var r=this.zIndexArray[o],a=this.zIndexMap[r],s=a.length-1;s>=0;s--){var l=a[s];if(l instanceof t.InteractiveElement&&this.isVisiable(l)&&l.isInBound(e,n))return i=l}return i},this.add=function(t){this.childs.push(t),null==this.zIndexMap[t.zIndex]&&(this.zIndexMap[t.zIndex]=[],this.zIndexArray.push(t.zIndex),this.zIndexArray.sort(function(t,e){return t-e})),this.zIndexMap[""+t.zIndex].push(t)},this.remove=function(e){this.childs=t.util.removeFromArray(this.childs,e);var n=this.zIndexMap[e.zIndex];n&&(this.zIndexMap[e.zIndex]=t.util.removeFromArray(n,e)),e.removeHandler(this)},this.clear=function(){var t=this;this.childs.forEach(function(e){e.removeHandler(t)}),this.childs=[],this.operations=[],this.zIndexArray=[],this.zIndexMap={}},this.addToSelected=function(t){this.selectedElements.push(t)},this.cancleAllSelected=function(t){for(var e=0;e<this.selectedElements.length;e++)this.selectedElements[e].unselectedHandler(t);this.selectedElements=[]},this.notInSelectedNodes=function(t){for(var e=0;e<this.selectedElements.length;e++)if(t===this.selectedElements[e])return!1;return!0},this.removeFromSelected=function(t){for(var e=0;e<this.selectedElements.length;e++){var n=this.selectedElements[e];t===n&&(this.selectedElements=this.selectedElements.del(e))}},this.toSceneEvent=function(e){var n=t.util.clone(e);if(n.x/=this.scaleX,n.y/=this.scaleY,1==this.translate){var i=this.getOffsetTranslate();n.x-=i.translateX,n.y-=i.translateY}return null!=n.dx&&(n.dx/=this.scaleX,n.dy/=this.scaleY),null!=this.currentElement&&(n.target=this.currentElement),n.scene=this,n},this.selectElement=function(t){var e=o.getElementByXY(t.x,t.y);if(null!=e)if(t.target=e,e.mousedownHander(t),e.selectedHandler(t),o.notInSelectedNodes(e))t.ctrlKey||o.cancleAllSelected(),o.addToSelected(e);else{1==t.ctrlKey&&(e.unselectedHandler(),this.removeFromSelected(e));for(var n=0;n<this.selectedElements.length;n++){var i=this.selectedElements[n];i.selectedHandler(t)}}else t.ctrlKey||o.cancleAllSelected();this.currentElement=e},this.mousedownHandler=function(e){var n=this.toSceneEvent(e);if(this.mouseDown=!0,this.mouseDownX=n.x,this.mouseDownY=n.y,this.mouseDownEvent=n,this.mode==t.SceneMode.normal)this.selectElement(n),(null==this.currentElement||this.currentElement instanceof t.Link)&&1==this.translate&&(this.lastTranslateX=this.translateX,this.lastTranslateY=this.translateY);else{if(this.mode==t.SceneMode.drag&&1==this.translate)return this.lastTranslateX=this.translateX,void(this.lastTranslateY=this.translateY);this.mode==t.SceneMode.select?this.selectElement(n):this.mode==t.SceneMode.edit&&(this.selectElement(n),(null==this.currentElement||this.currentElement instanceof t.Link)&&1==this.translate&&(this.lastTranslateX=this.translateX,this.lastTranslateY=this.translateY))}o.dispatchEvent("mousedown",n)},this.mouseupHandler=function(e){this.stage.cursor!=t.MouseCursor.normal&&(this.stage.cursor=t.MouseCursor.normal),o.clearOperations();var n=this.toSceneEvent(e);null!=this.currentElement&&(n.target=o.currentElement,this.currentElement.mouseupHandler(n)),this.dispatchEvent("mouseup",n),this.mouseDown=!1},this.dragElements=function(e){if(null!=this.currentElement&&1==this.currentElement.dragable)for(var n=0;n<this.selectedElements.length;n++){var i=this.selectedElements[n];if(0!=i.dragable){var o=t.util.clone(e);o.target=i,i.mousedragHandler(o)}}},this.mousedragHandler=function(e){var n=this.toSceneEvent(e);this.mode==t.SceneMode.normal?null==this.currentElement||this.currentElement instanceof t.Link?1==this.translate&&(this.stage.cursor=t.MouseCursor.closed_hand,this.translateX=this.lastTranslateX+n.dx,this.translateY=this.lastTranslateY+n.dy):this.dragElements(n):this.mode==t.SceneMode.drag?1==this.translate&&(this.stage.cursor=t.MouseCursor.closed_hand,this.translateX=this.lastTranslateX+n.dx,this.translateY=this.lastTranslateY+n.dy):this.mode==t.SceneMode.select?null!=this.currentElement?1==this.currentElement.dragable&&this.dragElements(n):1==this.areaSelect&&this.areaSelectHandle(n):this.mode==t.SceneMode.edit&&(null==this.currentElement||this.currentElement instanceof t.Link?1==this.translate&&(this.stage.cursor=t.MouseCursor.closed_hand,this.translateX=this.lastTranslateX+n.dx,this.translateY=this.lastTranslateY+n.dy):this.dragElements(n)),this.dispatchEvent("mousedrag",n)},this.areaSelectHandle=function(t){var e=t.offsetLeft,n=t.offsetTop,r=this.mouseDownEvent.offsetLeft,a=this.mouseDownEvent.offsetTop,s=e>=r?r:e,l=n>=a?a:n,c=Math.abs(t.dx)*this.scaleX,h=Math.abs(t.dy)*this.scaleY,d=new i(s,l,c,h);o.clearOperations().addOperation(d),e=t.x,n=t.y,r=this.mouseDownEvent.x,a=this.mouseDownEvent.y,s=e>=r?r:e,l=n>=a?a:n,c=Math.abs(t.dx),h=Math.abs(t.dy);for(var u=s+c,p=l+h,f=0;f<o.childs.length;f++){var m=o.childs[f];m.x>s&&m.x+m.width<u&&m.y>l&&m.y+m.height<p&&o.notInSelectedNodes(m)&&(m.selectedHandler(t),o.addToSelected(m))}},this.mousemoveHandler=function(e){this.mousecoord={x:e.x,y:e.y};var n=this.toSceneEvent(e);if(this.mode==t.SceneMode.drag)return void(this.stage.cursor=t.MouseCursor.open_hand);this.mode==t.SceneMode.normal?this.stage.cursor=t.MouseCursor.normal:this.mode==t.SceneMode.select&&(this.stage.cursor=t.MouseCursor.normal);var i=o.getElementByXY(n.x,n.y);null!=i?(o.mouseOverelement&&o.mouseOverelement!==i&&(n.target=i,o.mouseOverelement.mouseoutHandler(n)),o.mouseOverelement=i,0==i.isMouseOver?(n.target=i,i.mouseoverHandler(n),o.dispatchEvent("mouseover",n)):(n.target=i,i.mousemoveHandler(n),o.dispatchEvent("mousemove",n))):o.mouseOverelement?(n.target=i,o.mouseOverelement.mouseoutHandler(n),o.mouseOverelement=null,o.dispatchEvent("mouseout",n)):(n.target=null,o.dispatchEvent("mousemove",n))},this.mouseoverHandler=function(t){var e=this.toSceneEvent(t);this.dispatchEvent("mouseover",e)},this.mouseoutHandler=function(t){var e=this.toSceneEvent(t);this.dispatchEvent("mouseout",e)},this.clickHandler=function(t){var e=this.toSceneEvent(t);this.currentElement&&(e.target=this.currentElement,this.currentElement.clickHandler(e)),this.dispatchEvent("click",e)},this.dbclickHandler=function(t){var e=this.toSceneEvent(t);this.currentElement?(e.target=this.currentElement,this.currentElement.dbclickHandler(e)):o.cancleAllSelected(),this.dispatchEvent("dbclick",e)},this.mousewheelHandler=function(t){var e=this.toSceneEvent(t);this.dispatchEvent("mousewheel",e)},this.touchstart=this.mousedownHander,this.touchmove=this.mousedragHandler,this.touchend=this.mousedownHander,this.keydownHandler=function(t){this.dispatchEvent("keydown",t)},this.keyupHandler=function(t){this.dispatchEvent("keyup",t)},this.addEventListener=function(t,e){var n=this,i=function(t){e.call(n,t)};return this.messageBus.subscribe(t,i),this},this.removeEventListener=function(t){this.messageBus.unsubscribe(t)},this.removeAllEventListener=function(){this.messageBus=new t.util.MessageBus},this.dispatchEvent=function(t,e){return this.messageBus.publish(t,e),this};var r="click,dbclick,mousedown,mouseup,mouseover,mouseout,mousemove,mousedrag,mousewheel,touchstart,touchmove,touchend,keydown,keyup".split(","),a=this;return r.forEach(function(t){a[t]=function(e){null!=e?this.addEventListener(t,e):this.dispatchEvent(t)}}),this.zoom=function(t,e){null!=t&&0!=t&&(this.scaleX=t),null!=e&&0!=e&&(this.scaleY=e)},this.zoomOut=function(t){
0!=t&&(null==t&&(t=.8),this.scaleX/=t,this.scaleY/=t)},this.zoomIn=function(t){0!=t&&(null==t&&(t=.8),this.scaleX*=t,this.scaleY*=t)},this.getBound=function(){return{left:0,top:0,right:this.stage.canvas.width,bottom:this.stage.canvas.height,width:this.stage.canvas.width,height:this.stage.canvas.height}},this.getElementsBound=function(){return t.util.getElementsBound(this.childs)},this.translateToCenter=function(t){var e=this.getElementsBound(),n=this.stage.canvas.width/2-(e.left+e.right)/2,i=this.stage.canvas.height/2-(e.top+e.bottom)/2;t&&(n=t.canvas.width/2-(e.left+e.right)/2,i=t.canvas.height/2-(e.top+e.bottom)/2),this.translateX=n,this.translateY=i},this.setCenter=function(t,e){var n=t-this.stage.canvas.width/2,i=e-this.stage.canvas.height/2;this.translateX=-n,this.translateY=-i},this.centerAndZoom=function(t,e,n){if(this.translateToCenter(n),null==t||null==e){var i=this.getElementsBound(),o=i.right-i.left,r=i.bottom-i.top,a=this.stage.canvas.width/o,s=this.stage.canvas.height/r;n&&(a=n.canvas.width/o,s=n.canvas.height/r);var l=Math.min(a,s);if(l>1)return;this.zoom(l,l)}this.zoom(t,e)},this.getCenterLocation=function(){return{x:o.stage.canvas.width/2,y:o.stage.canvas.height/2}},this.doLayout=function(t){t&&t(this,this.childs)},this.toJson=function(){var t=this,e="{";this.serializedProperties.length,this.serializedProperties.forEach(function(n){var i=t[n];"background"==n&&(i=t._background.src),"string"==typeof i&&(i='"'+i+'"'),e+='"'+n+'":'+i+","}),e+='"childs":[';var n=this.childs.length;return this.childs.forEach(function(t,i){e+=t.toJson(),n>i+1&&(e+=",")}),e+="]",e+="}"},o}e.prototype=new t.Element;var n={};Object.defineProperties(e.prototype,{background:{get:function(){return this._background},set:function(t){if("string"==typeof t){var e=n[t];null==e&&(e=new Image,e.src=t,e.onload=function(){n[t]=e}),this._background=e}else this._background=t}}}),t.Scene=e}(JTopo),function(t){function e(){this.initialize=function(){e.prototype.initialize.apply(this,arguments),this.elementType="displayElement",this.x=0,this.y=0,this.width=32,this.height=32,this.visible=!0,this.alpha=1,this.rotate=0,this.scaleX=1,this.scaleY=1,this.strokeColor="22,124,255",this.borderColor="22,124,255",this.fillColor="22,124,255",this.shadow=!1,this.shadowBlur=5,this.shadowColor="rgba(0,0,0,0.5)",this.shadowOffsetX=3,this.shadowOffsetY=6,this.transformAble=!1,this.zIndex=0;var t="x,y,width,height,visible,alpha,rotate,scaleX,scaleY,strokeColor,fillColor,shadow,shadowColor,shadowOffsetX,shadowOffsetY,transformAble,zIndex".split(",");this.serializedProperties=this.serializedProperties.concat(t)},this.initialize(),this.paint=function(t){t.beginPath(),t.fillStyle="rgba("+this.fillColor+","+this.alpha+")",t.rect(-this.width/2,-this.height/2,this.width,this.height),t.fill(),t.stroke(),t.closePath()},this.getLocation=function(){return{x:this.x,y:this.y}},this.setLocation=function(t,e){return this.x=t,this.y=e,this},this.getCenterLocation=function(){return{x:this.x+this.width/2,y:this.y+this.height/2}},this.setCenterLocation=function(t,e){return this.x=t-this.width/2,this.y=e-this.height/2,this},this.getSize=function(){return{width:this.width,height:this.heith}},this.setSize=function(t,e){return this.width=t,this.height=e,this},this.getBound=function(){return{left:this.x,top:this.y,right:this.x+this.width,bottom:this.y+this.height,width:this.width,height:this.height}},this.setBound=function(t,e,n,i){return this.setLocation(t,e),this.setSize(n,i),this},this.getDisplayBound=function(){return{left:this.x,top:this.y,right:this.x+this.width*this.scaleX,bottom:this.y+this.height*this.scaleY}},this.getDisplaySize=function(){return{width:this.width*this.scaleX,height:this.height*this.scaleY}},this.getPosition=function(t){var e,n=this.getBound();return"Top_Left"==t?e={x:n.left,y:n.top}:"Top_Center"==t?e={x:this.cx,y:n.top}:"Top_Right"==t?e={x:n.right,y:n.top}:"Middle_Left"==t?e={x:n.left,y:this.cy}:"Middle_Center"==t?e={x:this.cx,y:this.cy}:"Middle_Right"==t?e={x:n.right,y:this.cy}:"Bottom_Left"==t?e={x:n.left,y:n.bottom}:"Bottom_Center"==t?e={x:this.cx,y:n.bottom}:"Bottom_Right"==t&&(e={x:n.right,y:n.bottom}),e}}function n(){this.initialize=function(){n.prototype.initialize.apply(this,arguments),this.elementType="interactiveElement",this.dragable=!1,this.selected=!1,this.showSelected=!0,this.selectedLocation=null,this.isMouseOver=!1;var t="dragable,selected,showSelected,isMouseOver".split(",");this.serializedProperties=this.serializedProperties.concat(t)},this.initialize(),this.paintSelected=function(t){0!=this.showSelected&&(t.save(),t.beginPath(),t.strokeStyle="rgba(168,202,255, 0.9)",t.fillStyle="rgba(168,202,236,0.7)",t.rect(-this.width/2-3,-this.height/2-3,this.width+6,this.height+6),t.fill(),t.stroke(),t.closePath(),t.restore())},this.paintMouseover=function(t){return this.paintSelected(t)},this.isInBound=function(t,e){return t>this.x&&t<this.x+this.width*Math.abs(this.scaleX)&&e>this.y&&e<this.y+this.height*Math.abs(this.scaleY)},this.selectedHandler=function(){this.selected=!0,this.selectedLocation={x:this.x,y:this.y}},this.unselectedHandler=function(){this.selected=!1,this.selectedLocation=null},this.dbclickHandler=function(t){this.dispatchEvent("dbclick",t)},this.clickHandler=function(t){this.dispatchEvent("click",t)},this.mousedownHander=function(t){this.dispatchEvent("mousedown",t)},this.mouseupHandler=function(t){this.dispatchEvent("mouseup",t)},this.mouseoverHandler=function(t){this.isMouseOver=!0,this.dispatchEvent("mouseover",t)},this.mousemoveHandler=function(t){this.dispatchEvent("mousemove",t)},this.mouseoutHandler=function(t){this.isMouseOver=!1,this.dispatchEvent("mouseout",t)},this.mousedragHandler=function(t){var e=this.selectedLocation.x+t.dx,n=this.selectedLocation.y+t.dy;this.setLocation(e,n),this.dispatchEvent("mousedrag",t)},this.addEventListener=function(e,n){var i=this,o=function(t){n.call(i,t)};return this.messageBus||(this.messageBus=new t.util.MessageBus),this.messageBus.subscribe(e,o),this},this.dispatchEvent=function(t,e){return this.messageBus?(this.messageBus.publish(t,e),this):null},this.removeEventListener=function(t){this.messageBus.unsubscribe(t)},this.removeAllEventListener=function(){this.messageBus=new t.util.MessageBus};var e="click,dbclick,mousedown,mouseup,mouseover,mouseout,mousemove,mousedrag,touchstart,touchmove,touchend".split(","),i=this;e.forEach(function(t){i[t]=function(e){null!=e?this.addEventListener(t,e):this.dispatchEvent(t)}})}function i(){this.initialize=function(){i.prototype.initialize.apply(this,arguments),this.editAble=!1,this.selectedPoint=null},this.getCtrlPosition=function(t){var e=5,n=5,i=this.getPosition(t);return{left:i.x-e,top:i.y-n,right:i.x+e,bottom:i.y+n}},this.selectedHandler=function(e){i.prototype.selectedHandler.apply(this,arguments),this.selectedSize={width:this.width,height:this.height},e.scene.mode==t.SceneMode.edit&&(this.editAble=!0)},this.unselectedHandler=function(){i.prototype.unselectedHandler.apply(this,arguments),this.selectedSize=null,this.editAble=!1};var e=["Top_Left","Top_Center","Top_Right","Middle_Left","Middle_Right","Bottom_Left","Bottom_Center","Bottom_Right"];this.paintCtrl=function(t){if(0!=this.editAble){t.save();for(var n=0;n<e.length;n++){var i=this.getCtrlPosition(e[n]);i.left-=this.cx,i.right-=this.cx,i.top-=this.cy,i.bottom-=this.cy;var o=i.right-i.left,r=i.bottom-i.top;t.beginPath(),t.strokeStyle="rgba(0,0,0,0.8)",t.rect(i.left,i.top,o,r),t.stroke(),t.closePath(),t.beginPath(),t.strokeStyle="rgba(255,255,255,0.3)",t.rect(i.left+1,i.top+1,o-2,r-2),t.stroke(),t.closePath()}t.restore()}},this.isInBound=function(t,n){if(this.selectedPoint=null,1==this.editAble)for(var o=0;o<e.length;o++){var r=this.getCtrlPosition(e[o]);if(t>r.left&&t<r.right&&n>r.top&&n<r.bottom)return this.selectedPoint=e[o],!0}return i.prototype.isInBound.apply(this,arguments)},this.mousedragHandler=function(t){if(null==this.selectedPoint){var e=this.selectedLocation.x+t.dx,n=this.selectedLocation.y+t.dy;this.setLocation(e,n),this.dispatchEvent("mousedrag",t)}else{if("Top_Left"==this.selectedPoint){var i=this.selectedSize.width-t.dx,o=this.selectedSize.height-t.dy,e=this.selectedLocation.x+t.dx,n=this.selectedLocation.y+t.dy;e<this.x+this.width&&(this.x=e,this.width=i),n<this.y+this.height&&(this.y=n,this.height=o)}else if("Top_Center"==this.selectedPoint){var o=this.selectedSize.height-t.dy,n=this.selectedLocation.y+t.dy;n<this.y+this.height&&(this.y=n,this.height=o)}else if("Top_Right"==this.selectedPoint){var i=this.selectedSize.width+t.dx,n=this.selectedLocation.y+t.dy;n<this.y+this.height&&(this.y=n,this.height=this.selectedSize.height-t.dy),i>1&&(this.width=i)}else if("Middle_Left"==this.selectedPoint){var i=this.selectedSize.width-t.dx,e=this.selectedLocation.x+t.dx;e<this.x+this.width&&(this.x=e),i>1&&(this.width=i)}else if("Middle_Right"==this.selectedPoint){var i=this.selectedSize.width+t.dx;i>1&&(this.width=i)}else if("Bottom_Left"==this.selectedPoint){var i=this.selectedSize.width-t.dx,e=this.selectedLocation.x+t.dx;i>1&&(this.x=e,this.width=i);var o=this.selectedSize.height+t.dy;o>1&&(this.height=o)}else if("Bottom_Center"==this.selectedPoint){var o=this.selectedSize.height+t.dy;o>1&&(this.height=o)}else if("Bottom_Right"==this.selectedPoint){var i=this.selectedSize.width+t.dx;i>1&&(this.width=i);var o=this.selectedSize.height+t.dy;o>1&&(this.height=o)}this.dispatchEvent("resize",t)}}}e.prototype=new t.Element,Object.defineProperties(e.prototype,{cx:{get:function(){return this.x+this.width/2},set:function(t){this.x=t-this.width/2}},cy:{get:function(){return this.y+this.height/2},set:function(t){this.y=t-this.height/2}}}),n.prototype=new e,i.prototype=new n,t.DisplayElement=e,t.InteractiveElement=n,t.EditableElement=i}(JTopo),function(t){function e(n){this.initialize=function(n){e.prototype.initialize.apply(this,arguments),this.elementType="node",this.zIndex=t.zIndex_Node,this.text=n,this.font="12px Consolas",this.fontColor="255,255,255",this.borderWidth=0,this.borderColor="255,255,255",this.borderRadius=null,this.dragable=!0,this.textPosition="Bottom_Center",this.textOffsetX=0,this.textOffsetY=0,this.transformAble=!0,this.inLinks=null,this.outLinks=null;var i="text,font,fontColor,textPosition,textOffsetX,textOffsetY,borderRadius".split(",");this.serializedProperties=this.serializedProperties.concat(i)},this.initialize(n),this.paint=function(t){if(this.image){var e=t.globalAlpha;t.globalAlpha=this.alpha,null!=this.alarmImage&&null!=this.alarm?t.drawImage(this.alarmImage,-this.width/2,-this.height/2,this.width,this.height):t.drawImage(this.image,-this.width/2,-this.height/2,this.width,this.height),t.globalAlpha=e}else t.beginPath(),t.fillStyle="rgba("+this.fillColor+","+this.alpha+")",null==this.borderRadius||0==this.borderRadius?t.rect(-this.width/2,-this.height/2,this.width,this.height):t.JTopoRoundRect(-this.width/2,-this.height/2,this.width,this.height,this.borderRadius),t.fill(),t.closePath();this.paintText(t),this.paintBorder(t),this.paintCtrl(t),this.paintAlarmText(t)},this.paintAlarmText=function(t){if(null!=this.alarm&&""!=this.alarm){var e=this.alarmColor||"255,0,0",n=this.alarmAlpha||.5;t.beginPath(),t.font=this.alarmFont||"10px 微软雅黑";var i=t.measureText(this.alarm).width+6,o=t.measureText("田").width+6,r=this.width/2-i/2,a=-this.height/2-o-8;t.strokeStyle="rgba("+e+", "+n+")",t.fillStyle="rgba("+e+", "+n+")",t.lineCap="round",t.lineWidth=1,t.moveTo(r,a),t.lineTo(r+i,a),t.lineTo(r+i,a+o),t.lineTo(r+i/2+6,a+o),t.lineTo(r+i/2,a+o+8),t.lineTo(r+i/2-6,a+o),t.lineTo(r,a+o),t.lineTo(r,a),t.fill(),t.stroke(),t.closePath(),t.beginPath(),t.strokeStyle="rgba("+this.fontColor+", "+this.alpha+")",t.fillStyle="rgba("+this.fontColor+", "+this.alpha+")",t.fillText(this.alarm,r+2,a+o-4),t.closePath()}},this.paintText=function(t){var e=this.text;if(null!=e&&""!=e){t.beginPath(),t.font=this.font;var n=t.measureText(e).width,i=t.measureText("田").width;t.fillStyle="rgba("+this.fontColor+", "+this.alpha+")";var o=this.getTextPostion(this.textPosition,n,i);t.fillText(e,o.x,o.y),t.closePath()}},this.paintBorder=function(t){if(0!=this.borderWidth){t.beginPath(),t.lineWidth=this.borderWidth,t.strokeStyle="rgba("+this.borderColor+","+this.alpha+")";var e=this.borderWidth/2;null==this.borderRadius||0==this.borderRadius?t.rect(-this.width/2-e,-this.height/2-e,this.width+this.borderWidth,this.height+this.borderWidth):t.JTopoRoundRect(-this.width/2-e,-this.height/2-e,this.width+this.borderWidth,this.height+this.borderWidth,this.borderRadius),t.stroke(),t.closePath()}},this.getTextPostion=function(t,e,n){var i=null;return null==t||"Bottom_Center"==t?i={x:-this.width/2+(this.width-e)/2,y:this.height/2+n}:"Top_Center"==t?i={x:-this.width/2+(this.width-e)/2,y:-this.height/2-n/2}:"Top_Right"==t?i={x:this.width/2,y:-this.height/2-n/2}:"Top_Left"==t?i={x:-this.width/2-e,y:-this.height/2-n/2}:"Bottom_Right"==t?i={x:this.width/2,y:this.height/2+n}:"Bottom_Left"==t?i={x:-this.width/2-e,y:this.height/2+n}:"Middle_Center"==t?i={x:-this.width/2+(this.width-e)/2,y:n/2}:"Middle_Right"==t?i={x:this.width/2,y:n/2}:"Middle_Left"==t&&(i={x:-this.width/2-e,y:n/2}),null!=this.textOffsetX&&(i.x+=this.textOffsetX),null!=this.textOffsetY&&(i.y+=this.textOffsetY),i},this.setImage=function(t,e){if(null==t)throw new Error("Node.setImage(): 参数Image对象为空!");var n=this;if("string"==typeof t){var i=c[t];null==i?(i=new Image,i.src=t,i.onload=function(){c[t]=i,1==e&&n.setSize(i.width,i.height),n.image=i,n.alarmColor=null==n.alarmColor?"255,0,0":n.alarmColor}):(e&&this.setSize(i.width,i.height),n.image=i,n.alarmColor=null==n.alarmColor?"255,0,0":n.alarmColor)}else this.image=t,n.alarmColor=null==n.alarmColor?"255,0,0":n.alarmColor,1==e&&this.setSize(t.width,t.height)},this.removeHandler=function(t){var e=this;this.outLinks&&(this.outLinks.forEach(function(n){n.nodeA===e&&t.remove(n)}),this.outLinks=null),this.inLinks&&(this.inLinks.forEach(function(n){n.nodeZ===e&&t.remove(n)}),this.inLinks=null)}}function n(){n.prototype.initialize.apply(this,arguments)}function i(t){this.initialize(),this.text=t,this.elementType="TextNode",this.paint=function(t){t.beginPath(),t.font=this.font,this.width=t.measureText(this.text).width,this.height=t.measureText("田").width,t.strokeStyle="rgba("+this.fontColor+", "+this.alpha+")",t.fillStyle="rgba("+this.fontColor+", "+this.alpha+")",t.fillText(this.text,-this.width/2,this.height/2),t.closePath(),this.paintBorder(t),this.paintCtrl(t),this.paintAlarmText(t)}}function o(t,e,n){this.initialize(),this.text=t,this.href=e,this.target=n,this.elementType="LinkNode",this.isVisited=!1,this.visitedColor=null,this.paint=function(t){t.beginPath(),t.font=this.font,this.width=t.measureText(this.text).width,this.height=t.measureText("田").width,this.isVisited&&null!=this.visitedColor?(t.strokeStyle="rgba("+this.visitedColor+", "+this.alpha+")",t.fillStyle="rgba("+this.visitedColor+", "+this.alpha+")"):(t.strokeStyle="rgba("+this.fontColor+", "+this.alpha+")",t.fillStyle="rgba("+this.fontColor+", "+this.alpha+")"),t.fillText(this.text,-this.width/2,this.height/2),this.isMouseOver&&(t.moveTo(-this.width/2,this.height),t.lineTo(this.width/2,this.height),t.stroke()),t.closePath(),this.paintBorder(t),this.paintCtrl(t),this.paintAlarmText(t)},this.mousemove(function(){var t=document.getElementsByTagName("canvas");if(t&&t.length>0)for(var e=0;e<t.length;e++)t[e].style.cursor="pointer"}),this.mouseout(function(){var t=document.getElementsByTagName("canvas");if(t&&t.length>0)for(var e=0;e<t.length;e++)t[e].style.cursor="default"}),this.click(function(){"_blank"==this.target?window.open(this.href):location=this.href,this.isVisited=!0})}function r(t){this.initialize(arguments),this._radius=20,this.beginDegree=0,this.endDegree=2*Math.PI,this.text=t,this.paint=function(t){t.save(),t.beginPath(),t.fillStyle="rgba("+this.fillColor+","+this.alpha+")",t.arc(0,0,this.radius,this.beginDegree,this.endDegree,!0),t.fill(),t.closePath(),t.restore(),this.paintText(t),this.paintBorder(t),this.paintCtrl(t),this.paintAlarmText(t)},this.paintSelected=function(t){t.save(),t.beginPath(),t.strokeStyle="rgba(168,202,255, 0.9)",t.fillStyle="rgba(168,202,236,0.7)",t.arc(0,0,this.radius+3,this.beginDegree,this.endDegree,!0),t.fill(),t.stroke(),t.closePath(),t.restore()}}function a(t,e,n){this.initialize(),this.frameImages=t||[],this.frameIndex=0,this.isStop=!0;var i=e||1e3;this.repeatPlay=!1;var o=this;this.nextFrame=function(){if(!this.isStop&&null!=this.frameImages.length){if(this.frameIndex++,this.frameIndex>=this.frameImages.length){if(!this.repeatPlay)return;this.frameIndex=0}this.setImage(this.frameImages[this.frameIndex],n),setTimeout(function(){o.nextFrame()},i/t.length)}}}function s(t,e,n,i,o){this.initialize();var r=this;this.setImage(t),this.frameIndex=0,this.isPause=!0,this.repeatPlay=!1;var a=i||1e3;o=o||0,this.paint=function(t){if(this.image){var e=this.width,i=this.height;t.save(),t.beginPath(),t.fillStyle="rgba("+this.fillColor+","+this.alpha+")";var r=(Math.floor(this.frameIndex/n)+o)*i,a=Math.floor(this.frameIndex%n)*e;t.drawImage(this.image,a,r,e,i,-e/2,-i/2,e,i),t.fill(),t.closePath(),t.restore(),this.paintText(t),this.paintBorder(t),this.paintCtrl(t),this.paintAlarmText(t)}},this.nextFrame=function(){if(!this.isStop){if(this.frameIndex++,this.frameIndex>=e*n){if(!this.repeatPlay)return;this.frameIndex=0}setTimeout(function(){r.isStop||r.nextFrame()},a/(e*n))}}}function l(){var t=null;return t=arguments.length<=3?new a(arguments[0],arguments[1],arguments[2]):new s(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]),t.stop=function(){t.isStop=!0},t.play=function(){t.isStop=!1,t.frameIndex=0,t.nextFrame()},t}var c={};e.prototype=new t.EditableElement,n.prototype=new e,Object.defineProperties(n.prototype,{alarmColor:{get:function(){return this._alarmColor},set:function(e){if(this._alarmColor=e,null!=this.image){var n=t.util.genImageAlarm(this.image,e);n&&(this.alarmImage=n)}}}}),i.prototype=new n,o.prototype=new i,r.prototype=new n,Object.defineProperties(r.prototype,{radius:{get:function(){return this._radius},set:function(t){this._radius=t;var e=2*this.radius,n=2*this.radius;this.width=e,this.height=n}},width:{get:function(){return this._width},set:function(t){this._radius=t/2,this._width=t}},height:{get:function(){return this._height},set:function(t){this._radius=t/2,this._height=t}}}),a.prototype=new n,s.prototype=new n,l.prototype=new n,t.Node=n,t.TextNode=i,t.LinkNode=o,t.CircleNode=r,t.AnimateNode=l}(JTopo),function(t){function e(t,e){var n=[];if(null==t||null==e)return n;if(t&&e&&t.outLinks&&e.inLinks)for(var i=0;i<t.outLinks.length;i++)for(var o=t.outLinks[i],r=0;r<e.inLinks.length;r++){var a=e.inLinks[r];o===a&&n.push(a)}return n}function n(t,n){var i=e(t,n),o=e(n,t),r=i.concat(o);return r}function i(t){var e=n(t.nodeA,t.nodeZ);return e=e.filter(function(e){return t!==e})}function o(t,e){return n(t,e).length}function r(e,n,a){function s(e,n){var i=t.util.lineF(e.cx,e.cy,n.cx,n.cy),o=e.getBound(),r=t.util.intersectionLineBound(i,o);return r}this.initialize=function(e,n,i){if(r.prototype.initialize.apply(this,arguments),this.elementType="link",this.zIndex=t.zIndex_Link,0!=arguments.length){this.text=i,this.nodeA=e,this.nodeZ=n,this.nodeA&&null==this.nodeA.outLinks&&(this.nodeA.outLinks=[]),this.nodeA&&null==this.nodeA.inLinks&&(this.nodeA.inLinks=[]),this.nodeZ&&null==this.nodeZ.inLinks&&(this.nodeZ.inLinks=[]),this.nodeZ&&null==this.nodeZ.outLinks&&(this.nodeZ.outLinks=[]),null!=this.nodeA&&this.nodeA.outLinks.push(this),null!=this.nodeZ&&this.nodeZ.inLinks.push(this),this.caculateIndex(),this.font="12px Consolas",this.fontColor="255,255,255",this.lineWidth=2,this.lineJoin="miter",this.transformAble=!1,this.bundleOffset=20,this.bundleGap=12,this.textOffsetX=0,this.textOffsetY=0,this.arrowsRadius=null,this.arrowsOffset=0,this.dashedPattern=null,this.path=[];var o="text,font,fontColor,lineWidth,lineJoin".split(",");this.serializedProperties=this.serializedProperties.concat(o)}},this.caculateIndex=function(){var t=o(this.nodeA,this.nodeZ);t>0&&(this.nodeIndex=t-1)},this.initialize(e,n,a),this.removeHandler=function(){var t=this;this.nodeA&&this.nodeA.outLinks&&(this.nodeA.outLinks=this.nodeA.outLinks.filter(function(e){return e!==t})),this.nodeZ&&this.nodeZ.inLinks&&(this.nodeZ.inLinks=this.nodeZ.inLinks.filter(function(e){return e!==t}));var e=i(this);e.forEach(function(t,e){t.nodeIndex=e})},this.getStartPosition=function(){var t={x:this.nodeA.cx,y:this.nodeA.cy};return t},this.getEndPosition=function(){var t;return null!=this.arrowsRadius&&(t=s(this.nodeZ,this.nodeA)),null==t&&(t={x:this.nodeZ.cx,y:this.nodeZ.cy}),t},this.getPath=function(){var t=[],e=this.getStartPosition(),n=this.getEndPosition();if(this.nodeA===this.nodeZ)return[e,n];var i=o(this.nodeA,this.nodeZ);if(1==i)return[e,n];var r=Math.atan2(n.y-e.y,n.x-e.x),a={x:e.x+this.bundleOffset*Math.cos(r),y:e.y+this.bundleOffset*Math.sin(r)},s={x:n.x+this.bundleOffset*Math.cos(r-Math.PI),y:n.y+this.bundleOffset*Math.sin(r-Math.PI)},l=r-Math.PI/2,c=r-Math.PI/2,h=i*this.bundleGap/2-this.bundleGap/2,d=this.bundleGap*this.nodeIndex,u={x:a.x+d*Math.cos(l),y:a.y+d*Math.sin(l)},p={x:s.x+d*Math.cos(c),y:s.y+d*Math.sin(c)};return u={x:u.x+h*Math.cos(l-Math.PI),y:u.y+h*Math.sin(l-Math.PI)},p={x:p.x+h*Math.cos(c-Math.PI),y:p.y+h*Math.sin(c-Math.PI)},t.push({x:e.x,y:e.y}),t.push({x:u.x,y:u.y}),t.push({x:p.x,y:p.y}),t.push({x:n.x,y:n.y}),t},this.paintPath=function(t,e){if(this.nodeA===this.nodeZ)return void this.paintLoop(t);t.beginPath(),t.moveTo(e[0].x,e[0].y);for(var n=1;n<e.length;n++)null==this.dashedPattern?t.lineTo(e[n].x,e[n].y):t.JTopoDashedLineTo(e[n-1].x,e[n-1].y,e[n].x,e[n].y,this.dashedPattern);if(t.stroke(),t.closePath(),null!=this.arrowsRadius){var i=e[e.length-2],o=e[e.length-1];this.paintArrow(t,i,o)}},this.paintLoop=function(t){t.beginPath();var e=this.bundleGap*(this.nodeIndex+1)/2;Math.PI+Math.PI/2,t.arc(this.nodeA.x,this.nodeA.y,e,Math.PI/2,2*Math.PI),t.stroke(),t.closePath()},this.paintArrow=function(e,n,i){var o=this.arrowsOffset,r=this.arrowsRadius/2,a=n,s=i,l=Math.atan2(s.y-a.y,s.x-a.x),c=t.util.getDistance(a,s)-this.arrowsRadius,h=a.x+(c+o)*Math.cos(l),d=a.y+(c+o)*Math.sin(l),u=s.x+o*Math.cos(l),p=s.y+o*Math.sin(l);l-=Math.PI/2;var f={x:h+r*Math.cos(l),y:d+r*Math.sin(l)},m={x:h+r*Math.cos(l-Math.PI),y:d+r*Math.sin(l-Math.PI)};e.beginPath(),e.fillStyle="rgba("+this.strokeColor+","+this.alpha+")",e.moveTo(f.x,f.y),e.lineTo(u,p),e.lineTo(m.x,m.y),e.stroke(),e.closePath()},this.paint=function(t){if(null!=this.nodeA&&null!=!this.nodeZ){var e=this.getPath(this.nodeIndex);this.path=e,t.strokeStyle="rgba("+this.strokeColor+","+this.alpha+")",t.lineWidth=this.lineWidth,this.paintPath(t,e),e&&e.length>0&&this.paintText(t,e)}};var l=-(Math.PI/2+Math.PI/4);this.paintText=function(t,e){var n=e[0],i=e[e.length-1];if(4==e.length&&(n=e[1],i=e[2]),this.text&&this.text.length>0){var o=(i.x+n.x)/2+this.textOffsetX,r=(i.y+n.y)/2+this.textOffsetY;t.save(),t.beginPath(),t.font=this.font;var a=t.measureText(this.text).width,s=t.measureText("田").width;if(t.fillStyle="rgba("+this.fontColor+", "+this.alpha+")",this.nodeA===this.nodeZ){var c=this.bundleGap*(this.nodeIndex+1)/2,o=this.nodeA.x+c*Math.cos(l),r=this.nodeA.y+c*Math.sin(l);t.fillText(this.text,o,r)}else t.fillText(this.text,o-a/2,r-s/2);t.stroke(),t.closePath(),t.restore()}},this.paintSelected=function(t){t.shadowBlur=10,t.shadowColor="rgba(0,0,0,1)",t.shadowOffsetX=0,t.shadowOffsetY=0},this.isInBound=function(e,n){if(this.nodeA===this.nodeZ){var i=this.bundleGap*(this.nodeIndex+1)/2,o=t.util.getDistance(this.nodeA,{x:e,y:n})-i;return Math.abs(o)<=3}for(var r=!1,a=1;a<this.path.length;a++){var s=this.path[a-1],l=this.path[a];if(1==t.util.isPointInLine({x:e,y:n},s,l)){r=!0;break}}return r}}function a(t,e,n){this.initialize=function(){a.prototype.initialize.apply(this,arguments),this.direction="horizontal"},this.initialize(t,e,n),this.getStartPosition=function(){var t={x:this.nodeA.cx,y:this.nodeA.cy};return"horizontal"==this.direction?this.nodeZ.cx>t.x?t.x+=this.nodeA.width/2:t.x-=this.nodeA.width/2:this.nodeZ.cy>t.y?t.y+=this.nodeA.height/2:t.y-=this.nodeA.height/2,t},this.getEndPosition=function(){var t={x:this.nodeZ.cx,y:this.nodeZ.cy};return"horizontal"==this.direction?this.nodeA.cy<t.y?t.y-=this.nodeZ.height/2:t.y+=this.nodeZ.height/2:t.x=this.nodeA.cx<t.x?this.nodeZ.x:this.nodeZ.x+this.nodeZ.width,t},this.getPath=function(t){var e=[],n=this.getStartPosition(),i=this.getEndPosition();if(this.nodeA===this.nodeZ)return[n,i];var r,a,s=o(this.nodeA,this.nodeZ),l=(s-1)*this.bundleGap,c=this.bundleGap*t-l/2;return"horizontal"==this.direction?(r=i.x+c,a=n.y-c,e.push({x:n.x,y:a}),e.push({x:r,y:a}),e.push({x:r,y:i.y})):(r=n.x+c,a=i.y-c,e.push({x:r,y:n.y}),e.push({x:r,y:a}),e.push({x:i.x,y:a})),e},this.paintText=function(t,e){if(this.text&&this.text.length>0){var n=e[1],i=n.x+this.textOffsetX,o=n.y+this.textOffsetY;t.save(),t.beginPath(),t.font=this.font;var r=t.measureText(this.text).width,a=t.measureText("田").width;t.fillStyle="rgba("+this.fontColor+", "+this.alpha+")",t.fillText(this.text,i-r/2,o-a/2),t.stroke(),t.closePath(),t.restore()}}}function s(t,e,n){this.initialize=function(){s.prototype.initialize.apply(this,arguments),this.direction="vertical",this.offsetGap=44},this.initialize(t,e,n),this.getStartPosition=function(){var t={x:this.nodeA.cx,y:this.nodeA.cy};return"horizontal"==this.direction?t.x=this.nodeZ.cx<t.x?this.nodeA.x:this.nodeA.x+this.nodeA.width:t.y=this.nodeZ.cy<t.y?this.nodeA.y:this.nodeA.y+this.nodeA.height,t},this.getEndPosition=function(){var t={x:this.nodeZ.cx,y:this.nodeZ.cy};return"horizontal"==this.direction?t.x=this.nodeA.cx<t.x?this.nodeZ.x:this.nodeZ.x+this.nodeZ.width:t.y=this.nodeA.cy<t.y?this.nodeZ.y:this.nodeZ.y+this.nodeZ.height,t},this.getPath=function(t){var e=this.getStartPosition(),n=this.getEndPosition();if(this.nodeA===this.nodeZ)return[e,n];var i=[],r=o(this.nodeA,this.nodeZ),a=(r-1)*this.bundleGap,s=this.bundleGap*t-a/2,l=this.offsetGap;return"horizontal"==this.direction?(this.nodeA.cx>this.nodeZ.cx&&(l=-l),i.push({x:e.x,y:e.y+s}),i.push({x:e.x+l,y:e.y+s}),i.push({x:n.x-l,y:n.y+s}),i.push({x:n.x,y:n.y+s})):(this.nodeA.cy>this.nodeZ.cy&&(l=-l),i.push({x:e.x+s,y:e.y}),i.push({x:e.x+s,y:e.y+l}),i.push({x:n.x+s,y:n.y-l}),i.push({x:n.x+s,y:n.y})),i}}function l(t,e,n){this.initialize=function(){l.prototype.initialize.apply(this,arguments)},this.initialize(t,e,n),this.paintPath=function(t,e){if(this.nodeA===this.nodeZ)return void this.paintLoop(t);t.beginPath(),t.moveTo(e[0].x,e[0].y);for(var n=1;n<e.length;n++){var i=e[n-1],o=e[n],r=(i.x+o.x)/2,a=(i.y+o.y)/2;a+=(o.y-i.y)/2,t.strokeStyle="rgba("+this.strokeColor+","+this.alpha+")",t.lineWidth=this.lineWidth,t.moveTo(i.x,i.cy),t.quadraticCurveTo(r,a,o.x,o.y),t.stroke()}if(t.stroke(),t.closePath(),null!=this.arrowsRadius){var s=e[e.length-2],l=e[e.length-1];this.paintArrow(t,s,l)}}}r.prototype=new t.InteractiveElement,a.prototype=new r,s.prototype=new r,l.prototype=new r,t.Link=r,t.FoldLink=a,t.FlexionalLink=s,t.CurveLink=l}(JTopo),function(t){function e(n){this.initialize=function(n){e.prototype.initialize.apply(this,null),this.elementType="container",this.zIndex=t.zIndex_Container,this.width=100,this.height=100,this.childs=[],this.alpha=.5,this.dragable=!0,this.childDragble=!0,this.visible=!0,this.fillColor="10,100,80",this.borderWidth=0,this.borderColor="255,255,255",this.borderRadius=null,this.font="12px Consolas",this.fontColor="255,255,255",this.text=n,this.textPosition="Bottom_Center",this.textOffsetX=0,this.textOffsetY=0,this.layout=new t.layout.AutoBoundLayout},this.initialize(n),this.add=function(t){this.childs.push(t),t.dragable=this.childDragble},this.remove=function(t){for(var e=0;e<this.childs.length;e++)if(this.childs[e]===t){t.parentContainer=null,this.childs=this.childs.del(e),t.lastParentContainer=this;break}},this.removeAll=function(){this.childs=[]},this.setLocation=function(t,e){var n=t-this.x,i=e-this.y;this.x=t,this.y=e;for(var o=0;o<this.childs.length;o++){var r=this.childs[o];r.setLocation(r.x+n,r.y+i)}},this.doLayout=function(t){t&&t(this,this.childs)},this.paint=function(t){this.visible&&(this.layout&&this.layout(this,this.childs),t.beginPath(),t.fillStyle="rgba("+this.fillColor+","+this.alpha+")",null==this.borderRadius||0==this.borderRadius?t.rect(this.x,this.y,this.width,this.height):t.JTopoRoundRect(this.x,this.y,this.width,this.height,this.borderRadius),t.fill(),t.closePath(),this.paintText(t),this.paintBorder(t))},this.paintBorder=function(t){if(0!=this.borderWidth){t.beginPath(),t.lineWidth=this.borderWidth,t.strokeStyle="rgba("+this.borderColor+","+this.alpha+")";var e=this.borderWidth/2;null==this.borderRadius||0==this.borderRadius?t.rect(this.x-e,this.y-e,this.width+this.borderWidth,this.height+this.borderWidth):t.JTopoRoundRect(this.x-e,this.y-e,this.width+this.borderWidth,this.height+this.borderWidth,this.borderRadius),t.stroke(),t.closePath()}},this.paintText=function(t){var e=this.text;if(null!=e&&""!=e){t.beginPath(),t.font=this.font;var n=t.measureText(e).width,i=t.measureText("田").width;t.fillStyle="rgba("+this.fontColor+", "+this.alpha+")";var o=this.getTextPostion(this.textPosition,n,i);t.fillText(e,o.x,o.y),t.closePath()}},this.getTextPostion=function(t,e,n){var i=null;return null==t||"Bottom_Center"==t?i={x:this.x+this.width/2-e/2,y:this.y+this.height+n}:"Top_Center"==t?i={x:this.x+this.width/2-e/2,y:this.y-n/2}:"Top_Right"==t?i={x:this.x+this.width-e,y:this.y-n/2}:"Top_Left"==t?i={x:this.x,y:this.y-n/2}:"Bottom_Right"==t?i={x:this.x+this.width-e,y:this.y+this.height+n}:"Bottom_Left"==t?i={x:this.x,y:this.y+this.height+n}:"Middle_Center"==t?i={x:this.x+this.width/2-e/2,y:this.y+this.height/2+n/2}:"Middle_Right"==t?i={x:this.x+this.width-e,y:this.y+this.height/2+n/2}:"Middle_Left"==t&&(i={x:this.x,y:this.y+this.height/2+n/2}),null!=this.textOffsetX&&(i.x+=this.textOffsetX),null!=this.textOffsetY&&(i.y+=this.textOffsetY),i},this.paintMouseover=function(){},this.paintSelected=function(t){t.shadowBlur=10,t.shadowColor="rgba(0,0,0,1)",t.shadowOffsetX=0,t.shadowOffsetY=0}}e.prototype=new t.InteractiveElement,t.Container=e}(JTopo),function(t){function e(t){var e=0,n=0;t.forEach(function(t){e+=t.cx,n+=t.cy});var i={x:e/t.length,y:n/t.length};return i}function n(n,i){null==i&&(i={});var o=i.cx,r=i.cy,a=i.minRadius,s=i.nodeDiameter,l=i.hScale||1,c=i.vScale||1;if(i.beginAngle||0,i.endAngle||2*Math.PI,null==o||null==r){var h=e(n);o=h.x,r=h.y}var d=0,u=[],p=[];n.forEach(function(t){null==i.nodeDiameter?(t.diameter&&(s=t.diameter),s=t.radius?2*t.radius:Math.sqrt(2*t.width*t.height),p.push(s)):p.push(s),d+=s}),n.forEach(function(t,e){var n=p[e]/d;u.push(Math.PI*n)});var f=(n.length,u[0]+u[1]),m=p[0]/2+p[1]/2,g=m/2/Math.sin(f/2);null!=a&&a>g&&(g=a);var v=g*l,b=g*c,y=i.animate;if(y){var w=y.time||1e3,x=0;n.forEach(function(e,n){x+=0==n?u[n]:u[n-1]+u[n];var i=o+Math.cos(x)*v,a=r+Math.sin(x)*b;t.Animate.stepByStep(e,{x:i-e.width/2,y:a-e.height/2},w).start()})}else{var x=0;n.forEach(function(t,e){x+=0==e?u[e]:u[e-1]+u[e];var n=o+Math.cos(x)*v,i=r+Math.sin(x)*b;t.cx=n,t.cy=i})}return{cx:o,cy:r,radius:v,radiusA:v,radiusB:b}}function i(t,e){return function(n){var i=n.childs;if(!(i.length<=0))for(var o=n.getBound(),r=i[0],a=(o.width-r.width)/e,s=(o.height-r.height)/t,l=(i.length,0),c=0;t>c;c++)for(var h=0;e>h;h++){var d=i[l++],u=o.left+a/2+h*a,p=o.top+s/2+c*s;if(d.setLocation(u,p),l>=i.length)return}}}function o(t,e){return null==t&&(t=0),null==e&&(e=0),function(n){var i=n.childs;if(!(i.length<=0))for(var o=n.getBound(),r=o.left,a=o.top,s=0;s<i.length;s++){var l=i[s];r+l.width>=o.right&&(r=o.left,a+=e+l.height),l.setLocation(r,a),r+=t+l.width}}}function r(){return function(t,e){if(e.length>0){for(var n=1e7,i=-1e7,o=1e7,r=-1e7,a=i-n,s=r-o,l=0;l<e.length;l++){var c=e[l];c.x<=n&&(n=c.x),c.x>=i&&(i=c.x),c.y<=o&&(o=c.y),c.y>=r&&(r=c.y),a=i-n+c.width,s=r-o+c.height}t.x=n,t.y=o,t.width=a,t.height=s}}}function a(e){var n=[],i=e.filter(function(e){return e instanceof t.Link||(n.push(e),
!1)});return e=n.filter(function(t){for(var e=0;e<i.length;e++)if(i[e].nodeZ===t)return!1;return!0}),e=e.filter(function(t){for(var e=0;e<i.length;e++)if(i[e].nodeA===t)return!0;return!1})}function s(t){var e=0,n=0;return t.forEach(function(t){e+=t.width,n+=t.height}),{width:e/t.length,height:n/t.length}}function l(t,e,n,i){e.x+=n,e.y+=i;for(var o=g(t,e),r=0;r<o.length;r++)l(t,o[r],n,i)}function c(t,e){function n(e,o){var r=g(t,e);null==i[o]&&(i[o]={},i[o].nodes=[],i[o].childs=[]),i[o].nodes.push(e),i[o].childs.push(r);for(var a=0;a<r.length;a++)n(r[a],o+1),r[a].parent=e}var i=[];return n(e,0),i}function h(e,n,i){return function(o){function r(r,a){for(var s=t.layout.getTreeDeep(r,a),h=c(r,a),d=h[""+s].nodes,u=0;u<d.length;u++){var p=d[u],f=(u+1)*(n+10),m=s*i;"down"==e||("up"==e?m=-m:"left"==e?(f=-s*i,m=(u+1)*(n+10)):"right"==e&&(f=s*i,m=(u+1)*(n+10))),p.setLocation(f,m)}for(var g=s-1;g>=0;g--)for(var v=h[""+g].nodes,b=h[""+g].childs,u=0;u<v.length;u++){var y=v[u],w=b[u];if("down"==e?y.y=g*i:"up"==e?y.y=-g*i:"left"==e?y.x=-g*i:"right"==e&&(y.x=g*i),w.length>0?"down"==e||"up"==e?y.x=(w[0].x+w[w.length-1].x)/2:("left"==e||"right"==e)&&(y.y=(w[0].y+w[w.length-1].y)/2):u>0&&("down"==e||"up"==e?y.x=v[u-1].x+v[u-1].width+n:("left"==e||"right"==e)&&(y.y=v[u-1].y+v[u-1].height+n)),u>0)if("down"==e||"up"==e){if(y.x<v[u-1].x+v[u-1].width)for(var x=v[u-1].x+v[u-1].width+n,k=Math.abs(x-y.x),_=u;_<v.length;_++)l(o.childs,v[_],k,0)}else if(("left"==e||"right"==e)&&y.y<v[u-1].y+v[u-1].height)for(var T=v[u-1].y+v[u-1].height+n,E=Math.abs(T-y.y),_=u;_<v.length;_++)l(o.childs,v[_],0,E)}}var a=null;null==n&&(a=s(o.childs),n=a.width,("left"==e||"right"==e)&&(n=a.width+10)),null==i&&(null==a&&(a=s(o.childs)),i=2*a.height),null==e&&(e="down");var h=t.layout.getRootNodes(o.childs);if(h.length>0){r(o.childs,h[0]);var d=t.util.getElementsBound(o.childs),u=o.getCenterLocation(),p=u.x-(d.left+d.right)/2,f=u.y-(d.top+d.bottom)/2;o.childs.forEach(function(e){e instanceof t.Node&&(e.x+=p,e.y+=f)})}}}function d(e){return function(n){function i(t,n,o){var r=g(t,n);if(0!=r.length){null==o&&(o=e);var a=2*Math.PI/r.length;r.forEach(function(e,r){var s=n.x+o*Math.cos(a*r),l=n.y+o*Math.sin(a*r);e.setLocation(s,l);var c=o/2;i(t,e,c)})}}var o=t.layout.getRootNodes(n.childs);if(o.length>0){i(n.childs,o[0]);var r=t.util.getElementsBound(n.childs),a=n.getCenterLocation(),s=a.x-(r.left+r.right)/2,l=a.y-(r.top+r.bottom)/2;n.childs.forEach(function(e){e instanceof t.Node&&(e.x+=s,e.y+=l)})}}}function u(t,e,n,i,o,r){for(var a=[],s=0;n>s;s++)for(var l=0;i>l;l++)a.push({x:t+l*o,y:e+s*r});return a}function p(t,e,n,i,o,r){var a=o?o:0,s=r?r:2*Math.PI,l=s-a,c=l/n,h=[];a+=c/2;for(var d=a;s>=d;d+=c){var u=t+Math.cos(d)*i,p=e+Math.sin(d)*i;h.push({x:u,y:p})}return h}function f(t,e,n,i,o,r){var a=r||"bottom",s=[];if("bottom"==a)for(var l=t-n/2*i+i/2,c=0;n>=c;c++)s.push({x:l+c*i,y:e+o});else if("top"==a)for(var l=t-n/2*i+i/2,c=0;n>=c;c++)s.push({x:l+c*i,y:e-o});else if("right"==a)for(var l=e-n/2*i+i/2,c=0;n>=c;c++)s.push({x:t+o,y:l+c*i});else if("left"==a)for(var l=e-n/2*i+i/2,c=0;n>=c;c++)s.push({x:t-o,y:l+c*i});return s}function u(t,e,n,i,o,r){for(var a=[],s=0;n>s;s++)for(var l=0;i>l;l++)a.push({x:t+l*o,y:e+s*r});return a}function m(t,e){if(t.layout){var n=t.layout,i=n.type,o=null;if("circle"==i){var r=n.radius||Math.max(t.width,t.height);o=p(t.cx,t.cy,e.length,r,t.layout.beginAngle,t.layout.endAngle)}else if("tree"==i){var a=n.width||50,s=n.height||50,l=n.direction;o=f(t.cx,t.cy,e.length,a,s,l)}else{if("grid"!=i)return;o=u(t.x,t.y,n.rows,n.cols,n.horizontal||0,n.vertical||0)}for(var c=0;c<e.length;c++)e[c].setCenterLocation(o[c].x,o[c].y)}}function g(e,n){for(var i=[],o=0;o<e.length;o++)e[o]instanceof t.Link&&e[o].nodeA===n&&i.push(e[o].nodeZ);return i}function v(t,e,n){var i=g(t.childs,e);if(0==i.length)return null;if(m(e,i),1==n)for(var o=0;o<i.length;o++)v(t,i[o],n);return null}function b(e,n){function i(t,e){var n=t.x-e.x,i=t.y-e.y;l+=n*r,c+=i*r,l*=a,c*=a,c+=s,e.x+=l,e.y+=c}function o(){if(!(++h>150)){for(var t=0;t<d.length;t++)d[t]!=e&&i(e,d[t],d);setTimeout(o,1e3/24)}}var r=.01,a=.95,s=-5,l=0,c=0,h=0,d=n.getElementsByClass(t.Node);o()}function y(t,e){function n(t,e,o){var r=g(t,e);o>i&&(i=o);for(var a=0;a<r.length;a++)n(t,r[a],o+1)}var i=0;return n(t,e,0),i}t.layout=t.Layout={layoutNode:v,getNodeChilds:g,adjustPosition:m,springLayout:b,getTreeDeep:y,getRootNodes:a,GridLayout:i,FlowLayout:o,AutoBoundLayout:r,CircleLayout:d,TreeLayout:h,getNodesCenter:e,circleLayoutNodes:n}}(JTopo),function(t){function e(){var e=new t.CircleNode;return e.radius=150,e.colors=["#3666B0","#2CA8E0","#77D1F6"],e.datas=[.3,.3,.4],e.titles=["A","B","C"],e.paint=function(t){var n=2*e.radius,i=2*e.radius;e.width=n,e.height=i;for(var o=0,r=0;r<this.datas.length;r++){var a=this.datas[r]*Math.PI*2;t.save(),t.beginPath(),t.fillStyle=e.colors[r],t.moveTo(0,0),t.arc(0,0,this.radius,o,o+a,!1),t.fill(),t.closePath(),t.restore(),t.beginPath(),t.font=this.font;var s=this.titles[r]+": "+(100*this.datas[r]).toFixed(2)+"%",l=t.measureText(s).width,c=(t.measureText("田").width,(o+o+a)/2),h=this.radius*Math.cos(c),d=this.radius*Math.sin(c);c>Math.PI/2&&c<=Math.PI?h-=l:c>Math.PI&&c<2*Math.PI*3/4?h-=l:c>2*Math.PI*.75,t.fillStyle="#FFFFFF",t.fillText(s,h,d),t.moveTo(this.radius*Math.cos(c),this.radius*Math.sin(c)),c>Math.PI/2&&c<2*Math.PI*3/4&&(h-=l),c>Math.PI,t.fill(),t.stroke(),t.closePath(),o+=a}},e}function n(){var e=new t.Node;return e.showSelected=!1,e.width=250,e.height=180,e.colors=["#3666B0","#2CA8E0","#77D1F6"],e.datas=[.3,.3,.4],e.titles=["A","B","C"],e.paint=function(t){var n=3,i=(this.width-n)/this.datas.length;t.save(),t.beginPath(),t.fillStyle="#FFFFFF",t.strokeStyle="#FFFFFF",t.moveTo(-this.width/2-1,-this.height/2),t.lineTo(-this.width/2-1,this.height/2+3),t.lineTo(this.width/2+n+1,this.height/2+3),t.stroke(),t.closePath(),t.restore();for(var o=0;o<this.datas.length;o++){t.save(),t.beginPath(),t.fillStyle=e.colors[o];var r=this.datas[o],a=o*(i+n)-this.width/2,s=this.height-r-this.height/2;t.fillRect(a,s,i,r);var l=""+parseInt(this.datas[o]),c=t.measureText(l).width,h=t.measureText("田").width;t.fillStyle="#FFFFFF",t.fillText(l,a+(i-c)/2,s-h),t.fillText(this.titles[o],a+(i-c)/2,this.height/2+h),t.fill(),t.closePath(),t.restore()}},e}t.BarChartNode=n,t.PieChartNode=e}(JTopo),function(t){function e(e,n){var i,o=null;return{stop:function(){return i?(window.clearInterval(i),o&&o.publish("stop"),this):this},start:function(){var t=this;return i=setInterval(function(){e.call(t)},n),this},onStop:function(e){return null==o&&(o=new t.util.MessageBus),o.subscribe("stop",e),this}}}function n(t,n){n=n||{};var i=n.gravity||.1,o=n.dx||0,r=n.dy||5,a=n.stop,s=n.interval||30,l=new e(function(){a&&a()?(r=.5,this.stop()):(r+=i,t.setLocation(t.x+o,t.y+r))},s);return l}function i(t,n,i,o,r){var a=1e3/24,s={};for(var l in n){var c=n[l],h=c-t[l];s[l]={oldValue:t[l],targetValue:c,step:h/i*a,isDone:function(e){var n=this.step>0&&t[e]>=this.targetValue||this.step<0&&t[e]<=this.targetValue;return n}}}var d=new e(function(){var e=!0;for(var i in n)s[i].isDone(i)||(t[i]+=s[i].step,e=!1);if(e){if(!o)return this.stop();for(var i in n)if(r){var a=s[i].targetValue;s[i].targetValue=s[i].oldValue,s[i].oldValue=a,s[i].step=-s[i].step}else t[i]=s[i].oldValue}return this},a);return d}function o(t){null==t&&(t={});var e=t.spring||.1,n=t.friction||.8,i=t.grivity||0,o=(t.wind||0,t.minLength||0);return{items:[],timer:null,isPause:!1,addNode:function(t,e){var n={node:t,target:e,vx:0,vy:0};return this.items.push(n),this},play:function(t){this.stop(),t=null==t?1e3/24:t;var e=this;this.timer=setInterval(function(){e.nextFrame()},t)},stop:function(){null!=this.timer&&window.clearInterval(this.timer)},nextFrame:function(){for(var t=0;t<this.items.length;t++){var r=this.items[t],a=r.node,s=r.target,l=r.vx,c=r.vy,h=s.x-a.x,d=s.y-a.y,u=Math.atan2(d,h);if(0!=o){var p=s.x-Math.cos(u)*o,f=s.y-Math.sin(u)*o;l+=(p-a.x)*e,c+=(f-a.y)*e}else l+=h*e,c+=d*e;l*=n,c*=n,c+=i,a.x+=l,a.y+=c,r.vx=l,r.vy=c}}}}function r(t,e){function n(){return o=setInterval(function(){return f?void r.stop():(t.rotate+=a||.2,void(t.rotate>2*Math.PI&&(t.rotate=0)))},100),r}function i(){return window.clearInterval(o),r.onStop&&r.onStop(t),r}var o=(e.context,null),r={},a=e.v;return r.run=n,r.stop=i,r.onStop=function(t){return r.onStop=t,r},r}function a(t,e){function n(){return window.clearInterval(a),s.onStop&&s.onStop(t),s}function i(){var i=e.dx||0,l=e.dy||2;return a=setInterval(function(){return f?void s.stop():(l+=r,void(t.y+t.height<o.stage.canvas.height?t.setLocation(t.x+i,t.y+l):(l=0,n())))},20),s}var o=e.context,r=e.gravity||.1,a=null,s={};return s.run=i,s.stop=n,s.onStop=function(t){return s.onStop=t,s},s}function s(e,n){function i(n,i,o,r,a){var s=new t.Node;return s.setImage(e.image),s.setSize(e.width,e.height),s.setLocation(n,i),s.showSelected=!1,s.dragable=!1,s.paint=function(t){t.save(),t.arc(0,0,o,r,a),t.clip(),t.beginPath(),null!=this.image?t.drawImage(this.image,-this.width/2,-this.height/2):(t.fillStyle="rgba("+this.style.fillStyle+","+this.alpha+")",t.rect(-this.width/2,-this.height/2,this.width/2,this.height/2),t.fill()),t.closePath(),t.restore()},s}function o(n,o){var r=n,a=n+Math.PI,s=i(e.x,e.y,e.width,r,a),c=i(e.x-2+4*Math.random(),e.y,e.width,r+Math.PI,r);e.visible=!1,o.add(s),o.add(c),t.Animate.gravity(s,{context:o,dx:.3}).run().onStop(function(){o.remove(s),o.remove(c),l.stop()}),t.Animate.gravity(c,{context:o,dx:-.2}).run()}function r(){return o(n.angle,s),l}function a(){return l.onStop&&l.onStop(e),l}var s=n.context,l=(e.style,{});return l.onStop=function(t){return l.onStop=t,l},l.run=r,l.stop=a,l}function l(t,e){function n(t){t.visible=!0,t.rotate=Math.random();var e=a.stage.canvas.width/2;t.x=e+Math.random()*(e-100)-Math.random()*(e-100),t.y=a.stage.canvas.height,t.vx=5*Math.random()-5*Math.random(),t.vy=-25}function i(){return n(t),s=setInterval(function(){return f?void l.stop():(t.vy+=r,t.x+=t.vx,t.y+=t.vy,void((t.x<0||t.x>a.stage.canvas.width||t.y>a.stage.canvas.height)&&(l.onStop&&l.onStop(t),n(t))))},50),l}function o(){window.clearInterval(s)}var r=.8,a=e.context,s=null,l={};return l.onStop=function(t){return l.onStop=t,l},l.run=i,l.stop=o,l}function c(){f=!0}function h(){f=!1}function d(e,n){function i(){return p=setInterval(function(){if(f)return void u.stop();var t=r.y+s+Math.sin(h)*c;e.setLocation(e.x,t),h+=d},100),u}function o(){window.clearInterval(p)}var r=n.p1,a=n.p2,s=(n.context,r.x+(a.x-r.x)/2),l=r.y+(a.y-r.y)/2,c=t.util.getDistance(r,a)/2,h=Math.atan2(l,s),d=n.speed||.2,u={},p=null;return u.run=i,u.stop=o,u}function u(t,e){function n(){return s=setInterval(function(){if(f)return void a.stop();var e=o.x-t.x,n=o.y-t.y,s=e*r,l=n*r;t.x+=s,t.y+=l,.01>s&&.1>l&&i()},100),a}function i(){window.clearInterval(s)}var o=e.position,r=(e.context,e.easing||.2),a={},s=null;return a.onStop=function(t){return a.onStop=t,a},a.run=n,a.stop=i,a}function p(t,e){function n(){return c=setInterval(function(){t.scaleX+=r,t.scaleY+=r,t.scaleX>=o&&i()},100),l}function i(){l.onStop&&l.onStop(t),t.scaleX=a,t.scaleY=s,window.clearInterval(c)}var o=(e.position,e.context,e.scale||1),r=.06,a=t.scaleX,s=t.scaleY,l={},c=null;return l.onStop=function(t){return l.onStop=t,l},l.run=n,l.stop=i,l}t.Animate={},t.Effect={};var f=!1;t.Effect.spring=o,t.Effect.gravity=n,t.Animate.stepByStep=i,t.Animate.rotate=r,t.Animate.scale=p,t.Animate.move=u,t.Animate.cycle=d,t.Animate.repeatThrow=l,t.Animate.dividedTwoPiece=s,t.Animate.gravity=a,t.Animate.startAll=h,t.Animate.stopAll=c}(JTopo),function(t){function e(t,e){var n=[];if(0==t.length)return n;var i=e.match(/^\s*(\w+)\s*$/);if(null!=i){var o=t.filter(function(t){return t.elementType==i[1]});null!=o&&o.length>0&&(n=n.concat(o))}else{var r=!1;if(i=e.match(/\s*(\w+)\s*\[\s*(\w+)\s*([>=<])\s*['"](\S+)['"]\s*\]\s*/),(null==i||i.length<5)&&(i=e.match(/\s*(\w+)\s*\[\s*(\w+)\s*([>=<])\s*(\d+(\.\d+)?)\s*\]\s*/),r=!0),null!=i&&i.length>=5){var a=i[1],s=i[2],l=i[3],c=i[4];o=t.filter(function(t){if(t.elementType!=a)return!1;var e=t[s];return 1==r&&(e=parseInt(e)),"="==l?e==c:">"==l?e>c:"<"==l?c>e:"<="==l?c>=e:">="==l?e>=c:"!="==l&&e!=c}),null!=o&&o.length>0&&(n=n.concat(o))}}return n}function n(t){if(t.find=function(t){return i.call(this,t)},o.forEach(function(e){t[e]=function(t){for(var n=0;n<this.length;n++)this[n][e](t);return this}}),t.length>0){var e=t[0];for(var n in e){var r=e[n];"function"==typeof r&&!function(e){t[n]=function(){for(var n=[],i=0;i<t.length;i++)n.push(e.apply(t[i],arguments));return n}}(r)}}return t.attr=function(t,e){if(null!=t&&null!=e)for(var n=0;n<this.length;n++)this[n][t]=e;else{if(null!=t&&"string"==typeof t){for(var i=[],n=0;n<this.length;n++)i.push(this[n][t]);return i}if(null!=t)for(var n=0;n<this.length;n++)for(var o in t)this[n][o]=t[o]}return this},t}function i(i){var o=[],r=[];this instanceof t.Stage?(o=this.childs,r=r.concat(o)):this instanceof t.Scene?o=[this]:r=this,o.forEach(function(t){r=r.concat(t.childs)});var a=null;return a="function"==typeof i?r.filter(i):e(r,i),a=n(a)}var o="click,mousedown,mouseup,mouseover,mouseout,mousedrag,keydown,keyup".split(",");t.Stage.prototype.find=i,t.Scene.prototype.find=i}(JTopo),function(t){function e(t,e){this.x=t,this.y=e}function n(t){this.p=new e(0,0),this.w=new e(1,0),this.paint=t}function i(t,e,n){return function(i){for(var o=0;e>o;o++)t(),n&&i.turn(n),i.move(3)}}function o(t,e){var n=2*Math.PI;return function(i){for(var o=0;e>o;o++)t(),i.turn(n/e)}}function r(t,e,n){return function(i){for(var o=0;e>o;o++)t(),i.resize(n)}}function a(t){var e=2*Math.PI;return function(n){for(var i=0;t>i;i++)n.forward(1),n.turn(e/t)}}function s(t){var e=4*Math.PI;return function(n){for(var i=0;t>i;i++)n.forward(1),n.turn(e/t)}}function l(t,e,n,i){return function(o){for(var r=0;e>r;r++)t(),o.forward(1),o.turn(n),o.resize(i)}}var c={};n.prototype.forward=function(t){var e=this.p,n=this.w;return e.x=e.x+t*n.x,e.y=e.y+t*n.y,this.paint&&this.paint(e.x,e.y),this},n.prototype.move=function(t){var e=this.p,n=this.w;return e.x=e.x+t*n.x,e.y=e.y+t*n.y,this},n.prototype.moveTo=function(t,e){return this.p.x=t,this.p.y=e,this},n.prototype.turn=function(t){var e=(this.p,this.w),n=Math.cos(t)*e.x-Math.sin(t)*e.y,i=Math.sin(t)*e.x+Math.cos(t)*e.y;return e.x=n,e.y=i,this},n.prototype.resize=function(t){var e=this.w;return e.x=e.x*t,e.y=e.y*t,this},n.prototype.save=function(){return null==this._stack&&(this._stack=[]),this._stack.push([this.p,this.w]),this},n.prototype.restore=function(){if(null!=this._stack&&this._stack.length>0){var t=this._stack.pop();this.p=t[0],this.w=t[1]}return this},c.Tortoise=n,c.shift=i,c.spin=o,c.polygon=a,c.spiral=l,c.star=s,c.scale=r,t.Logo=c}(window),define("JTopo",function(){}),define("tool/util",["JTopo"],function(){var t,e={ajax:function(t){var e=t||{};if(e.url){var n={url:e.url,type:"POST",data:e.data||"",success:function(t){e.do&&$.isFunction(e.do)&&e.do(t)},error:function(t){e.error&&$.isFunction(e.error)?e.error(t):(console.info("ajax failed"),console.info(t))}};$.ajax(n)}else e.do&&$.isFunction(e.do)&&e.do("")},getParameter:function(t){var e=window.location.search,n=t.length,i=e.indexOf(t);if(i==-1)return"";i+=n+1;var o=e.indexOf("&",i);return o==-1?e.substring(i):e.substring(i,o)},runPrefixMethod:function(t,e){var n;["webkit","moz","ms","o",""].forEach(function(i){if(!n){""===i&&(e=e.slice(0,1).toLowerCase()+e.slice(1));var o=typeof t[i+e];o+""!="undefined"&&(n="function"===o?t[i+e]():t[i+e])}})},launchFullScreen:function(t){t.requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen?t.webkitRequestFullscreen():t.msRequestFullscreen&&t.msRequestFullscreen()},exitFullScreen:function(t){t.exitFullscreen?t.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitExitFullscreen&&t.webkitExitFullscreen()},transHex:function(t){if(t&&7==t.length&&"#"==t.charAt(0)){var e=parseInt(t.substr(1,2),16),n=parseInt(t.substr(3,2),16),i=parseInt(t.substr(5,2),16);return e+","+n+","+i}return t},toggleElemnts:function(t,e){t&&t instanceof Array&&$.each(t,function(t,n){"boolean"==typeof e?e?n.show():n.hide():n.visible?n.hide():n.show()})},arrayPush:function(t,e){return t.indexOf(e)<0&&(t.push(e),!0)},arrayDelete:function(t,e){var n=t.indexOf(e);return n>=0&&(t.splice(n,1),!0)},setAttr:function(t,e){$.each(e,function(e,n){t.prop[e]=n})},inherits:function(t,e){function n(){}var i=t.prototype;n.prototype=e.prototype,t.prototype=new n;for(var o in i)t.prototype[o]=i[o];t.constructor=t},showName:function(t){t.text=t.prop.name},hideName:function(t){t.text=""},deepClone:function(t){function e(t){return null===t?"Null":void 0===t?"Undefined":Object.prototype.toString.call(t).slice(8,-1)}var n,i=e(t);if("Object"===i)n={};else{if("Array"!==i)return t;n=[]}for(key in t){var o=t[key];"Object"==e(o)?n[key]=arguments.callee(o):"Array"==e(o)?n[key]=arguments.callee(o):n[key]=t[key]}return n},getCenterPosition:function(t){return{x:-t.translateX+$(window).width()/2,y:-t.translateY+$(window).height()/2}},nodeFlash:function(t,n){return 0==n?void(t.selected=!1):(t.selected=!t.selected,void setTimeout(function(){e.nodeFlash(t,n-1)},300))},nodeAsCenter:function(t,n){if(n){var i=n.getCenterLocation();t.childs.indexOf(n)>-1&&(t.scaleX=1,t.scaleY=1,t.setCenter(i.x,i.y),e.nodeFlash(n,6))}},getStringWidth:function(e,n){return t||(t=$("span[name=topo_get_string_Width]")),t.text(e),n?t.css("fontSize",n):t.css("fontSize","14px"),t[0].offsetWidth}};return e}),define("element/Link",["tool/util","JTopo"],function(t){function e(){this.visible=!0}function n(){this.visible=!1}function i(t,e){this.prop.num=t,e&&(this.prop.name=e,this.text=e),t>0?this.text="(+"+t+")":this.text=this.prop.name||""}function o(e){this.strokeColor=t.transHex(e.toLowerCase()),this.prop.color=e}function r(t){t?this.alpha=parseInt(t):this.alpha=.1}function a(t){"child"==this.prop.linkType?(this.prop.father.show(),$.each(this.prop.father.prop.children,function(e,n){t.removeElement(n)}),this.prop.father.prop.children=[]):this.prop.num>1&&(this.prop.children=s(this,this.prop.num,t),this.hide())}function s(t,e,n){for(var i,o=[],r=0;r<e;r++)i=new JTopo.Link(t.nodeA,t.nodeZ),l(i,{},"child"),i.prop.father=t,o.push(i),n.addElement(i);return o}function l(e,n,i){var o=n.num||0,r=n.name||"",a=n.id||"",s=n.pid||"",l=n.eweight||1e3,c=n.color||"22,124,255",h=n.arrowSize||null,d=n.arrowOffset||0,u=n.text||(o>0?"(+"+o+")":""),p=n.width||3,f=n.dashedPattern?parseInt(n.dashedPattern):null,m=n.fontSize||16,g=n.font||"微软雅黑",v=n.useType||"normal";e.text=u||r,e.lineWidth=p,e.arrowsRadius=h,e.arrowsOffset=d,e.bundleGap=20,e.textOffsetY=3,e.strokeColor=t.transHex(c.toLowerCase()),e.dashedPattern=f,e.zIndex=100,e.font=m+"px "+g,e.prop={id:a,pid:s,num:o,name:r,color:c,eweight:l,linkType:i,useType:v,sourceArrow:n.sourceArrow||!1,targetArrow:n.targetArrow||!1},e.exprop={}}return $.each(["Link","FoldLink","FlexionalLink","CurveLink"],function(t,s){JTopo[s].prototype.setNum=i,JTopo[s].prototype.setColor=o,JTopo[s].prototype.setAlpha=r,JTopo[s].prototype.show=e,JTopo[s].prototype.hide=n,JTopo[s].prototype.toggleExpend=a}),{directLink:function(t){var e=t||{},n=e.bundleOffset||60,i=new JTopo.Link(t.start,t.end),o=e.linkType||"direct";return l(i,e,o),i.bundleOffset=parseInt(n),i.getStartPosition=function(){var t;return null!=this.arrowsRadius&&(t=function(t){var e=t.nodeA,n=t.nodeZ,i=JTopo.util.lineF(e.cx,e.cy,n.cx,n.cy),o=e.getBound();return f=JTopo.util.intersectionLineBound(i,o)}(this)),null==t&&(t={x:this.nodeA.cx,y:this.nodeA.cy}),t},i.paintPath=function(t,e){if(this.nodeA===this.nodeZ)return void this.paintLoop(t);t.beginPath(),t.moveTo(e[0].x,e[0].y);for(var n=1;n<e.length;n++)null==this.dashedPattern?null==this.PointPathColor?t.lineTo(e[n].x,e[n].y):t.JtopoDrawPointPath(e[n-1].x,e[n-1].y,e[n].x,e[n].y,t.strokeStyle,this.PointPathColor):t.JTopoDashedLineTo(e[n-1].x,e[n-1].y,e[n].x,e[n].y,this.dashedPattern);t.stroke(),t.closePath(),null!=this.arrowsRadius&&(this.prop.targetArrow&&this.paintArrow(t,e[0],e[e.length-1]),this.prop.sourceArrow&&this.paintArrow(t,e[e.length-1],e[0]))},i},foldLink:function(t){var e=t||{},n=new JTopo.FoldLink(t.start,t.end),i=e.linkType||"fold";return l(n,t,i),n.direction=e.direction||"horizontal",n.paintPath=function(t,e){if(this.nodeA===this.nodeZ)return void this.paintLoop(t);t.beginPath(),t.moveTo(e[0].x,e[0].y);for(var n=1;n<e.length;n++)null==this.dashedPattern?t.lineTo(e[n].x,e[n].y):t.JTopoDashedLineTo(e[n-1].x,e[n-1].y,e[n].x,e[n].y,this.dashedPattern);t.stroke(),t.closePath(),null!=this.arrowsRadius&&(this.prop.targetArrow&&this.paintArrow(t,e[e.length-2],e[e.length-1]),this.prop.sourceArrow&&this.paintArrow(t,e[1],e[0]))},n},flexionalLink:function(t){var e=t||{},n=e.offsetGap||60,i=new JTopo.FlexionalLink(t.start,t.end),o=e.linkType||"flexional";return l(i,e,o),i.direction=e.direction||"horizontal",i.offsetGap=parseInt(n),i.paintPath=function(t,e){if(this.nodeA===this.nodeZ)return void this.paintLoop(t);t.beginPath(),t.moveTo(e[0].x,e[0].y);for(var n=1;n<e.length;n++)null==this.dashedPattern?t.lineTo(e[n].x,e[n].y):t.JTopoDashedLineTo(e[n-1].x,e[n-1].y,e[n].x,e[n].y,this.dashedPattern);t.stroke(),t.closePath(),null!=this.arrowsRadius&&(this.prop.targetArrow&&this.paintArrow(t,e[e.length-2],e[e.length-1]),this.prop.sourceArrow&&this.paintArrow(t,e[1],e[0]))},i},CurveLink:function(t){var e=t||{},n=new JTopo.CurveLink(t.start,t.end),i=e.linkType||"curve";return l(n,e,i),n.prop.cureOffset=t.cureOffset||200,n.getStartPosition=function(){var t;return t=function(t){var e=t.nodeA,n=t.nodeZ,i=JTopo.util.lineF(e.cx,e.cy,n.cx,n.cy),o=e.getBound();return f=JTopo.util.intersectionLineBound(i,o)}(this)},n.getEndPosition=function(){var t;return t=function(t){var e=t.nodeZ,n=t.nodeA,i=JTopo.util.lineF(e.cx,e.cy,n.cx,n.cy),o=e.getBound();return f=JTopo.util.intersectionLineBound(i,o)}(this)},n.paintPath=function(t,e){if(this.nodeA===this.nodeZ)return void this.paintLoop(t);var n=e[0],i=e[e.length-1];t.beginPath(),t.moveTo(n.x,n.y);var o=Math.atan(Math.abs(i.y-n.y)/Math.abs(i.x-n.x)),r=(n.x+i.x)/2+this.prop.cureOffset*Math.cos(o-Math.PI/2),a=(n.y+i.y)/2+this.prop.cureOffset*Math.sin(o-Math.PI/2);t.strokeStyle="rgba("+this.strokeColor+","+this.alpha+")",t.lineWidth=this.lineWidth,t.moveTo(n.x,n.cy),t.quadraticCurveTo(r,a,i.x,i.y),t.stroke(),t.stroke(),t.closePath(),null!=this.arrowsRadius&&(this.prop.targetArrow&&this.paintArrow(t,n,i),this.prop.sourceArrow&&this.paintArrow(t,i,n))},n}}}),define("element/Node",["tool/util","JTopo"],function(t){function e(){this.visible=!0}function n(){this.visible=!1}function i(t){t?(this.alpha=parseInt(t),this.alarmAlpha=parseInt(t)):(this.alpha=.1,this.alarmAlpha=.1)}function o(t,e){function n(t,e){t.prop.flash&&clearInterval(t.prop.flash),t.prop.flash=setInterval(function(){e?(t.shadowBlur+=10,t.shadowBlur>=100&&(e=!1)):(t.shadowBlur-=10,t.shadowBlur<=10&&(e=!0))},100)}t.shadow=!0,t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor="rgba("+e+",1)",t.shadowBlur=10,n(t,!0)}$.each(["Node","TextNode"],function(t,o){JTopo[o].prototype.setAlpha=i,JTopo[o].prototype.show=e,JTopo[o].prototype.hide=n}),JTopo.Node.prototype.setNodeImage=function(t){this.setImage(t),this.prop.image=t},JTopo.Node.prototype.setTextPosition=function(t){switch(this.textPosition=t,this.prop.textPosition=t,this.text=this.prop.name,t){case"Hidden":this.text="";break;case"Bottom_Center":this.textOffsetX=0,this.textOffsetY=0;break;case"Top_Center":this.textOffsetX=0,this.textOffsetY=0;break;case"Middle_Left":this.textOffsetX=-5,this.textOffsetY=0;break;case"Middle_Right":this.textOffsetX=5,this.textOffsetY=0}},JTopo.TextNode.prototype.setFontColor=function(e){this.fontColor=t.transHex(e.toLowerCase()),this.prop.fontColor=e},JTopo.TextNode.prototype.setFont=function(t,e){e?(this.font=t+"px "+e,this.prop.font=e):this.font=t+"px "+this.prop.font,this.prop.fontSize=t},JTopo.Node.prototype.drawAlarm=function(e){if(this.prop.scene){var n=this.prop.scene.prop.config,i=e.color?e.color.toLowerCase():this.prop.alarmLevel?n.alarm.color[this.prop.alarmLevel-1]:"0,0,255";this.alarm=e.text||this.alarm||"No Alarm Text!",this.alarmColor=t.transHex(i),this.alarmAlpha=1,this.alarmFont=(e.size||20)+"px "+(e.font||"微软雅黑"),this.prop.alarmLevel=e.level||this.prop.alarmLevel||n.alarm.color.length,this.prop.alarmColor=i,o(this,this.alarmColor)}};var r={Segment:100,"ztype.shape":1e5,"ztype.text":1e6,"ztype.url":1e7,"ztype.topo":1e8,"ztype.layer":1e9,"ztype.view":1e11,"ztype.obj":1e13,"ztype.grid":1e14};return{createNode:function(e){var n=e||{},i=new JTopo.Node,o=n.name||"node",a=n.image||"img/mo/wlan_4.png",s=n.width?n.width:64,l=n.height?n.height:64,c=n.alpha||1,h=n.x||0,d=n.y||0,u=n.fontSize||16,p=n.font||"微软雅黑",f=n.zIndex||200,m=n.id||"",g=n.pid||"",v=n.color||a||JTopo.util.randomColor(),b=n.textPosition||"Bottom_Center",y=n.nodeType||"node",w=n.text||"",x=n.eweight||r[y]||10;return i.font=u+"px "+p,i.text=w,i.setLocation(h,d),i.setImage(a),i.zIndex=f,i.alpha=c,i.setSize(s,l),i.fillColor=t.transHex(v.toLowerCase()),i.prop={id:m,pid:g,name:o,image:a,nodeType:y,eweight:x},i.setTextPosition(b),i.exprop={},i},createTextNode:function(e){var n=e||{},i=new JTopo.TextNode,o=n.x||0,a=n.y||0,s=n.fontSize||20,l=n.font||"微软雅黑",c=n.zIndex||200,h=n.alpha||1,d=n.id||"",u=n.pid||"",p=n.name||"",f=n.text||"no text here",m=n.nodeType||"text",g=n.eweight||r[m]||1e6,v=n.fontColor||"255,255,255";return i.text=f,i.setLocation(o,a),i.zIndex=c,i.alpha=h,i.font=s+"px "+l,i.fontColor=t.transHex(v.toLowerCase()),i.prop={id:d,pid:u,name:p,font:l,fontSize:s,fontColor:v,nodeType:m,eweight:g},i.exprop={},i},createShape:function(t){var e=t||{},n=new JTopo.Node,i=e.width>0?e.width:100,o=e.height>0?e.height:50,a=e.x||0,s=e.y||0,l=e.fontSize||20,c=e.font||"微软雅黑",h=e.id||"",d=e.pid||"",u=e.name||"",p=e.text||"",f=e.zIndex||150,m=e.alpha||.8,g="rgba("+(e.color?e.color:"55,180,74")+","+m+")",v=e.nodeType||"object",b=e.eweight||r[v]||1e5,y=e.textPosition||"Bottom_Center";return n.text=p,n.setLocation(a,s),n.setSize(i,o),n.zIndex=f,n.font=l+"px "+c,n.showSelected=!0,n.dragable=!0,n.editAble=!0,n.paint=function(t){var e=this.width/2,n=this.height/2,i=.5*e,o=.6*n;t.save(),t.beginPath(),t.moveTo(0,n),t.bezierCurveTo(i,n,e,o,e,0),t.bezierCurveTo(e,-o,i,-n,0,-n),t.bezierCurveTo(-i,-n,-e,-o,-e,0),t.bezierCurveTo(-e,o,-i,n,0,n),t.closePath(),t.fillStyle=g,t.fill(),t.restore(),this.paintText(t)},n.prop={id:h,pid:d,name:u,nodeType:v,eweight:b},n.setTextPosition(y),n.exprop={},n}}}),define("element/Container",["tool/util","element/Node","element/Link","JTopo"],function(t,e,n){function i(t){r.call(this,t)}var o,r=JTopo.Container,a=function(t,e){if(e.length>0){for(var n=1e7,i=-1e7,o=1e7,r=-1e7,a=i-n,s=r-o,l=0;l<e.length;l++){var c=e[l];c.x<=n&&(n=c.x),c.x+c.width>=i&&(i=c.x+c.width),c.y<=o&&(o=c.y),c.y+c.height>=r&&(r=c.y+c.height),a=i-n,s=r-o}t.x=n,t.y=o,t.width=a,t.height=s}};return t.inherits(i,r),i.prototype.addNode=function(t){"container"==t.prop.nodeType||t.prop.container||(t.prop.container=this,this.setMember(t),this.add(t))},i.prototype.removeNode=function(e){e.prop.container=null,e.setTextPosition(e.textPosition),t.toggleElemnts(e.inLinks,!0),t.toggleElemnts(e.outLinks,!0),this.remove(e)},i.prototype.isInside=function(t){var e=t.x+t.width/2,n=t.y+t.height/2;return!this.isChild(t)&&e>this.x&&e<this.x+this.width&&n>this.y&&n<this.y+this.height},i.prototype.isChild=function(t){return t&&t.prop.container&&t.prop.container==this},i.prototype.setAttr=function(e){t.setAttr(this,e),t.setAttr(this.prop.containerNode,e)},i.prototype.setName=function(t){this.text=t,this.prop.name=t,this.prop.containerNode.text=t,this.prop.containerNode.prop.name=t},i.prototype.setTextPosition=function(e){switch(this.textPosition=e,this.prop.textPosition=e,this.text=this.prop.name,e){case"Hidden":this.text="";break;case"Bottom_Center":this.textOffsetX=0,this.textOffsetY=20;break;case"Top_Center":this.textOffsetX=0,this.textOffsetY=-20;break;case"Middle_Left":this.textOffsetX=-t.getStringWidth(this.prop.name,this.font.substring(0,this.font.indexOf("px"))+"px")-20,this.textOffsetY=0;break;case"Middle_Right":this.textOffsetX=t.getStringWidth(this.prop.name,this.font.substring(0,this.font.indexOf("px"))+"px")+20,this.textOffsetY=0}this.prop.containerNode.setTextPosition(e)},i.prototype.setImage=function(t){this.prop.image=t,this.prop.containerNode.setNodeImage(t)},i.prototype.setLayout=function(t){var e;if(t){switch(t.type){case"flow":e=JTopo.layout.FlowLayout(t.row,t.column);break;case"grid":e=JTopo.layout.GridLayout(t.row,t.column)}this.prop.layoutType=t.type,this.prop.layoutRow=t.row,this.prop.layoutColumn=t.column}else e=a,this.prop.layoutType="set";this.layout=e},i.prototype.hide=function(){$.each(this.childs,function(e,n){t.toggleElemnts(n.inLinks,!1),t.toggleElemnts(n.outLinks,!1),n.hide()}),t.toggleElemnts(this.inLinks,!1),t.toggleElemnts(this.outLinks,!1),this.visible=!1},i.prototype.show=function(){var e=this;$.each(this.childs,function(t,n){e.setMember(n)}),t.toggleElemnts(this.inLinks,!0),t.toggleElemnts(this.outLinks,!0),this.visible=!0},i.prototype.getChildren=function(t){var e=[];return t&&$.isFunction(t)?$.each(this.childs,function(n,i){t(i)&&e.push(i)}):e=this.childs,e},i.prototype.setMember=function(e){var n=this;this.prop.setMember.showName?e.setTextPosition("Bottom_Center"):e.setTextPosition("Hidden"),this.prop.setMember.showLink?(t.toggleElemnts(e.inLinks,!0),t.toggleElemnts(e.outLinks,!0)):(e.inLinks&&$.each(e.inLinks,function(t,e){n.isChild(e.nodeA)?e.hide():e.show()}),e.outLinks&&$.each(e.outLinks,function(t,e){n.isChild(e.nodeZ)?e.hide():e.show()})),e.show()},i.prototype.toggleExpand=function(){var t=this;t.prop.isExpand?(t.hide(),t.prop.containerNode.show(),t.prop.containerNode.setLocation(t.x+t.width/2,t.y+t.height/2),t.prop.isExpand=!1):(t.show(),t.prop.containerNode.hide(),t.setLocation(t.prop.containerNode.x-t.width/2,t.prop.containerNode.y-t.height/2),t.prop.isExpand=!0)},{create:function(n,r){var a=n||{},s=a.name||"",l=a.id||"",c=a.pid||"",h=(a.fontSize||"30px")+" "+(a.font||"微软雅黑"),d=a.fontColor?t.transHex(a.fontColor):"255,255,255",u=a.fillColor?t.transHex(a.fillColor):"10,10,100",p=a.alpha||.5,f="boolean"!=typeof a.childDragble||a.dragable,m="boolean"!=typeof a.dragable||a.dragable,g=a.zIndex||10,v=a.borderWidth||0,b=a.borderRadius||30,y=a.borderColor||"255,0,0",w=a.image||"img/mo/wlan_4.png",x=a.textPosition||"Bottom_Center",k=a.eweight||1e4,_=new i(s),T=a.layout,E="boolean"==typeof a.showLink&&a.showLink,C="boolean"!=typeof a.showName||a.showName;o=r,_.fillColor=u,_.fontColor=d,_.font=h,_.borderColor=y,_.borderWidth=v,_.borderRadius=b,_.dragable=m,_.childDragble=f,_.alpha=p,_.zIndex=g;var P=e.createNode({name:s,text:s,id:l,pid:c,image:w,nodeType:"container",eweight:k});return P.prop.expandTo=_,P.hide(),_.prop={id:l,pid:c,name:s,eweight:k,isExpand:!0,image:w,containerNode:P,setMember:{showLink:E,showName:C}},_.setLayout(T),_.setTextPosition(x),_.exprop={},_}}}),define("resource/js/require/plugins/text",["module"],function(t){"use strict";var e,n,i,o,r,a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],s=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,c="undefined"!=typeof location&&location.href,h=c&&location.protocol&&location.protocol.replace(/\:/,""),d=c&&location.hostname,u=c&&(location.port||void 0),p={},f=t.config&&t.config()||{};return e={version:"2.0.14",strip:function(t){if(t){t=t.replace(s,"");var e=t.match(l);e&&(t=e[1])}else t="";return t},jsEscape:function(t){return t.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:f.createXhr||function(){var t,e,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(e=0;e<3;e+=1){n=a[e];try{t=new ActiveXObject(n)}catch(t){}if(t){a=[n];break}}return t},parseName:function(t){var e,n,i,o=!1,r=t.lastIndexOf("."),a=0===t.indexOf("./")||0===t.indexOf("../");
return r!==-1&&(!a||r>1)?(e=t.substring(0,r),n=t.substring(r+1)):e=t,i=n||e,r=i.indexOf("!"),r!==-1&&(o="strip"===i.substring(r+1),i=i.substring(0,r),n?n=i:e=i),{moduleName:e,ext:n,strip:o}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(t,n,i,o){var r,a,s,l=e.xdRegExp.exec(t);return!l||(r=l[2],a=l[3],a=a.split(":"),s=a[1],a=a[0],!(r&&r!==n||a&&a.toLowerCase()!==i.toLowerCase()||(s||a)&&s!==o))},finishLoad:function(t,n,i,o){i=n?e.strip(i):i,f.isBuild&&(p[t]=i),o(i)},load:function(t,n,i,o){if(o&&o.isBuild&&!o.inlineText)return void i();f.isBuild=o&&o.isBuild;var r=e.parseName(t),a=r.moduleName+(r.ext?"."+r.ext:""),s=n.toUrl(a),l=f.useXhr||e.useXhr;return 0===s.indexOf("empty:")?void i():void(!c||l(s,h,d,u)?e.get(s,function(n){e.finishLoad(t,r.strip,n,i)},function(t){i.error&&i.error(t)}):n([a],function(t){e.finishLoad(r.moduleName+"."+r.ext,r.strip,t,i)}))},write:function(t,n,i,o){if(p.hasOwnProperty(n)){var r=e.jsEscape(p[n]);i.asModule(t+"!"+n,"define(function () { return '"+r+"';});\n")}},writeFile:function(t,n,i,o,r){var a=e.parseName(n),s=a.ext?"."+a.ext:"",l=a.moduleName+s,c=i.toUrl(a.moduleName+s)+".js";e.load(l,i,function(n){var i=function(t){return o(c,t)};i.asModule=function(t,e){return o.asModule(t,c,e)},e.write(t,l,i,r)},r)}},"node"===f.env||!f.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"]?(n=require.nodeRequire("fs"),e.get=function(t,e,i){try{var o=n.readFileSync(t,"utf8");"\ufeff"===o[0]&&(o=o.substring(1)),e(o)}catch(t){i&&i(t)}}):"xhr"===f.env||!f.env&&e.createXhr()?e.get=function(t,n,i,o){var r,a=e.createXhr();if(a.open("GET",t,!0),o)for(r in o)o.hasOwnProperty(r)&&a.setRequestHeader(r.toLowerCase(),o[r]);f.onXhr&&f.onXhr(a,t),a.onreadystatechange=function(e){var o,r;4===a.readyState&&(o=a.status||0,o>399&&o<600?(r=new Error(t+" HTTP status: "+o),r.xhr=a,i&&i(r)):n(a.responseText),f.onXhrComplete&&f.onXhrComplete(a,t))},a.send(null)}:"rhino"===f.env||!f.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?e.get=function(t,e){var n,i,o="utf-8",r=new java.io.File(t),a=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),o)),l="";try{for(n=new java.lang.StringBuffer,i=s.readLine(),i&&i.length()&&65279===i.charAt(0)&&(i=i.substring(1)),null!==i&&n.append(i);null!==(i=s.readLine());)n.append(a),n.append(i);l=String(n.toString())}finally{s.close()}e(l)}:("xpconnect"===f.env||!f.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(i=Components.classes,o=Components.interfaces,Components.utils.import("resource://gre/modules/FileUtils.jsm"),r="@mozilla.org/windows-registry-key;1"in i,e.get=function(t,e){var n,a,s,l={};r&&(t=t.replace(/\//g,"\\")),s=new FileUtils.File(t);try{n=i["@mozilla.org/network/file-input-stream;1"].createInstance(o.nsIFileInputStream),n.init(s,1,0,!1),a=i["@mozilla.org/intl/converter-input-stream;1"].createInstance(o.nsIConverterInputStream),a.init(n,"utf-8",n.available(),o.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),a.readString(n.available(),l),a.close(),n.close(),e(l.value)}catch(t){throw new Error((s&&s.path||"")+": "+t)}}),e}),define("resource/js/require/plugins/text!template/toolbar.html",[],function(){return"<div name=\"topo_toolbar_template\">\r\n    <div name='topo_toolbar' class='panel panel-default'>\r\n        <div class='panel-body'>\r\n            <div class='btn-group'>\r\n                <button name='return' type='button' class='btn btn-sm btn-primary' data-toggle='tooltip'\r\n                        title='返回' data-placement='bottom'>\r\n                    <span class='glyphicon glyphicon-share-alt'></span>\r\n                </button>\r\n                <div class='btn-group' data-toggle='buttons'>\r\n                    <label class='btn btn-sm btn-primary' name='topo_mode' data-toggle='tooltip' title='平移'\r\n                           data-placement='bottom'>\r\n                        <input type='radio' value='drag'>\r\n                        <span class='glyphicon glyphicon-log-out'></span>\r\n                    </label>\r\n                    <label class='btn btn-sm btn-primary' name='topo_mode' data-toggle='tooltip' title='框选'\r\n                           data-placement='bottom'>\r\n                        <input type='radio' value='select'>\r\n                        <span class='glyphicon glyphicon-check'></span>\r\n                    </label>\r\n                    <label class='btn btn-sm btn-primary' name='topo_mode' data-toggle='tooltip' title='编辑'\r\n                           data-placement='bottom'>\r\n                        <input type='radio' value='edit'><span class='glyphicon glyphicon-edit'></span>\r\n                    </label>\r\n                </div>\r\n                <button name='full_screen' type='button' class='btn btn-sm btn-primary' data-toggle='button;tooltip'\r\n                        title='全屏' data-placement='bottom'>\r\n                    <span class='glyphicon glyphicon-fullscreen'></span>\r\n                </button>\r\n                <button name='center' type='button' class='btn btn-sm btn-primary' data-toggle='tooltip'\r\n                        title='居中缩放' data-placement='bottom'>\r\n                    <span class='glyphicon glyphicon-screenshot'></span>\r\n                </button>\r\n                <button name='common' type='button' class='btn btn-sm btn-primary'\r\n                        data-toggle='tooltip'\r\n                        title='正常展示' data-placement='bottom'>\r\n                    <span class='glyphicon glyphicon-move'></span>\r\n                </button>\r\n                <button name='zoom_checkbox' type='button' class='btn btn-sm btn-primary'\r\n                        data-toggle='button;tooltip'\r\n                        title='鼠标缩放' data-placement='bottom'>\r\n                    <span class='glyphicon glyphicon-resize-small'></span>\r\n                </button>\r\n                <button name='zoom_out' type='button' class='btn btn-sm btn-primary' data-toggle='tooltip'\r\n                        title='放大'\r\n                        data-placement='bottom'>\r\n                    <span class='glyphicon glyphicon-zoom-in'></span>\r\n                </button>\r\n                <button name='zoom_in' type='button' class='btn btn-sm btn-primary' data-toggle='tooltip'\r\n                        title='缩小'\r\n                        data-placement='bottom'>\r\n                    <span class='glyphicon glyphicon-zoom-out'></span>\r\n                </button>\r\n                <button name='export_image' type='button' class='btn btn-sm btn-primary' data-toggle='tooltip'\r\n                        title='导出PNG' data-placement='bottom'>\r\n                    <span class='glyphicon glyphicon-picture'></span>\r\n                </button>\r\n                <button name='print' type='button' class='btn btn-sm btn-primary' data-toggle='tooltip'\r\n                        title='打印' data-placement='bottom'>\r\n                    <span class='glyphicon glyphicon-print'></span>\r\n                </button>\r\n                <button name='eagle_eye' type='button' class='btn btn-sm btn-primary'\r\n                        data-toggle='button;tooltip'\r\n                        title='鹰眼' data-placement='bottom'>\r\n                    <span class='glyphicon glyphicon-eye-open'></span>\r\n                </button>\r\n                <div class='input-group input-group-sm'>\r\n                    <select name='search_mode' class='form-control'>\r\n                    </select>\r\n                    <input name='search_text' type='text' class='form-control' placeholder='属性搜索为key=value'>\r\n                    <span class='input-group-btn'>\r\n                        <button name='search' class='btn btn-primary' type='button' data-toggle='tooltip' title='搜索' data-placement='bottom'>\r\n                            <span class='glyphicon glyphicon-search'></span>\r\n                        </button>\r\n                    </span>\r\n                </div>\r\n                <select name='search_result' class='form-control' placeholder=\"请选择\">\r\n                </select>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <div name='topo_toolbar_child' class='panel panel-default'>\r\n        <div class='panel-body'>\r\n            <div class='btn-group'>\r\n                <button name='auto_layout' type='button' class='btn btn-xs btn-primary' data-toggle='button;tooltip'\r\n                        title='自动布局'\r\n                        data-placement='bottom'><span class='glyphicon glyphicon-th'></span></button>\r\n                <button name='create_image' type='button' class='btn btn-xs btn-primary' data-toggle='button;tooltip'\r\n                        title='创建图片对象'\r\n                        data-placement='bottom'><span class='glyphicon glyphicon-picture'></span></button>\r\n                <button name='create_text' type='button' class='btn btn-xs btn-primary' data-toggle='button;tooltip'\r\n                        title='创建文本对象'\r\n                        data-placement='bottom'><span class='glyphicon glyphicon-font'></span></button>\r\n                <button name='create_link' type='button' class='btn btn-xs btn-primary' data-toggle='button;tooltip'\r\n                        title='创建链接'\r\n                        data-placement='bottom'><span class='glyphicon glyphicon-sort'></span></button>\r\n                <button name='create_line' type='button' class='btn btn-xs btn-primary' data-toggle='button;tooltip'\r\n                        title='画线对象'\r\n                        data-placement='bottom'><span class='glyphicon glyphicon-pencil'></span></button>\r\n                <button name='edit_save' type='button' class='btn btn-xs btn-primary' data-toggle='tooltip' title='保存'\r\n                        data-placement='bottom'><span class='glyphicon glyphicon-floppy-saved'></span></button>\r\n                <button name='draw_alarm' type='button' class='btn btn-xs btn-primary' data-toggle='button;tooltip'\r\n                        title='告警渲染'\r\n                        data-placement='bottom'><span class='glyphicon glyphicon-warning-sign'></span></button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>"}),define("resource/js/require/plugins/text!template/toolWindow.html",[],function(){return'<div name="topo_toolWindow_template">\r\n    <span name="topo_get_string_Width"></span>\r\n    <div name="topo_confirm" class="modal fade">\r\n        <div class="modal-dialog">\r\n            <div class="modal-content">\r\n                <div class="modal-header">\r\n                    <h4 name="title" class="modal-title">提示框</h4>\r\n                </div>\r\n                <div class="modal-body">\r\n                </div>\r\n                <div class="modal-footer">\r\n                    <button name="ok" type="button" class="btn btn-default">确定</button>\r\n                    <button name="cancel" type="button" class="btn btn-default">关闭</button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div name="topo_alert" class="modal fade">\r\n        <div class="modal-dialog">\r\n            <div class="modal-content">\r\n                <div class="modal-header">\r\n                    <h4 name="title" class="modal-title">提示框</h4>\r\n                </div>\r\n                <div class="modal-body">\r\n                </div>\r\n                <div class="modal-footer">\r\n                    <button name="ok" type="button" class="btn btn-default">确定</button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div name="topo_tips" class="panel panel-default">\r\n        <div class="panel-heading"></div>\r\n        <div class="panel-body"></div>\r\n        <div class="panel-footer"></div>\r\n    </div>\r\n    <div name="topo_progress" class="modal">\r\n        <div class="modal-dialog">\r\n            <div class="modal-content">\r\n                <div class="progress">\r\n                    <div class="progress-bar progress-bar-info progress-bar-striped active" role="progressbar" style="width: 10%">\r\n                        10%\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("window/toolWindow",["text!template/toolWindow.html"],function(t){var e=$(t),n=e.find("div[name=topo_confirm]"),i=e.find("div[name=topo_alert]"),o=e.find("div[name=topo_tips]").hide(),r=e.find("div[name=topo_progress]");$("body").append(e);var a=r.find(".progress-bar");r.modal({keyboard:!1,backdrop:"static",show:!0});var s=n.find(".modal-body"),l=n.find("[name=title]"),c=n.find("[name=ok]"),h=n.find("[name=cancel]"),d=n.find(".modal-content");c.on("click",function(){n.modal("hide")}),h.on("click",function(){n.modal("hide")});var u=i.find(".modal-body"),p=i.find("[name=title]"),f=i.find("[name=ok]"),m=i.find(".modal-content");f.on("click",function(){i.modal("hide")});var g=o.find(".panel-heading"),v=o.find(".panel-body"),b=o.find(".panel-footer");return{confirm:function(t){function e(t){i.handler(t.data.flag),c.off("click",e),h.off("click",e)}var i=t||{},o=i.title||"操作框",r=i.content||"",a=i.width||"500",u=(500-a)/2;l.html(o),s.html(r),n.modal({keyboard:!1,backdrop:"static",show:!0}),i.handler&&$.isFunction(i.handler)&&(c.on("click",{flag:!0},e),h.on("click",{flag:!1},e)),d.css({width:a,left:$(window).width()>500?u:0})},alert:function(t){var e=t||{},n=e.title||"提示框",o=e.content||"",r=e.width||"500",a=(500-r)/2;p.html(n),u.html(o),i.modal({show:!0}),m.css({width:r,left:$(window).width()>500?a:0})},tips:function(t){var e=t||{},n=e.title,i=e.foot,r=e.x,a=e.y,s=e.width||200,l=e.content||"";n?(g.show(),g.html(n)):g.hide(),i?(b.show(),b.html(i)):b.hide(),l?(v.show(),v.html(l),o.css({left:r,top:a,width:s}).show()):(v.hide(),o.hide())},progress:function(t){if(t){var e=t.now,n=t.text,i=t.error,o=1e3;e>=0&&e<=100?(i?(a.removeClass("progress-bar-info").addClass("progress-bar-danger"),o=1e3):a.removeClass("progress-bar-danger").addClass("progress-bar-info"),a.css({width:e+"%"}),a.html(n),r.modal({keyboard:!1,backdrop:"static",show:!0}),100==e&&setTimeout(function(){r.modal("hide")},o)):r.modal("hide")}else r.modal("hide")}}}),define("window/base",[],function(){var t={defaultPosition:{right:"auto",left:0,top:"25%",bottom:"auto"},mutex:[],moveable:function(e,n){n.movement=!1,e.mousedown(function(t){t.stopPropagation(),n.movePageX=t.pageX-n.offset().left,n.movePageY=t.pageY-n.offset().top,n.movement=!0}),e.mouseup(function(t){t.stopPropagation(),n.movement=!1}),$("body").mousemove(function(t){t.stopPropagation(),n.movement&&n.css({left:t.pageX-n.movePageX,top:t.pageY-n.movePageY})}),t.mutex.push(n),n.show=function(){$(n).show(),$.each(t.mutex,function(t,e){n!=e&&"none"!=e.css("display")&&e.find(".close").click()})}},resetHide:function(t,e){$.each(t,function(t,n){n.hide=function(){e[t].hide()},n.show=function(){e[t].show()}})},resizeNum:function(t,e){var n=e||{},i=t.find("[name*=num]"),o=t.find("[name*=up]"),r=t.find("[name*=down]"),a=n.bottom,s=n.top,l=n.step||2;o.on("click",function(){var t=parseInt(i.val(),10)||0;"number"==typeof s?t<s&&i.val(t+l):i.val(t+l)}),r.on("click",function(){var t=parseInt(i.val(),10)||0;"number"==typeof a?t>a&&i.val(t-l):i.val(t-l)})},colorSelect:function(t,e){e.colorPalette().on("selectColor",function(e){t.val(e.color)})},toggleClick:function(t,e,n){t.click(function(){t._isClick?(t.find("span").removeClass(n).addClass(e),t._isClick=!1):(t.find("span").removeClass(e).addClass(n),t._isClick=!0)})},makeImageBtn:function(t,e){var n="<label class='btn  btn-primary col-md-2'><input type='radio'><img src='"+e+"'></label>";t.append(n)},setPercent:function(t,e){t.html(e+"%"),t.css({width:e+"%"})},progressClick:function(e,n){e.click(function(i){var o=10*i.offsetX/e.width();o>9.6&&(o=10);var r=parseInt(o);n.percent=10*r,t.setPercent(n,10*r)})},initSelect:function(t,e){t.item=[],t.addItems=function(e){e&&(e instanceof Array?$.each(e,function(e,n){t.append("<option value='"+n.value+"'>"+n.name+"</option>"),t.item.push(n)}):(t.append("<option value='"+e.value+"'>"+e.name+"</option>"),t.item.push(e)))},t.change(function(){$.each(t.item,function(n,i){if(i.value==t.val())return t.mode=i,i.onChose&&$.isFunction(i.onChose)&&i.onChose(e),t.baseChose&&t.baseChose(t.val()),!1})}),t.triggerBtn=function(n){n.click(function(){$.each(t.item,function(n,i){i.value==t.val()&&i.do&&i.do(e)})})}}};return t}),define("window/toolbar",["text!template/toolbar.html","window/toolWindow","tool/util","window/base","element/Link"],function(t,e,n,i,o){var r=$(t);return{init:function(t){function n(t,e){var n="<option value='"+e.value+"'>"+e.name+"</option>";t.append(n),t.item.push(e)}function o(t){$.each(t,function(t,e){n(_,e)})}function a(){_.item=[],_.html(""),n(_,{name:"请选择结果",value:"default"})}var s=r.find("div[name=topo_toolbar]"),l=r.find("div[name=topo_toolbar_child]").hide();$("body").append(r);var c=s.find("button[name=return]"),h=s.find("label[name=topo_mode]"),d=s.find("button[name=full_screen]"),u=s.find("button[name=center]"),p=s.find("button[name=common]"),f=s.find("button[name=zoom_checkbox]"),m=s.find("button[name=zoom_in]"),g=s.find("button[name=zoom_out]"),v=s.find("button[name=export_image]"),b=s.find("button[name=print]"),y=s.find("button[name=eagle_eye]"),w=s.find("select[name=search_mode]"),x=s.find("input[name=search_text]"),k=s.find("button[name=search]"),_=s.find("select[name=search_result]").hide(),T=l.find("button[name=auto_layout]"),E=l.find("button[name=create_image]"),C=l.find("button[name=create_text]"),P=l.find("button[name=create_link]"),L=l.find("button[name=create_line]"),I=l.find("button[name=edit_save]"),S=l.find("button[name=draw_alarm]"),M="glyphicon-remove-sign",A=s.find("label[name='topo_mode'][title='编辑']");return s.find("[data-toggle*='tooltip']").tooltip(),l.find("[data-toggle*='tooltip']").tooltip(),$(window).resize(function(){var t=A.offset().left+17-l.width()/2,e=s.offset().top+s.height()+2;l.css({left:t,top:e})}),h.click(function(){if(h.mode=$(this).find("input").val(),"edit"==h.mode){var t=A.offset().left+17-l.width()/2,e=s.offset().top+s.height()+2;l.css({left:t,top:e}),l.show()}else l.hide()}),i.toggleClick(d,"glyphicon-fullscreen",M),i.toggleClick(f,"glyphicon-resize-small",M),i.toggleClick(y,"glyphicon-eye-open","glyphicon-eye-close"),x.keydown(function(t){13==t.keyCode&&k.click()}),i.toggleClick(T,"glyphicon-th",M),i.toggleClick(E,"glyphicon-picture",M),i.toggleClick(C,"glyphicon-font",M),i.toggleClick(L,"glyphicon-pencil",M),i.toggleClick(P,"glyphicon-sort",M),i.toggleClick(S,"glyphicon-warning-sign",M),w.item=[],w.change(function(){var t=this;$.each(w.item,function(e,n){if(n.value==t.value)return w.mode=n,!1})}),_.change(function(){var t=this;"default"!=t.value&&$.each(_.item,function(e,n){if(n.value==t.value)return n.event(),_.hide(),!1})}),{hide:function(){s.hide(),l.hide()},show:function(){s.show(),"edit"==h.mode&&l.show()},setMode:function(t){h.find("input[value="+t+"]").click()},addSearchMode:function(t){t instanceof Array?$.each(t,function(t,e){n(w,e)}):n(w,t)},doSearch:function(){var t=x.val().trim();if(""==t)return void e.alert({content:"<h4>输入不能为空！</h4>",width:300});a();var n={},i=[],r=w.mode||w.item[0];r.search&&(n=r.search(t)),n.results&&n.results.length>0?($.each(n.results,function(t,e){i.push({name:e.prop.name+" | "+(e.prop.content||"")+"(该图层)",value:i.length,event:function(){n.event(e)}})}),o(i),_.show()):r.deepSearch?(n=r.deepSearch(t),$.ajax({url:n.url,type:"POST",success:function(t){$.each(n.filter(t),function(t,e){i.push({name:e.prop.name+" | "+(e.prop.content||""),value:i.length,event:function(){n.event(e)}})}),i.length>0?(o(i),_.show()):e.alert({content:"<h3> 无查询结果！</h3>",width:300})},error:function(t){e.alert({content:"<h3>查询失败!若未登陆请登录后再试！</h3>",width:300})}})):e.alert({content:"<h3> 无查询结果！</h3>",width:300})},fatherBar:s,edit_childBar:l,returnBtn:c,modeBtns:h,fullScreen:d,centerBtn:u,commonBtn:p,zoomIn:m,zoomOut:g,zoomCheck:f,exportImg:v,printBtn:b,eagleEye:y,searchInput:x,searchBtn:k,edit_autoLayout:T,edit_createImage:E,edit_createText:C,edit_createLink:P,edit_createLine:L,edit_save:I,edit_alarm_config:S}}}}),define("resource/js/require/plugins/text!template/nodeAttribute.html",[],function(){return'<div name="topo_node_template">\r\n    <!--图片节点窗口-->\r\n    <div name="topo_image_node" class=\'panel panel-primary \'>\r\n        <div name=\'head\' class=\'panel-heading\'>\r\n            <span>图片节点</span>\r\n            <button type="button" class="close" aria-hidden="true">\r\n                &times;\r\n            </button>\r\n        </div>\r\n        <div class=\'panel-body \'>\r\n            <form class=\'form-horizontal \' role=\'form\'>\r\n                <div class=\'form-group \' name="id_group">\r\n                    <label class=\'col-sm-4 control-label\'>ID</label>\r\n\r\n                    <div class=" col-sm-7">\r\n                        <div class="input-group">\r\n                            <input type="text" class="form-control" name="id">\r\n                        <span class="input-group-addon">\r\n                            <input type="checkbox" name="id_check">\r\n                        </span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class=\'form-group\' name="name_group">\r\n                    <label class=\'col-sm-4 control-label\'>名称</label>\r\n\r\n                    <div class=\'col-sm-7\'>\r\n                        <input type=\'text\' class=\'form-control\' name="name">\r\n                    </div>\r\n                </div>\r\n                <div class=\'form-group\' name="position_group">\r\n                    <label class=\'col-sm-4 control-label\'>名称位置</label>\r\n\r\n                    <div class=\'col-sm-7\'>\r\n                        <select name="position" class=\'form-control\'>\r\n                            <option value=\'Bottom_Center\'>底部</option>\r\n                            <option value=\'Top_Center\'>顶部</option>\r\n                            <option value=\'Middle_Left\'>左部</option>\r\n                            <option value=\'Middle_Right\'>右侧</option>\r\n                            <option value=\'Hidden\'>隐藏</option>\r\n                        </select>\r\n                    </div>\r\n                </div>\r\n                <div class=\'form-group\' name="image_group">\r\n                    <label class=\'col-sm-4 control-label\'>图标</label>\r\n\r\n                    <div class=\'col-sm-7\'>\r\n                        <img name="image" src=\'img/mo/wlan_4.png\'>\r\n                        <button name="find_image" class=\'btn btn-primary\' type=\'button\'>\r\n                            <span class=\'glyphicon glyphicon-search\'></span>\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </form>\r\n        </div>\r\n        <div class="panel-footer">\r\n            <div class=\'col-sm-offset-3 col-sm-10\' name="group">\r\n                <button name="ok" class=\'btn btn-primary\' type=\'button\'>确定</button>\r\n                <button name="cancel" class=\'btn btn-primary\' type=\'button\'>关闭</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <!--图片节点窗口子窗口-->\r\n    <div name="image_select" class="modal fade" tabindex="-1" role="dialog"\r\n         aria-labelledby="myModalLabel" aria-hidden="true">\r\n        <div class="modal-dialog">\r\n            <div class="modal-content">\r\n                <div class="modal-header">\r\n                    <button type="button" class="close"\r\n                            data-dismiss="modal" aria-hidden="true">\r\n                        &times;\r\n                    </button>\r\n                    <h4 class="modal-title">\r\n                        选择图形\r\n                    </h4>\r\n                </div>\r\n                <div class="modal-body">\r\n                    <div class="panel-group" name="topo_node_selected_image" role="tablist" aria-multiselectable="true">\r\n                    </div>\r\n                </div>\r\n                <div class="modal-footer">\r\n                    <button name="ok" type="button" class="btn btn-primary">\r\n                        确定\r\n                    </button>\r\n                    <button type="button" class="btn btn-primary" data-dismiss="modal">\r\n                        关闭\r\n                    </button>\r\n                </div>\r\n            </div>\r\n            <!-- /.modal-content -->\r\n        </div>\r\n    </div>\r\n    <!--文字节点窗口-->\r\n    <div name=\'topo_text_node\' class=\'panel panel-primary \'>\r\n        <div name=\'head\' class=\'panel-heading\'>\r\n            <span>文本节点</span>\r\n            <button type="button" class="close" aria-hidden="true">\r\n                &times;\r\n            </button>\r\n        </div>\r\n        <div class=\'panel-body \'>\r\n            <form class=\'form-horizontal \' role=\'form\'>\r\n                <div class=\'form-group\' name="text_group">\r\n                    <label for=\'text\' class=\'col-sm-4 control-label\'>文本内容</label>\r\n\r\n                    <div class=\'col-sm-7\'>\r\n                        <textarea class="form-control" rows="2" name="text"></textarea>\r\n                    </div>\r\n                </div>\r\n                <div class=\'form-group\' name="color_group">\r\n                    <label class=\'col-sm-4 control-label\'>字体颜色</label>\r\n\r\n                    <div class=" col-sm-7">\r\n                        <div class="input-group">\r\n                            <input type=\'text\' class=\'form-control\' name="color" readonly="true">\r\n                        <span class="input-group-btn">\r\n                            <button class=\'btn btn-primary\' type=\'button\' data-toggle="dropdown">\r\n                                <span class=\'glyphicon glyphicon-search\'></span>\r\n                            </button>\r\n                             <ul class="dropdown-menu color_selected">\r\n                                 <li>\r\n                                     <div name="color_palette"></div>\r\n                                 </li>\r\n                             </ul>\r\n                        </span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class=\'form-group\' name="size_group">\r\n                    <label class=\'col-sm-4 control-label\'>字体大小</label>\r\n\r\n                    <div class=" col-sm-7">\r\n                        <div class="input-group">\r\n                        <span class="input-group-btn">\r\n                            <button name="size_up" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-up\'></span>\r\n                            </button>\r\n                        </span>\r\n                            <input name="size_num" type="text" class="form-control" value="16" readonly="true">\r\n                        <span class="input-group-btn">\r\n                            <button name="size_down" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-down\'></span>\r\n                            </button>\r\n                        </span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </form>\r\n        </div>\r\n        <div class="panel-footer">\r\n            <div class=\'col-sm-offset-3 col-sm-10\' name="group">\r\n                <button name="ok" class=\'btn btn-primary\' type=\'button\'>确定</button>\r\n                <button name="cancel" class=\'btn btn-primary\' type=\'button\'>关闭</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("window/nodeAttribute",["text!template/nodeAttribute.html","window/base","element/Node","tool/util"],function(t,e,n,i){var o=$(t),r=o.find("[name=topo_image_node]").hide(),a=o.find("[name=topo_text_node]").hide();return $("body").append(o),{initImageNode:function(t){function a(t){"node"==t.elementType&&(c.find("span:first").text("编辑节点"),r.target=t,r.mode="edit",g.val(t.prop.name),p.val(t.prop.id),w.val(t.prop.textPosition),b.attr("src",t.prop.image),r.show())}var s=o.find("[name=image_select]"),l=s.find("[name=topo_node_selected_image]");r.css(e.defaultPosition);var c=r.find("[name=head]"),h=r.find("[name=cancel]"),d=r.find("[name=ok]"),u=r.find("[name=find_image]"),p=r.find("[name=id]"),f=r.find("[name=id_check]"),m=r.find("[name=id_group]"),g=r.find("[name=name]"),v=r.find("[name=name_group]"),b=r.find("[name=image]"),y=r.find("[name=image_group]"),w=r.find("[name=position]"),x=r.find("[name=position_group]"),k=[m,v,y,x],_=[p,g,b,w];e.resetHide(_,k),e.moveable(c,r),r.find(".close").click(function(){h.click()}),f.click(function(t){p.attr("disabled",!this.checked)}),p.attr("disabled",!0);var T=!0;u.click(function(n){if(T){var i=t.prop.config.image||{};$.each(i,function(t,n){var i=$("<div class='panel panel-default'><div class='panel-heading' role='tab'><h4 class='panel-title'><a data-toggle='collapse' data-parent='[name=topo_node_selected_image]' href='[name=topo_node_selected_image_"+t+"]'  aria-controls='collapseOne'>"+t+"</a></h4></div><div name='topo_node_selected_image_"+t+"' class='panel-collapse collapse' role='tabpanel' ><div class='panel-body'><div class='container'><div class='row'><div name='image_show' class='btn-group col-md-6' data-toggle='buttons'></div></div></div></div></div></div>");l.append(i),$.each(n,function(t,n){e.makeImageBtn(i.find("[name=image_show]"),n)})}),T=!1}l.find(".panel:first").find("a").click(),s.modal("toggle")}),s.on("hidden.bs.modal",function(t){l.find("[name=image_show]").find(".active").removeClass("active"),l.find(".in").collapse("hide")});var E=b.attr("src");return r.on("resetWindow",function(t){t&&$.isFunction(t)&&t(),p.val(""),p.attr("disabled",!0),f.attr("checked",!1),g.val(""),w.val("Bottom_Center"),b.attr("src",E),r.hide(),r.css(e.defaultPosition)}),s.find("[name=ok]").click(function(){b.attr("src",s.find(".in").find(".active img").attr("src")),s.modal("toggle")}),d.click(function(){var e=g.val().trim(),o=p.val(),a=b.attr("src"),s=w.val();if("create"==r.mode&&t.addElement(n.createNode({name:e,id:o,pid:t.prop.pid||t.prop.id,image:a,textPosition:s,x:i.getCenterPosition(t).x,y:i.getCenterPosition(t).y})),"edit"==r.mode){var l=r.target;l.prop.name=e,l.prop.id=o,l.setNodeImage(a),l.setTextPosition(s),r.trigger("resetWindow")}}),{win:r,head:c,okBtn:d,cancelBtn:h,id:p,idCheck:f,name:g,image:b,position:w,edit:a}},initTextNode:function(t){function o(t){"TextNode"==t.elementType&&(r.find("span:first").text("编辑文本"),a.target=t,a.mode="edit",d.val(a.target.text),h.val(a.target.prop.fontColor),c.val(parseInt(a.target.prop.fontSize)),a.show())}a.css(e.defaultPosition);var r=a.find("[name=head]"),s=a.find("[name=cancel]"),l=a.find("[name=ok]"),c=a.find("[name=size_num]"),h=a.find("[name=color]"),d=a.find("[name=text]"),u=a.find("[name-text_group]"),p=a.find("[name=size_group]"),f=a.find("[name=color_group]"),m=[c,h,d],g=[p,f,u];return a.find(".close").click(function(){s.click()}),e.resetHide(m,g),e.moveable(r,a),e.colorSelect(h,a.find("[name=color_palette]")),e.resizeNum(p,{bottom:2}),a.on("resetWindow",function(t){t&&$.isFunction(t)&&t(),d.val(""),h.val(""),c.val(12),a.hide(),a.css(e.defaultPosition)}),l.click(function(){if("create"==a.mode&&t.addElement(n.createTextNode({text:d.val().trim(),fontSize:c.val(),fontColor:h.val(),x:i.getCenterPosition(t).x,y:i.getCenterPosition(t).y})),"edit"==a.mode){var e=a.target;e.text=d.val(),e.setFontColor(h.val()),e.setFont(c.val()),a.trigger("resetWindow")}}),{win:a,head:r,okBtn:l,cancelBtn:s,
size:c,color:h,text:d,edit:o}}}}),define("resource/js/require/plugins/text!template/linkAttribute.html",[],function(){return'<div name="topo_link_template">\r\n    <div name=\'topo_link_attribute\' class=\'panel panel-primary \'>\r\n        <div name=\'head\' class=\'panel-heading\'>\r\n            <span>线属性</span>\r\n            <button type="button" class="close" aria-hidden="true">\r\n                &times;\r\n            </button>\r\n        </div>\r\n        <div class=\'panel-body \'>\r\n            <form class=\'form-horizontal \' role=\'form\'>\r\n                <div name="name_group" class=\'form-group\'>\r\n                    <label class=\'col-sm-4 control-label\'>名称</label>\r\n\r\n                    <div class=\'col-sm-7\'>\r\n                        <input name="name" type=\'text\' class=\'form-control\'>\r\n                    </div>\r\n                </div>\r\n                <div class=\'form-group\' name="number_group">\r\n                    <label class=\'col-sm-4 control-label\'>数量</label>\r\n\r\n                    <div class=" col-sm-7">\r\n                        <div class="input-group">\r\n                        <span class="input-group-btn">\r\n                            <button name="number_up" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-up\'></span>\r\n                            </button>\r\n                        </span>\r\n                            <input name="number_num" type="text" class="form-control" value="0" readonly="true">\r\n                        <span class="input-group-btn">\r\n                            <button name="number_down" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-down\'></span>\r\n                            </button>\r\n                        </span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class=\'form-group\' name="style_group">\r\n                    <label class=\'col-sm-4 control-label\'>样式</label>\r\n\r\n                    <div class=\'col-sm-7\'>\r\n                        <select name=\'style\' class=\'form-control\'>\r\n                            <option value=\'direct\'>直线</option>\r\n                            <option value=\'fold\'>折线</option>\r\n                            <option value=\'flexional\'>二次折线</option>\r\n                            <option value=\'curve\'>弧线</option>\r\n                        </select>\r\n                    </div>\r\n                </div>\r\n                <div class=\'form-group\' name="color_group">\r\n                    <label class=\'col-sm-4 control-label\'>线条颜色</label>\r\n\r\n                    <div class=" col-sm-7">\r\n                        <div class="input-group">\r\n                            <input name="selected_color" type=\'text\' class=\'form-control\' readonly="true">\r\n                        <span class="input-group-btn">\r\n                            <button class=\'btn btn-primary\' type=\'button\' data-toggle="dropdown">\r\n                                <span class=\'glyphicon glyphicon-search\'></span>\r\n                            </button>\r\n                             <ul class="dropdown-menu color_selected">\r\n                                 <li>\r\n                                     <div name="color_palette"></div>\r\n                                 </li>\r\n                             </ul>\r\n                        </span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class=\'form-group\' name="width_group">\r\n                    <label class=\'col-sm-4 control-label\'>线条宽度</label>\r\n\r\n                    <div class=" col-sm-7">\r\n                        <div class="input-group">\r\n                        <span class="input-group-btn">\r\n                            <button name="width_up" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-up\'></span>\r\n                            </button>\r\n                        </span>\r\n                            <input name="width_num" type="text" class="form-control" value="3" readonly="true">\r\n                        <span class="input-group-btn">\r\n                            <button name="width_down" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-down\'></span>\r\n                            </button>\r\n                        </span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class=\'form-group\' name="gap_group">\r\n                    <label class=\'col-sm-4 control-label\'>拐线长短</label>\r\n\r\n                    <div class=" col-sm-7">\r\n                        <div class="input-group">\r\n                        <span class="input-group-btn">\r\n                            <button name="gap_up" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-up\'></span>\r\n                            </button>\r\n                        </span>\r\n                            <input name="gap_num" type="text" class="form-control" value="60" readonly="true">\r\n                        <span class="input-group-btn">\r\n                            <button name="gap_down" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-down\'></span>\r\n                            </button>\r\n                        </span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class=\'form-group\' name="direction_group">\r\n                    <label class=\'col-sm-4 control-label\'>折线方向</label>\r\n\r\n                    <div class=\'col-sm-7\'>\r\n                        <select name=\'direction\' class=\'form-control\'>\r\n                            <option value=\'horizontal\'>水平</option>\r\n                            <option value=\'vertical\'>垂直</option>\r\n                        </select>\r\n                    </div>\r\n                </div>\r\n                <div class=\'form-group\' name="cureOffset_group">\r\n                    <label class=\'col-sm-4 control-label\'>曲线偏移</label>\r\n\r\n                    <div class=" col-sm-7">\r\n                        <div class="input-group">\r\n                        <span class="input-group-btn">\r\n                            <button name="cureOffset_up" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-up\'></span>\r\n                            </button>\r\n                        </span>\r\n                            <input name="cureOffset_num" type="text" class="form-control" value="200" readonly="true">\r\n                        <span class="input-group-btn">\r\n                            <button name="cureOffset_down" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-down\'></span>\r\n                            </button>\r\n                        </span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class=\'form-group\' name="check_group">\r\n                    <label class=\'col-sm-4 control-label\'>属性</label>\r\n\r\n                    <div class="col-sm-8">\r\n                        <label class="checkbox-inline">\r\n                            <input type="checkbox" name="arrow_check_target">终箭头\r\n                        </label>\r\n                        <label class="checkbox-inline">\r\n                            <input type="checkbox" name="arrow_check_source">始箭头\r\n                        </label>\r\n                        <label class="checkbox-inline">\r\n                            <input type="checkbox" name="dashed_check">虚线\r\n                        </label>\r\n                    </div>\r\n                </div>\r\n                <div class=\'form-group\' name="arrow_size_group">\r\n                    <label class=\'col-sm-4 control-label\'>箭头大小</label>\r\n\r\n                    <div class=" col-sm-7">\r\n                        <div class="input-group">\r\n                        <span class="input-group-btn">\r\n                            <button name="arrow_size_up" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-up\'></span>\r\n                            </button>\r\n                        </span>\r\n                            <input name="arrow_size_num" type="text" class="form-control" value="10" readonly="true">\r\n                        <span class="input-group-btn">\r\n                            <button name="arrow_size_down" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-down\'></span>\r\n                            </button>\r\n                        </span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class=\'form-group\' name="arrow_offset_group">\r\n                    <label class=\'col-sm-4 control-label\'>箭头位置</label>\r\n\r\n                    <div class=" col-sm-7">\r\n                        <div class="input-group">\r\n                        <span class="input-group-btn">\r\n                            <button name="arrow_offset_up" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-up\'></span>\r\n                            </button>\r\n                        </span>\r\n                            <input name="arrow_offset_num" type="text" class="form-control" value="0" readonly="true">\r\n                        <span class="input-group-btn">\r\n                            <button name="arrow_offset_down" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-down\'></span>\r\n                            </button>\r\n                        </span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class=\'form-group\' name="dashed_size_group">\r\n                    <label class=\'col-sm-4 control-label\'>虚线长短</label>\r\n\r\n                    <div class=" col-sm-7">\r\n                        <div class="input-group">\r\n                        <span class="input-group-btn">\r\n                            <button name="dashed_size_up" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-up\'></span>\r\n                            </button>\r\n                        </span>\r\n                            <input name="dashed_size_num" type="text" class="form-control" value="6" readonly="true">\r\n                        <span class="input-group-btn">\r\n                            <button name="dashed_size_down" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-down\'></span>\r\n                            </button>\r\n                        </span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </form>\r\n        </div>\r\n        <div class="panel-footer">\r\n            <div class=\'col-sm-offset-3 col-sm-10\' name="group">\r\n                <button name="ok" class=\'btn btn-primary\' type=\'button\'>确定</button>\r\n                <button name="cancel" class=\'btn btn-primary\' type=\'button\'>关闭</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div name=\'topo_line_attribute\' class=\'panel panel-primary \'>\r\n        <div name=\'head\' class=\'panel-heading\'>\r\n            画线\r\n            <button type="button" class="close" aria-hidden="true">\r\n                &times;\r\n            </button>\r\n        </div>\r\n        <div class=\'panel-body \'>\r\n            <form class=\'form-horizontal \' role=\'form\'>\r\n                <div class=\'form-group name_group\'>\r\n                    <label class=\'col-sm-4 control-label\'>名称</label>\r\n\r\n                    <div class=\'col-sm-7\'>\r\n                        <input type=\'text\' class=\'form-control name\'>\r\n                    </div>\r\n                </div>\r\n                <div class=\'form-group color_group\'>\r\n                    <label class=\'col-sm-4 control-label\'>线条颜色</label>\r\n\r\n                    <div class=" col-sm-7">\r\n                        <div class="input-group">\r\n                            <input type=\'text\' class=\'form-control selected_color\' readonly="true">\r\n                        <span class="input-group-btn">\r\n                            <button class=\'btn btn-primary\' type=\'button\' data-toggle="dropdown">\r\n                                <span class=\'glyphicon glyphicon-search\'></span>\r\n                            </button>\r\n                             <ul class="dropdown-menu color_selected">\r\n                                 <li>\r\n                                     <div class="color_palette"></div>\r\n                                 </li>\r\n                             </ul>\r\n                        </span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div class=\'form-group width_group\'>\r\n                    <label class=\'col-sm-4 control-label\'>线条宽度</label>\r\n\r\n                    <div class=" col-sm-7">\r\n                        <div class="input-group">\r\n                        <span class="input-group-btn">\r\n                            <button name="width_up" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-up\'></span>\r\n                            </button>\r\n                        </span>\r\n                            <input name="width_num" type="text" class="form-control" value="3" readonly="true">\r\n                        <span class="input-group-btn">\r\n                            <button name="width_down" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-down\'></span>\r\n                            </button>\r\n                        </span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </form>\r\n        </div>\r\n        <div class="panel-footer">\r\n            <div class=\'col-sm-offset-1 col-sm-11\' name="group">\r\n                <button class=\'btn btn-primary cancel_before\' type=\'button\'>取消前一步</button>\r\n                <button class=\'btn btn-primary cancel_all\' type=\'button\'>取消全部</button>\r\n                <button class=\'btn btn-primary ok\' type=\'button\'>完成当前</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("window/linkAttribute",["text!template/linkAttribute.html","window/base","element/Link"],function(t,e,n){var i=$(t),o=i.find("[name=topo_link_attribute]").hide(),r=i.find("[name=topo_line_attribute]").hide();return $("body").append(i),{initLink:function(t){function i(t){switch(o.target=t,o.mode="edit",l.val(t.prop.name||""),h.val(t.prop.num||0),u.val(t.prop.linkType),u.trigger("change"),f.val(t.strokeColor),g.val(t.lineWidth),"normal"!=t.prop.useType&&"line"!=t.prop.useType&&(u.attr("disabled",!0),l.attr("disabled",!0)),t.prop.linkType){case"direct":b.val(t.bundleOffset||0);break;case"fold":w.val(t.direction);break;case"flexional":w.val(t.direction),b.val(t.offsetGap);break;case"curve":_.val(t.prop.cureOffset)}t.arrowsRadius&&t.arrowsRadius>0&&(t.prop.sourceArrow&&E.click(),t.prop.targetArrow&&T.click(),P.val(t.arrowsRadius),I.val(t.arrowsOffset)),t.dashedPattern&&(C.click(),M.val(t.dashedPattern)),r.find("span:first").html("编辑链路"),o.show()}o.css(e.defaultPosition);var r=o.find("[name=head]"),a=o.find("[name=ok]"),s=o.find("[name=cancel]"),l=o.find("[name=name]"),c=o.find("[name=name_group]"),h=o.find("[name=number_num]"),d=o.find("[name=number_group]"),u=o.find("[name=style]"),p=o.find("[name=style_group]"),f=o.find("[name=selected_color]"),m=o.find("[name=color_group]"),g=o.find("[name=width_num]"),v=o.find("[name=width_group]"),b=o.find("[name=gap_num]"),y=o.find("[name=gap_group]"),w=o.find("[name=direction]"),x=o.find("[name=direction_group]"),k=o.find("[name=cureOffset_group]"),_=o.find("[name=cureOffset_num]"),T=o.find("[name=arrow_check_target]"),E=o.find("[name=arrow_check_source]"),C=o.find("[name=dashed_check]"),P=(o.find("[name=check_group]"),o.find("[name=arrow_size_num]")),L=o.find("[name=arrow_size_group]"),I=o.find("[name=arrow_offset_num]"),S=o.find("[name=arrow_offset_group]"),M=o.find("[name=dashed_size_num]"),A=o.find("[name=dashed_size_group]"),z=[c,d,p,m,v,L,S,A,y,x,k],N=[l,h,u,f,g,P,I,M,b,w,_];return e.resetHide(N,z),e.colorSelect(f,o.find("[name=color_palette]")),e.resizeNum(v,{bottom:1}),e.resizeNum(L,{step:5,bottom:0}),e.resizeNum(S,{step:5}),e.resizeNum(A,{step:5,bottom:1}),e.resizeNum(y,{step:5,bottom:0}),e.resizeNum(k,{step:50}),e.resizeNum(d,{step:1,bottom:0}),e.moveable(r,o),o.find(".close").click(function(){s.click()}),w.hide(),P.hide(),I.hide(),M.hide(),T.click(function(t){E[0].checked||(P.toggle(this.checked),I.toggle(this.checked))}),E.click(function(t){T[0].checked||(P.toggle(this.checked),I.toggle(this.checked))}),C.click(function(t){M.toggle(this.checked)}),u.change(function(){switch(this.value){case"direct":w.hide(),b.show(),_.hide();break;case"fold":w.show(),b.hide(),_.hide();break;case"flexional":w.show(),b.show(),_.hide();break;case"curve":w.hide(),b.hide(),_.show()}}),o.on("resetWindow",function(t){t&&$.isFunction(t)&&t(),l.val(""),l.attr("disabled",!1),h.val(0),f.val(""),u.val("direct"),u.attr("disabled",!1),b.val(60),w.val("horizontal"),T.attr("checked",!1),E.attr("checked",!1),C.attr("checked",!1),P.val(10).hide(),I.val(0).hide(),M.val(6).hide(),_.val(200).hide(),o.hide(),o.css(e.defaultPosition)}),a.click(function(){if("edit"==o.mode){var e=o.target,i=e,r={name:l.val().trim(),num:h.val(),color:f.val(),width:parseInt(g.val()),arrowSize:parseInt(P.val()),arrowOffset:parseInt(I.val()),dashedPattern:C[0].checked?parseInt(M.val()):null,sourceArrow:E[0].checked,targetArrow:T[0].checked,cureOffset:_.val()};if(e.prop.linkType==u.val()){switch(e.setNum(r.num,r.name),e.setColor(r.color),e.lineWidth=r.width,e.prop.sourceArrow=r.sourceArrow,e.prop.targetArrow=r.targetArrow,u.val()){case"direct":e.bundleOffset=parseInt(b.val());break;case"fold":e.direction=w.val();break;case"flexional":e.direction=w.val(),e.offsetGap=parseInt(b.val());break;case"curve":e.prop.cureOffset=_.val()}E[0].checked||T[0].checked?(e.arrowsRadius=r.arrowSize,e.arrowsOffset=r.arrowOffset):e.arrowsRadius=null,C[0].checked?e.dashedPattern=r.dashedPattern:e.dashedPattern=null}else{switch(r.start=e.nodeA,r.end=e.nodeZ,u.val()){case"direct":r.bundleOffset=parseInt(b.val()),i=n.directLink(r);break;case"fold":r.direction=w.val(),i=n.foldLink(r);break;case"flexional":r.direction=w.val(),r.offsetGap=parseInt(b.val()),i=n.flexionalLink(r);break;case"curve":i=n.CurveLink(r)}i.prop.id=e.prop.id,i.prop.pid=e.prop.pid,i.prop.eweight=e.prop.eweight,i.exprop=e.exprop,t.removeElement(e),t.addElement(i)}o.trigger("resetWindow")}}),s.click(function(){o.trigger("resetWindow")}),{win:o,okBtn:a,cancelBtn:s,name:l,style:u,color:f,width:g,gapSize:b,direction:w,arrowCheck_target:T,arrowCheck_source:E,arrowSize:P,arrowOffset:I,dashedCheck:C,dashedSize:M,edit:i}},initLine:function(t){function i(){t.removeElement(b),b="",x=!0}r.css(e.defaultPosition);var o=r.find("[name=head]"),a=r.find(".ok"),s=r.find(".close"),l=r.find(".cancel_before"),c=r.find(".cancel_all"),h=r.find(".name"),d=r.find(".name_group"),u=r.find(".selected_color"),p=r.find(".color_group"),f=r.find("[name=width_num]"),m=r.find(".width_group"),g=[d,p,m],v=[h,u,f];e.resetHide(v,g),e.moveable(o,r),e.colorSelect(u,r.find(".color_palette")),e.resizeNum(m,{bottom:1});var b,y,w=[],x=!0,k=!1;return r.on("drawLine",function(t){k=!0,t&&$.isFunction(t)&&t(),r.show()}),t.click(function(e){k&&0==e.button&&(x?(w=[],b=(new JTopo.Node).setLocation(e.x,e.y),b.setSize(1,1),y=(new JTopo.Node).setLocation(e.x,e.y),y.setSize(1,1),t.addElement(n.directLink({start:y,end:b,name:h.val(),color:u.val(),width:f.val(),useType:"line"})),w.push(y),x=!1):(y=b,b=(new JTopo.Node).setLocation(e.x,e.y),b.setSize(1,1),y.setLocation(e.x,e.y),t.addElement(n.directLink({start:y,end:b,name:h.val(),color:u.val(),width:f.val(),useType:"line"})),w.push(y)))}),t.dbclick(function(t){i(),w.length>0&&(w.splice(w.length-1,1),1==w.length&&w.splice(w.length-1,1))}),t.mousemove(function(t){k&&0==t.button&&b&&b.setLocation(t.x,t.y)}),r.on("resetWindow",function(t){t&&$.isFunction(t)&&t(),i(),k=!1,h.val(""),u.val(""),f.val(3),r.hide(),r.css(e.defaultPosition)}),a.click(function(){i()}),l.click(function(){w.length>0&&(t.removeElement(w[w.length-1]),w.splice(w.length-1,1),w.length>0?b&&t.addElement(n.directLink({start:w[w.length-1],end:b,name:h.val(),color:u.val(),width:f.val(),useType:"line"})):i())}),c.click(function(){i(),w.length>0&&($.each(w,function(e,n){t.removeElement(n)}),w=[])}),s.click(function(){r.trigger("resetWindow")}),{win:r,name:h,color:u,width:f,head:o,okBtn:a,cancelBtn:s}}}}),define("resource/js/require/plugins/text!template/containerAttribute.html",[],function(){return'<div name="topo_container_template">\r\n    <div name=\'topo_container_attribute\' class=\'panel panel-primary \'>\r\n        <div name=\'head\' class=\'panel-heading\'>\r\n            <span>分组属性</span>\r\n            <button type="button" class="close" aria-hidden="true">&times;</button>\r\n        </div>\r\n        <div class=\'panel-body \' >\r\n            <form class=\'form-horizontal \' role=\'form\'>\r\n                <div name="name_group" class=\'form-group\'>\r\n                    <label class=\'col-sm-4 control-label\'>名称</label>\r\n                    <div class=\'col-sm-7\'>\r\n                        <input name="name" type=\'text\' class=\'form-control\'>\r\n                    </div>\r\n                </div>\r\n                <div name="position_group" class=\'form-group\'>\r\n                    <label class=\'col-sm-4 control-label\'>名称位置</label>\r\n\r\n                    <div class=\'col-sm-7\'>\r\n                        <select name=\'position\' class=\'form-control\'>\r\n                            <option value=\'Bottom_Center\'>底部</option>\r\n                            <option value=\'Top_Center\'>顶部</option>\r\n                            <option value=\'Middle_Left\'>左部</option>\r\n                            <option value=\'Middle_Right\'>右侧</option>\r\n                            <option value=\'Hidden\'>隐藏</option>\r\n                        </select>\r\n                    </div>\r\n                </div>\r\n                <div name="image_group" class=\'form-group\'>\r\n                    <label class=\'col-sm-4 control-label\'>收缩图形</label>\r\n\r\n                    <div class=\'col-sm-7\'>\r\n                        <img name=\'image\' src=\'img/mo/wlan_4.png\'>\r\n                        <button name="find_image" class=\'btn btn-primary\' type=\'button\'>\r\n                            <span class=\'glyphicon glyphicon-search\'></span>\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n                <div name="fill_color_group" class=\'form-group\'>\r\n                    <label class=\'col-sm-4 control-label\'>填充颜色</label>\r\n\r\n                    <div class=" col-sm-7">\r\n                        <div class="input-group">\r\n                            <input name="selected_color" type=\'text\' class=\'form-control\' readonly="true">\r\n                            <span class="input-group-btn">\r\n                                <button class=\'btn btn-primary\' type=\'button\' data-toggle="dropdown">\r\n                                    <span class=\'glyphicon glyphicon-search\'></span>\r\n                                 </button>\r\n                                <ul class="dropdown-menu color_selected" >\r\n                                    <li>\r\n                                        <div name="color_palette"></div>\r\n                                    </li>\r\n                                </ul>\r\n                            </span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div name="alpha_group" class=\'form-group\'>\r\n                    <label class=\'col-sm-4 control-label\'>透明度</label>\r\n\r\n                    <div class=" col-sm-7">\r\n                        <div class="progress inner-progress">\r\n                            <div name="alpha" class="progress-bar progress-bar-info" role="progressbar"\r\n                                 aria-valuemin="0"\r\n                                 aria-valuemax="100" style="width: 100%;">100%\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div name="border_width_group" class=\'form-group\'>\r\n                    <label class=\'col-sm-4 control-label\'>边框粗细</label>\r\n\r\n                    <div class=" col-sm-7">\r\n                        <div class="input-group">\r\n                        <span class="input-group-btn">\r\n                            <button name="border_width_up" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-up\'></span>\r\n                            </button>\r\n                        </span>\r\n                            <input name="border_width_num" type="text" class="form-control" value="0" readonly="true">\r\n                        <span class="input-group-btn">\r\n                            <button name="border_width_down" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-down\'></span>\r\n                            </button>\r\n                        </span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div name="border_color_group" class=\'form-group\'>\r\n                    <label class=\'col-sm-4 control-label\'>边框颜色</label>\r\n\r\n                    <div class=" col-sm-7">\r\n                        <div class="input-group">\r\n                            <input name="selected_color" type=\'text\' class=\'form-control\' readonly="true">\r\n                        <span class="input-group-btn">\r\n                            <button class=\'btn btn-primary\' type=\'button\' data-toggle="dropdown">\r\n                                <span class=\'glyphicon glyphicon-search\'></span>\r\n                            </button>\r\n                             <ul class="dropdown-menu color_selected">\r\n                                 <li>\r\n                                     <div name="color_palette"></div>\r\n                                 </li>\r\n                             </ul>\r\n                        </span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div name="border_radius_group" class=\'form-group\'>\r\n                    <label class=\'col-sm-4 control-label\'>边角弧度</label>\r\n\r\n                    <div class=\'col-sm-7\'>\r\n                        <input name="border_radius" type=\'text\' class=\'form-control\'>\r\n                    </div>\r\n                </div>\r\n                <div class=\'form-group\' name="set_member_group">\r\n                    <label  class=\'col-sm-4 control-label\'>成员设置</label>\r\n\r\n                    <div  class="col-sm-7">\r\n                        <label class="checkbox-inline">\r\n                            <input type="checkbox" name="show_name" value="showName" checked>显示名\r\n                        </label>\r\n                        <label class="checkbox-inline">\r\n                            <input type="checkbox" name="show_link" value="showLink" checked>显示线\r\n                        </label>\r\n                    </div>\r\n                </div>\r\n                <div name="layout_group" class=\'form-group\'>\r\n                    <label class=\'col-sm-4 control-label\'>布局</label>\r\n\r\n                    <div class="col-sm-7">\r\n                        <label class="radio-inline">\r\n                            <input type="radio" name="layout" value="set"> 手动\r\n                        </label>\r\n                        <label class="radio-inline">\r\n                            <input type="radio" name="layout" value="auto"> 自动\r\n                        </label>\r\n                    </div>\r\n                </div>\r\n                <div name="width_group" class=\'form-group\'>\r\n                    <label class=\'col-sm-4 control-label\'>宽度</label>\r\n\r\n                    <div class=\'col-sm-7\'>\r\n                        <input name="width" type=\'text\' class=\'form-control\'>\r\n                    </div>\r\n                </div>\r\n                <div name="height_group" class=\'form-group\'>\r\n                    <label class=\'col-sm-4 control-label\'>高度</label>\r\n\r\n                    <div class=\'col-sm-7\'>\r\n                        <input name="height" type=\'text\' class=\'form-control\'>\r\n                    </div>\r\n                </div>\r\n                <div name="select_layout_group" class=\'form-group\'>\r\n                    <label class=\'col-sm-4 control-label\'>布局样式</label>\r\n\r\n                    <div class=\'col-sm-7\'>\r\n                        <select name="select_layout" class=\'form-control\'>\r\n                            <option value=\'flow\'>流式</option>\r\n                            <option value=\'grid\'>网格</option>\r\n                        </select>\r\n                    </div>\r\n                </div>\r\n                <div name="row_space_group" class=\'form-group\'>\r\n                    <label class=\'col-sm-4 control-label\'>行间距</label>\r\n\r\n                    <div class=" col-sm-7">\r\n                        <div class="input-group">\r\n                        <span class="input-group-btn">\r\n                            <button name="row_space_up" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-up\'></span>\r\n                            </button>\r\n                        </span>\r\n                            <input name="row_space_num" type="text" class="form-control" value="0" readonly="true">\r\n                        <span class="input-group-btn">\r\n                            <button name="row_space_down" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-down\'></span>\r\n                            </button>\r\n                        </span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div name="column_space_group" class=\'form-group\'>\r\n                    <label class=\'col-sm-4 control-label\'>列间距</label>\r\n\r\n                    <div class=" col-sm-7">\r\n                        <div class="input-group">\r\n                        <span class="input-group-btn">\r\n                            <button name="column_space_up" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-up\'></span>\r\n                            </button>\r\n                        </span>\r\n                            <input name="column_space_num" type="text" class="form-control" value="0" readonly="true">\r\n                        <span class="input-group-btn">\r\n                            <button name="column_space_down" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-down\'></span>\r\n                            </button>\r\n                        </span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </form>\r\n        </div>\r\n        <div class="panel-footer">\r\n            <div class=\'col-sm-offset-3 col-sm-10\' name="group">\r\n                <button name="ok" class=\'btn btn-primary\' type=\'button\'>确定</button>\r\n                <button name="cancel" class=\'btn btn-primary\' type=\'button\'>关闭</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <!--图形选择子框-->\r\n    <div name="image_select" class="modal fade" tabindex="-1" role="dialog"\r\n         aria-labelledby="myModalLabel" aria-hidden="true">\r\n        <div class="modal-dialog">\r\n            <div class="modal-content">\r\n                <div class="modal-header">\r\n                    <button type="button" class="close"\r\n                            data-dismiss="modal" aria-hidden="true">\r\n                        &times;\r\n                    </button>\r\n                    <h4 class="modal-title" id="myModalLabel">\r\n                        选择图形\r\n                    </h4>\r\n                </div>\r\n                <div class="modal-body">\r\n                    <div class="panel-group" name="topo_container_selected_image" role="tablist" aria-multiselectable="true">\r\n                    </div>\r\n                </div>\r\n                <div class="modal-footer">\r\n                    <button name="ok" type="button" class="btn btn-primary">\r\n                        确定\r\n                    </button>\r\n                    <button type="button" class="btn btn-primary" data-dismiss="modal">\r\n                        关闭\r\n                    </button>\r\n                </div>\r\n            </div>\r\n            <!-- /.modal-content -->\r\n        </div>\r\n    </div>\r\n</div>';
}),define("window/containerAttribute",["text!template/containerAttribute.html","window/base","tool/util","element/Container"],function(t,e,n,i){var o=$(t),r=o.find("[name=topo_container_attribute]").hide();return $("body").append(o),{init:function(t){function a(t){var e=0,n=r.target;"create"==r.mode&&n&&n instanceof Array?e=n.length:"edit"==r.mode&&(e=n.childs.length);var i=Math.ceil(Math.sqrt(e));switch(t){case"flow":Z.val(t),W.find("label").html("行间距"),G.find("label").html("列间距"),q.val(0),V.val(0);break;case"grid":Z.val(t),W.find("label").html("行数"),G.find("label").html("列数"),q.val(i||4),V.val(i||4)}}function s(t,n){t.percent=n,e.setPercent(t,parseInt(n))}function l(t){u.find("span:first").text("编辑分组"),r.show(),r.target=t,r.mode="edit",f.val(t.prop.name),g.val(t.prop.textPosition),b.attr("src",t.prop.image),x.val(t.fillColor),s(T,100*t.alpha),P.val(t.borderWidth),I.val(t.borderColor),A.val(t.borderRadius),N[0].checked=t.prop.setMember.showName,B[0].checked=t.prop.setMember.showLink,"set"==t.prop.layoutType?D.click():(X.click(),a(t.prop.layoutType),q.val(t.prop.layoutRow),V.val(t.prop.layoutColumn)),R.val(t.width),H.val(t.height)}function c(t){u.find("span:first").text("创建分组"),r.show(),r.mode="create",r.target=t}var h=o.find("[name=image_select]"),d=h.find("[name=topo_container_selected_image]");r.css(e.defaultPosition);var u=r.find("[name=head]"),p=r.find("[name=name_group]"),f=p.find("[name=name]"),m=r.find("[name=position_group]"),g=m.find("[name=position]"),v=r.find("[name=image_group]"),b=v.find("[name=image]"),y=v.find("[name=find_image]"),w=r.find("[name=fill_color_group]"),x=w.find("[name=selected_color]"),k=w.find("[name=color_palette]"),_=r.find("[name=alpha_group]"),T=_.find("[name=alpha]"),E=_.find(".progress"),C=r.find("[name=border_width_group]"),P=C.find("[name=border_width_num]"),L=r.find("[name=border_color_group]"),I=L.find("[name=selected_color]"),S=L.find("[name=color_palette]"),M=r.find("[name=border_radius_group]"),A=M.find("[name=border_radius]"),z=r.find("[name=set_member_group]"),N=z.find("[name=show_name]"),B=z.find("[name=show_link]"),O=r.find("[name=layout_group]"),F=O.find("[name=layout]"),X=O.find("[name=layout][value=auto]"),D=O.find("[name=layout][value=set]"),Y=r.find("[name=width_group]"),R=Y.find("[name=width]"),J=r.find("[name=height_group]"),H=J.find("[name=height]"),j=r.find("[name=select_layout_group]"),Z=j.find("[name=select_layout]"),W=r.find("[name=row_space_group]"),q=W.find("[name=row_space_num]"),G=r.find("[name=column_space_group]"),V=G.find("[name=column_space_num]"),U=r.find("[name=ok]"),K=r.find("[name=cancel]"),Q=h.find("[name=ok]"),tt=(h.find("[name=image_show]"),[p,m,v,w,_,C,L,M,Y,J,j,W,G]),et=[f,g,b,x,T,P,I,A,R,H,Z,q,V];u.find(".close").click(function(){K.click()}),e.resetHide(et,tt),e.moveable(u,r),e.colorSelect(x,k),e.colorSelect(I,S),e.resizeNum(C,{bottom:0}),e.resizeNum(W,{bottom:1,step:1}),e.resizeNum(G,{bottom:1,step:1}),e.progressClick(E,T),s(T,100);var nt=!0;y.click(function(n){if(nt){var i=t.prop.config.image||{};$.each(i,function(t,n){var i=$("<div class='panel panel-default'><div class='panel-heading' role='tab'><h4 class='panel-title'><a data-toggle='collapse' data-parent='[name=topo_container_selected_image]' href='[name=topo_container_selected_image_"+t+"]'  aria-controls='collapseOne'>"+t+"</a></h4></div><div name='topo_container_selected_image_"+t+"' class='panel-collapse collapse' role='tabpanel' ><div class='panel-body'><div class='container'><div class='row'><div name='image_show' class='btn-group col-md-6' data-toggle='buttons'></div></div></div></div></div></div>");d.append(i),$.each(n,function(t,n){e.makeImageBtn(i.find("[name=image_show]"),n)})}),nt=!1}d.find(".panel:first").find("a").click(),h.modal("toggle")}),Q.click(function(){b.attr("src",d.find(".in").find(".active img").attr("src")),h.modal("toggle")}),h.on("hidden.bs.modal",function(t){d.find("[name=image_show]").find(".active").removeClass("active"),d.find(".in").collapse("hide")}),F.click(function(){var t=r.target,e=0,n=0;if(t&&t instanceof Array){var i=Math.ceil(Math.sqrt(t.length));e=(t[0].width+20)*i,n=(t[0].height+20)*i,R.val(e),H.val(n)}r.layout=$(this).val(),"auto"==r.layout?(R.show(),H.show(),Z.show(),q.show(),V.show()):"set"==r.layout&&(R.hide(),H.hide(),Z.hide(),q.hide(),V.hide())}),D.click(),Z.change(function(){a($(this).val())});var it=b.attr("src");return r.on("resetWindow",function(){f.val(""),g.val("Bottom_Center"),b.attr("src",it),s(T,100),N[0].checked=!0,B[0].checked=!0,x.val(""),I.val(""),D.click(),R.val(""),H.val(""),Z.val("flow"),q.val(1),V.val(1),r.hide(),r.css(e.defaultPosition)}),K.click(function(){r.trigger("resetWindow")}),U.click(function(){var e=r.target,o=f.val(),a=g.val(),s=b.attr("src"),l=n.transHex(x.val()),c=T.percent/100,h=parseInt(P.val()),d=n.transHex(I.val()),u=parseInt(A.val()||0),p=B[0].checked,m=N[0].checked;if("edit"==r.mode)e.setName(o),e.setTextPosition(a),e.setImage(s),e.fillColor=l,e.alpha=c,e.borderWidth=h,e.borderColor=d,e.borderRadius=u,e.prop.setMember.showLink=p,e.prop.setMember.showName=m,"auto"==r.layout?($.each(e.childs,function(t,n){"node"!=n.prop.nodeType&&e.removeNode(n)}),e.setLayout({type:Z.val(),row:parseInt(q.val()),column:parseInt(V.val())}),e.width=parseInt(R.val()),e.height=parseInt(H.val())):"set"==r.layout&&e.setLayout(),e.show();else if("create"==r.mode){var v=i.create({name:o,textPosition:a,image:s,fillColor:l,alpha:c,borderWidth:h,borderColor:d,borderRadius:u,showName:m,showLink:p},t),y=n.getCenterPosition(t);"auto"==r.layout?(v.setLayout({type:Z.val(),row:parseInt(q.val()),column:parseInt(V.val())}),v.width=parseInt(R.val()),v.height=parseInt(H.val()),v.setLocation(y.x-v.width/2,y.y-v.height/2)):v.setLocation(y.x,y.y),e instanceof Array?$.each(e,function(t,e){v.addNode(e)}):v.addNode(e),t.addElement(v)}r.trigger("resetWindow")}),{win:r,name:f,position:g,image:b,fillColor:x,alpha:T,borderWidth:P,borderColor:I,borderRadius:A,auto:X,set:D,width:R,height:H,layoutType:Z,layoutRow:q,layoutColumn:V,okBtn:U,cancelBtn:K,edit:l,create:c}}}}),define("resource/js/require/plugins/text!template/global.html",[],function(){return'<div name="topo_global_window_template">\r\n    <div name="topo_exprop" class=\'panel panel-primary \'>\r\n        <div name=\'head\' class=\'panel-heading\'>\r\n            <span></span>\r\n            <button type="button" class="close" aria-hidden="true">\r\n                &times;\r\n            </button>\r\n        </div>\r\n        <div class=\'panel-body \'>\r\n            <form class=\'form-horizontal \' role=\'form\'>\r\n                <div class=\'form-group\'>\r\n                    <div class=\'col-sm-5\'>\r\n                        <input type=\'text\' class=\'form-control\'>\r\n                    </div>\r\n                    <div class=\'col-sm-6\'>\r\n                        <input type=\'text\' class=\'form-control\'>\r\n                    </div>\r\n                    <div class=\'col-sm-1\'>\r\n                        <button type="button" class="btn btn-primary" name="add">\r\n                            <span class=\'glyphicon glyphicon-plus-sign\'></span>\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </form>\r\n        </div>\r\n        <div class="panel-footer">\r\n            <div class=\'col-sm-offset-4 col-sm-12\' name="group">\r\n                <button name="ok" class=\'btn btn-primary\' type=\'button\'>确定</button>\r\n                <button name="cancel" class=\'btn btn-primary\' type=\'button\'>关闭</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div name="topo_auto_layout" class=\'panel panel-primary \'>\r\n        <div name=\'head\' class=\'panel-heading\'>\r\n            自动布局\r\n            <button type="button" class="close" aria-hidden="true">\r\n                &times;\r\n            </button>\r\n        </div>\r\n        <div class=\'panel-body \'>\r\n            <form class=\'form-horizontal \' role=\'form\'>\r\n                <div class=\'form-group\' name="position_group">\r\n                    <label class=\'col-sm-4 control-label\'>布局方式</label>\r\n\r\n                    <div class=\'col-sm-7\'>\r\n                        <select name="layout" class=\'form-control\'>\r\n                        </select>\r\n                    </div>\r\n                </div>\r\n                <div name="each_row_group" class=\'form-group\'>\r\n                    <label class=\'col-sm-4 control-label\'>每行数量</label>\r\n\r\n                    <div class=" col-sm-7">\r\n                        <div class="input-group">\r\n                        <span class="input-group-btn">\r\n                            <button name="each_row_up" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-up\'></span>\r\n                            </button>\r\n                        </span>\r\n                            <input name="each_row_num" type="text" class="form-control" value="5" readonly="true">\r\n                        <span class="input-group-btn">\r\n                            <button name="each_row_down" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-down\'></span>\r\n                            </button>\r\n                        </span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div name="row_space_group" class=\'form-group\'>\r\n                    <label class=\'col-sm-4 control-label\'>行间距</label>\r\n\r\n                    <div class=" col-sm-7">\r\n                        <div class="progress inner-progress">\r\n                            <div  class="progress-bar progress-bar-info" role="progressbar"\r\n                                 aria-valuemin="0"\r\n                                 aria-valuemax="100" style="width: 100%;">100%\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div name="column_space_group" class=\'form-group\'>\r\n                    <label class=\'col-sm-4 control-label\'>列间距</label>\r\n\r\n                    <div class=" col-sm-7">\r\n                        <div class="progress inner-progress">\r\n                            <div  class="progress-bar progress-bar-info" role="progressbar"\r\n                                 aria-valuemin="0"\r\n                                 aria-valuemax="100" style="width: 100%;">100%\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div name="radius_group" class=\'form-group\'>\r\n                    <label class=\'col-sm-4 control-label\'>最小半径</label>\r\n\r\n                    <div class=" col-sm-7">\r\n                        <div class="progress inner-progress">\r\n                            <div  class="progress-bar progress-bar-info" role="progressbar"\r\n                                  aria-valuemin="0"\r\n                                  aria-valuemax="100" style="width: 100%;">100%\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n                <div name="order_group" class=\'form-group\'>\r\n                    <label class=\'col-sm-4 control-label\'>排序</label>\r\n\r\n                    <div class="col-sm-7">\r\n                        <label class="radio-inline">\r\n                            <input type="radio" name="order" value="asc"> 升序\r\n                        </label>\r\n                        <label class="radio-inline">\r\n                            <input type="radio" name="order" value="des"> 降序\r\n                        </label>\r\n                    </div>\r\n                </div>\r\n            </form>\r\n        </div>\r\n        <div class="panel-footer">\r\n            <div class=\'col-sm-offset-3 col-sm-10\' name="group">\r\n                <button name="ok" class=\'btn btn-primary\' type=\'button\'>布局</button>\r\n                <button name="cancel" class=\'btn btn-primary\' type=\'button\'>关闭</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <div name="alarm_config" class=\'panel panel-primary\'>\r\n        <div class=\'panel-heading\'>\r\n            告警渲染\r\n            <button type="button" class="close" aria-hidden="true">\r\n                &times;\r\n            </button>\r\n        </div>\r\n        <div class=\'panel-body \'>\r\n            <form class=\'form-horizontal \' role=\'form\'>\r\n                <div  class=\'form-group size_group\'>\r\n                    <label class=\'col-sm-4 control-label\'>大小</label>\r\n                    <div class=" col-sm-7">\r\n                        <div class="input-group">\r\n                        <span class="input-group-btn">\r\n                            <button name="size_up" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-up\'></span>\r\n                            </button>\r\n                        </span>\r\n                            <input name="size_num" type="text" class="form-control" value="14" readonly="true">\r\n                        <span class="input-group-btn">\r\n                            <button name="size_down" class="btn btn-default" type="button">\r\n                                <span class=\'glyphicon glyphicon-chevron-down\'></span>\r\n                            </button>\r\n                        </span>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </form>\r\n        </div>\r\n        <div class="panel-footer">\r\n            <div class=\'col-sm-offset-3 col-sm-10\' name="group">\r\n                <button name="ok" class=\'btn btn-primary\' type=\'button\'>确定</button>\r\n                <button name="cancel" class=\'btn btn-primary\' type=\'button\'>关闭</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("window/global",["text!template/global.html","window/base","tool/util"],function(t,e,n){var i=$(t),o=i.find("[name=topo_exprop]").hide(),r=i.find("[name=topo_auto_layout]").hide(),a=i.find("[name=alarm_config]").hide();return $("body").append(i),{initAlarmConfig:function(t){var n=a.find(".panel-heading"),i=a.find("button[name='ok']"),o=a.find("button[name='cancel']"),r=a.find(".size_group"),s=a.find("[name=size_num]"),l=t.prop.config.alarm?t.prop.config.alarm:t.prop.config.alarm={};a.find(".close").click(function(){o.click()}),e.moveable(n,a),e.resizeNum(r,{bottom:10,step:2}),a.css(e.defaultPosition),a.on("resetWindow",function(){a.css(e.defaultPosition),a.hide()});var c=[];if(l.color&&l.color instanceof Array){s.val(l.size||12);var h,d;$.each(l.color,function(t,n){h=$("<div class='form-group'></div>").append("<label class='col-sm-4 control-label'>告警等级:"+(t+1)+"</label>"),a.find(".form-horizontal").append(h),h.append("<div class=' col-sm-7'><div class='input-group'></div></div>"),d=$("<input name='selected_color' type='text' class='form-control' readonly='true'>"),d.val(n),c.push(d),h.find(".input-group").append(d).append("<span class='input-group-btn'><button class='btn btn-primary' type='button' data-toggle='dropdown'><span class='glyphicon glyphicon-search'></span></button><ul class='dropdown-menu color_selected' ><li><div name='color_palette'></div></li></ul></span>"),e.colorSelect(d,h.find("[name=color_palette]"))})}return i.click(function(){var e=[];$.each(c,function(t,n){e.push(n.val())}),l.color=e,$.each(t.findElements(function(t){return"node"==t.elementType&&t.alarm&&t.prop.alarmLevel}),function(t,e){e.drawAlarm({size:s.val()})})}),{win:a,okBtn:i,cancelBtn:o}},initExProp:function(t){function n(){var t=$(p),e=t.find("input:eq(0)"),n=t.find("input:eq(1)");a.append(t),t.find("button[name='remove']").click(function(){t.remove(),o.item.splice(o.item.indexOf(t))}),o.item.push({row:t,key:e,value:n})}function i(t){o.target=t,r.find("span:first").html('[业务属性配置]   Name: <span name="prop">'+t.prop.name+'</span>  id: <span name="prop">'+t.prop.id+"</span>"),$.each(t.exprop,function(t,e){var i=o.item[o.item.length-1];i.key.val(t),i.value.val(e),n()}),o.show()}var r=o.find(".panel-heading"),a=o.find("form"),s=o.find(".form-group"),l=o.find("input:eq(0)"),c=o.find("input:eq(1)"),h=o.find("button[name='add']"),d=(o.find('div[name="group"]'),o.find("button[name='ok']")),u=o.find("button[name='cancel']");o.find(".close").click(function(){u.click()}),e.moveable(r,o),o.css(e.defaultPosition),o.item=[],o.item.push({row:s,key:l,value:c});var p=" <div class='form-group' ><div class='col-sm-5'><input type='text' class='form-control' ></div><div class='col-sm-6'><input type='text' class='form-control'></div><div class='col-sm-1'><button type='button' class='btn btn-primary'name='remove'><span class='glyphicon glyphicon-minus-sign'></span></button></div></div>";return h.click(function(){n()}),o.on("resetWindow",function(){$.each(o.item,function(t,e){t>0&&e.row.remove()}),l.val(""),c.val(""),o.item.length=1,o.css(e.defaultPosition),o.hide()}),u.click(function(){o.trigger("resetWindow")}),d.click(function(){$.each(o.item,function(t,e){e.key.val()&&(o.target.exprop[e.key.val().trim()]=e.value.val().trim())}),o.trigger("resetWindow")}),{win:o,addBtn:h,okBtn:d,cancelBtn:u,edit:i}},initAutoLayout:function(t){function i(t,n){t.percent=n,e.setPercent(t,n)}function o(t){switch(t){case"default":p.show(),g.show(),y.show(),k.hide(),T.hide(),d.val("default");break;case"star":p.hide(),g.hide(),y.hide(),k.show(),T.show(),E.click(),d.val("star");break;default:p.hide(),g.hide(),y.hide(),k.hide(),T.hide()}}function a(t){return(t.inLinks?t.inLinks.length:0)+(t.outLinks?t.outLinks.length:0)}function s(t,e,n){e=parseInt(e),n=parseInt(n);var i=parseInt(t.x),o=parseInt(t.y),r=parseInt(e-i)/10,a=parseInt(n-o)/10;t.prop._tempX=e,t.prop._tempY=n;var s=setInterval(function(){Math.abs(e-i)>1&&(i+=r),Math.abs(n-o)>1&&(o+=a),t.setLocation(parseInt(i),parseInt(o)),Math.abs(e-i)<=1&&Math.abs(n-o)<=1&&(clearInterval(s),delete t.prop._tempX,delete t.prop._tempY)},100)}function l(t,e,n,i,o){$.each(t.sort(function(t,e){return a(e)-a(t)}),function(t,r){s(r,o.x+t%e*i,o.y),(t+1)%e==0&&(o.y+=n)})}function c(e){function i(t,e){e.length>0&&(o(t,e),$.each(e,function(t,e){i(e,c(e))}))}function o(t,e){var n="asc"==T.mode,i=1;n||$.each(e,function(t,e){a(e)>i&&(i=a(e))});var o=0,s=[],l=[],c=[],h=e;do{if(s=[],l=[],$.each(h,function(t,e){n?a(e)>i?l.push(e):s.push(e):a(e)>i?s.push(e):l.push(e)}),s.length>=3)o+=d,c.length>0&&(s=s.concat(c),c=[]),r(t,o,s),o>u&&(u=o);else{if(l.length<3){o+=2*d/3,c.length>0&&(s=s.concat(c),c=[]),r(t,o||d/2,s.concat(l)),o>u&&(u=o);break}c=s.concat(c)}n?i++:i--,h=l}while(h.length>0)}function r(t,e,n,i){var o=Math.PI*Math.random();i&&(o=i);for(var r=0;r<n.length;r++){var a=parseInt((t.prop._tempX||t.x)+e*Math.cos(o+2*Math.PI*r/n.length)),l=parseInt((t.prop._tempY||t.y)+e*Math.sin(o+2*Math.PI*r/n.length));s(n[r],a,l)}}function c(t){var i=[];return t.outLinks&&$.each(t.outLinks,function(t,o){n.arrayDelete(e,o.nodeZ)&&i.push(o.nodeZ)}),t.inLinks&&$.each(t.inLinks,function(t,o){n.arrayDelete(e,o.nodeA)&&i.push(o.nodeA)}),i.sort(function(t,e){return a(e)-a(t)})}if(console.info(T.mode),0!=e.length){var h=e.slice().sort(function(t,e){return a(e)-a(t)}),d=25*(a(h[0])>2?a(h[0]):h.length)*(k.percent/100),u=0,p=n.getCenterPosition(t),f={x:p.x,y:p.y},m=0;$.each(h,function(t,o){if(a(o)<3)return!0;if(n.arrayDelete(e,o)){var r=c(o);s(o,f.x,f.y),i(o,r,d),m++,f.x+=2*u,m%2==0&&(f.y+=2*u,f.x=p.x)}}),e.length>0&&l(e,Math.ceil(Math.sqrt(e.length)),3*e[0].width/2,3*e[0].height/2,{x:p.x-u*Math.cos(Math.PI/4)-Math.ceil(Math.sqrt(e.length))*e[0].width*3/2,y:p.y-u*Math.cos(Math.PI/4)-Math.ceil(Math.sqrt(e.length))*e[0].height*3/2})}}var h=r.find(".panel-heading"),d=r.find("[name=layout]"),u=r.find("[name=each_row_group]"),p=u.find("[name=each_row_num]"),f=r.find("[name=row_space_group]"),m=f.find(".progress"),g=f.find(".progress-bar"),v=r.find("[name=column_space_group]"),b=v.find(".progress"),y=v.find(".progress-bar"),w=r.find("[name=radius_group]"),x=w.find(".progress"),k=w.find(".progress-bar"),_=r.find("[name=order_group]"),T=_.find("[name=order]"),E=_.find("[name=order][value=asc]"),C=(_.find("[name=order][value=des]"),r.find("[name=ok]")),P=r.find("[name=cancel]");return r.find(".close").click(function(){P.click()}),r.css(e.defaultPosition),e.resetHide([p,g,y,k,T],[u,f,v,w,_]),e.moveable(h,r),e.resizeNum(u,{bottom:1,step:1}),e.progressClick(m,g),e.progressClick(b,y),e.progressClick(x,k),i(g,100),i(y,100),i(k,100),T.click(function(){T.mode=$(this).val()}),e.initSelect(d,t),d.baseChose=o,o("default"),r.on("resetWindow",function(){r.css(e.defaultPosition),o("default"),p.val(5),i(g,100),i(y,100),i(k,100),r.hide()}),P.click(function(){r.triggerHandler("resetWindow")}),d.triggerBtn(C),d.addItems([{value:"default",name:"自定义",do:function(t){l(t.findElements(function(t){return"node"==t.elementType&&!t.prop.container}),p.val(),1.5*g.percent,1.5*y.percent,{x:0-t.translateX,y:0-t.translateY})}},{value:"star",name:"群星",do:function(t){c(t.findElements(function(t){return"node"==t.elementType&&!t.prop.container}))}},{value:"ring",name:"圆环",do:function(t){JTopo.layout.circleLayoutNodes(t.stage.find("node"),{animate:{time:1e3}})}}]),{win:r,layout:d,okBtn:C,cancelBtn:P}}}}),define("tool/winHandler",["window/toolbar","window/nodeAttribute","window/linkAttribute","window/containerAttribute","window/toolWindow","window/global","element/Node","element/Link","tool/util","JTopo"],function(t,e,n,i,o,r,a,s,l){function c(o,a,s){if(u)return!0;d(),u=t.init(a),p=e.initImageNode(a),f=e.initTextNode(a),m=n.initLink(a),g=n.initLine(a),v=i.init(a),b=r.initExProp(a),y=r.initAutoLayout(a),w=r.initAlarmConfig(a);var l=s||{};h(o,a,l),u.modeBtns.click(function(){var t=$(this).find("input").val();a.setMode(t)}),y.cancelBtn.click(function(){u.edit_autoLayout.click()}),p.okBtn.click(function(){"create"==p.win.mode&&u.edit_createImage.click()}),p.cancelBtn.click(function(){"create"==p.win.mode?u.edit_createImage.click():p.win.trigger("resetWindow")}),f.okBtn.click(function(){"create"==f.win.mode&&u.edit_createText.click()}),f.cancelBtn.click(function(){"create"==f.win.mode?u.edit_createText.click():f.win.trigger("resetWindow")}),g.cancelBtn.click(function(){u.edit_createLine.click()}),w.cancelBtn.click(function(){u.edit_alarm_config.click()}),w.okBtn.click(function(){u.edit_alarm_config.click()})}function h(t,e,n){var i=e.prop.config;if(u){n&&$.each(n,function(t,e){e?u[t].show():u[t].hide()}),u.returnBtn.click(function(){e.goBack()});var r=0,a=0;u.fullScreen.click(function(t){if(window!=top){var e=$(window.parent.document.getElementById(i.frameId));if(!i.frameId)throw new Error("can't launch fullScreen need config frameId");if(u.fullScreen._isClick){if(r=e.width(),a=e.height(),!r||!a)throw new Error("can't launch fullScreen frameId not exist");e.width($(window.parent).width()),e.height($(window.parent).height()),l.launchFullScreen(window.parent.document.documentElement)}else r&&a&&(e.width(r),e.height(a),r=a=0),l.exitFullScreen(window.parent.document)}else u.fullScreen._isClick?l.launchFullScreen(document.documentElement):l.exitFullScreen(document)}),u.centerBtn.click(function(){t.centerAndZoom()}),u.commonBtn.click(function(){e.scaleX=1,e.scaleY=1}),u.exportImg.click(function(){var e=t.canvas.toDataURL("image/png"),n=window.open("about:blank","image from canvas");n.document.write("<img src='"+e+"' alt='from canvas'/>")}),u.zoomOut.click(function(){t.zoomOut()}),u.zoomIn.click(function(){t.zoomIn()}),u.zoomCheck.click(function(){u.zoomCheck._isClick?t.wheelZoom||(t.wheelZoom=.85):t.wheelZoom=null}),u.printBtn.click(function(){window.print()}),u.eagleEye.click(function(){t.eagleEye.visible=u.eagleEye._isClick}),u.addSearchMode([{name:"名称",value:"name",search:function(t){return{results:e.findNode("name="+t.trim()),event:function(t){l.nodeAsCenter(e,t)}}},deepSearch:function(t){return{url:"http://202.102.36.137:9004/newui/liposs/plattopo/topo/platTopo!findDev.action?areaId=1&type=2&s="+t.trim(),filter:function(t){var e=[];return t&&(console.info(t),t=t.replace(/'/g,'"'),t=$.parseJSON(t),$.each(t,function(t,n){e.push({id:n.id,pid:n.pid,prop:{name:n.name,content:n.ip+" | "+n.model+" | "}})})),e},event:function(t){e.goDown(t.pid,function(){l.nodeAsCenter(e,e.findNode("id="+t.id)[0])})}}}},{name:"ID",value:"id",search:function(t){return{results:e.findNode("id="+t.trim()),event:function(t){l.nodeAsCenter(e,t)}}},deepSearch:function(t){return{url:"http://202.102.36.137:9004/newui/liposs/plattopo/topo/platTopo!findDev.action?areaId=1&type=4&s="+t.trim(),filter:function(t){var e=[];return t&&(t=t.replace(/'/g,'"'),console.info(t),t=$.parseJSON(t),$.each(t,function(t,n){e.push({id:n.id,pid:n.pid,prop:{name:n.name,content:n.ip+" | "+n.model+" | "}})})),e},event:function(t){e.goDown(t.pid,function(){l.nodeAsCenter(e,e.findNode("id="+t.id)[0])})}}}},{name:"IP",value:"ip",deepSearch:function(t){return{url:"http://202.102.36.137:9004/newui/liposs/plattopo/topo/platTopo!findDev.action?areaId=1&type=1&s="+t.trim(),filter:function(t){var e=[];return t&&(t=t.replace(/'/g,'"'),console.info(t),t=$.parseJSON(t),$.each(t,function(t,n){e.push({id:n.id,pid:n.pid,prop:{name:n.name,content:n.ip+" | "+n.model+" | "}})})),e},event:function(t){e.goDown(t.pid,function(){l.nodeAsCenter(e,e.findNode("id="+t.id)[0])})}}}},{name:"基本属性",value:"prop",search:function(t){return{results:e.findNode(t.trim()),event:function(t){l.nodeAsCenter(e,t)}}}},{name:"业务属性",value:"exprop",search:function(t){return{results:e.findNode(t.trim(),!0),event:function(t){l.nodeAsCenter(e,t)}}}}]),u.searchBtn.click(function(){u.doSearch()}),u.edit_autoLayout.click(function(){u.edit_autoLayout._isClick?y.win.show():y.win.trigger("resetWindow")}),u.edit_createImage.click(function(){u.edit_createImage._isClick?(p.head.find("span:first").text("创建节点"),p.win.show(),p.win.mode="create"):p.win.trigger("resetWindow")}),u.edit_createText.click(function(){u.edit_createText._isClick?(f.head.find("span:first").text("创建文本"),f.win.show(),f.win.mode="create"):f.win.trigger("resetWindow")}),u.edit_createLink.click(function(){u.edit_createLink._isClick?(e.initLinkEditMode(u.edit_createLink),e.setMode("linkEdit"),o.alert({title:"链路编辑模式",content:"<h3>使用说明:</h3><h4>首次左键选中节点作为链路起点，次选节点为终点，连续两次选中不同节点则建立链接。</h4><h3>Error:</h3><h4>暂不支持对分组,分组的缩放节点,分组成员之间创建链接!</h4>"})):e.setMode("edit")}),u.edit_createLine.click(function(){u.edit_createLine._isClick?(e.setMode("linkEdit"),g.win.trigger("drawLine")):(g.win.trigger("resetWindow"),e.setMode("edit"))}),u.edit_save.click(function(){o.confirm({title:"保存拓扑",content:"<h4>确定保存当前拓扑数据?</h4>",handler:function(t){t?e.saveTopo():console.info("cancel save")}})}),u.edit_alarm_config.click(function(){u.edit_alarm_config._isClick?w.win.show():w.win.trigger("resetWindow")})}}function d(){"use strict";var t=[["#000000","#424242","#636363","#9C9C94","#CEC6CE","#EFEFEF","#F7F7F7","#FFFFFF"],["#FF0000","#FF9C00","#FFFF00","#00FF00","#00FFFF","#0000FF","#9C00FF","#FF00FF"],["#F7C6CE","#FFE7CE","#FFEFC6","#D6EFD6","#CEDEE7","#CEE7F7","#D6D6E7","#E7D6DE"],["#E79C9C","#FFC69C","#FFE79C","#B5D6A5","#A5C6CE","#9CC6EF","#B5A5D6","#D6A5BD"],["#E76363","#F7AD6B","#FFD663","#94BD7B","#73A5AD","#6BADDE","#8C7BC6","#C67BA5"],["#CE0000","#E79439","#EFC631","#6BA54A","#4A7B8C","#3984C6","#634AA5","#A54A7B"],["#9C0000","#B56308","#BD9400","#397B21","#104A5A","#085294","#311873","#731842"],["#630000","#7B3900","#846300","#295218","#083139","#003163","#21104A","#4A1031"]],e=function(t,e){t.addClass("bootstrap-colorpalette");var n=[];$.each(e,function(t,e){n.push("<div>"),$.each(e,function(t,e){var i=['<button type="button" class="btn-color" style="background-color:',e,'" data-value="',e,'" title="',e,'"></button>'].join("");n.push(i)}),n.push("</div>")}),t.html(n.join(""))},n=function(t){t.element.on("click",function(e){var n=$(e.target),i=n.closest(".btn-color");if(i[0]){var o=i.attr("data-value");t.value=o,t.element.trigger({type:"selectColor",color:o,element:t.element})}})},i=function(i,o){this.element=i,e(i,o&&o.colors||t),n(this)};$.fn.extend({colorPalette:function(t){return this.each(function(){var e=$(this),n=e.data("colorpalette");n||e.data("colorpalette",new i(e,t))}),this}})}var u,p,f,m,g,v,b,y,w;return{init:c,getTools:function(){return o},setMode:function(t){u.setMode(t)},getToolBar:function(){return u},editImage:function(t){p.edit(t)},editText:function(t){f.edit(t)},editLink:function(t){m.edit(t)},editExprop:function(t){b.edit(t)},createContainer:function(t){v.create(t)},editContainer:function(t){v.edit(t)}}}),define("tool/brush",["element/Link","element/Node","element/Container","tool/util","tool/winHandler"],function(t,e,n,i,o){function r(t,e){var n=t;if($.each(e,function(t,e){n=n[e]}),!n)throw new Error("topo_brush's data path error"+e);return n}function a(a){function s(i){if(console.info("TOPO data:"),console.info(i),"string"==typeof i&&(i=$.parseJSON(i.replace(/'/g,'"'))),console.info("TOPO json:"),console.info(i),p.topo.stopFlag){var a=r(i,p.topo.stopFlag.split("."));if(!a||"number"==typeof a.length&&0==a.length)return console.info("trigger the stop flag"),o.getTools().progress({now:100,text:"no data to draw",error:!0}),"stop"}l.clear();var s;if(p.scene){s=p.scene.prop||{};var h=r(i,p.scene.source.split("."));l.prop.id=h.id||h[s.id]||"",l.prop.pid=h.pid||h[s.pid]||"",l.prop.name=h.name||h[s.name]||"",p.scene.exprop&&$.each(p.scene.exprop,function(t,e){l.exprop[t]=e})}var d=0,f=0;if(p.xy){s=p.xy.prop||{};var m=r(i,p.xy.source.split("."));if(d=parseInt(m.offsetX||m[s.offsetX]||0),f=parseInt(m.offsetY||m[s.offsetY]||0),p.xy.option)switch(p.xy.option){case"minus":d=-d,f=-f;break;case"add":}}if(l.prop.offsetX=d,l.prop.offsetY=f,p.node&&(s=p.node.prop||{},$.each(r(i,p.node.source.split(".")),function(t,n){var i=e.createNode({name:n.name||n[s.name],text:n.name||n[s.name],x:parseInt(n.x||n[s.x])+d,y:parseInt(n.y||n[s.y])+f,image:(p.node.imagePath||p.imagePath||"")+(n.image||n[s.image]||""),id:n.id||n[s.id],pid:n.pid||n[s.pid]});p.node.exprop&&$.each(p.node.exprop,function(t,e){i.exprop[t]=n[e]}),l.addElement(i)})),p.object&&(s=p.object.prop||{},$.each(r(i,p.object.source.split(".")),function(t,n){var i;switch(n.type){case"ztype.shape":i=e.createShape({name:n.name||n[s.name],text:n.name||n[s.name],id:n.id||n[s.id],pid:n.pid||n[s.pid],x:parseInt(n.x||n[s.x])+d,y:parseInt(n.y||n[s.y])+f,width:parseInt(n.width||n[s.width]),height:parseInt(n.height||n[s.height]),alpha:.5,nodeType:"ztype.shape"});break;case"ztype.topo":i=e.createNode({name:n.name||n[s.name],text:n.name||n[s.name],x:parseInt(n.x||n[s.x])+d,y:parseInt(n.y||n[s.y])+f,image:(p.object.imagePath||p.imagePath||"")+(n.image||n[s.image]||""),nodeType:"ztype.topo",id:n.id||n[s.id],pid:n.pid||n[s.pid]})}p.object.exprop&&$.each(p.object.exprop,function(t,e){i.exprop[t]=n[e]}),l.addElement(i)})),p.link){s=p.link.prop||{};var g;$.each(r(i,p.link.source.split(".")),function(e,n){g=t.directLink({start:l.findNode("id="+(n.start||n[s.start]))[0],end:l.findNode("id="+(n.end||n[s.end]))[0],text:n.name||n[s.name],name:n.name||n[s.name],id:n.id||n[s.id],pid:n.pid||n[s.pid]}),p.link.exprop&&$.each(p.link.exprop,function(t,e){g.exprop[t]=n[e]}),l.addElement(g)})}if(p.container){s=p.container.prop||{};var v;$.each(r(i,p.container.source.split(".")),function(t,e){v=n.create({name:e.name||e[s.name],text:e.name||e[s.name],id:e.id||e[s.id],pid:e.pid||e[s.pid]},l),$.each(e.object||e[s.object],function(t,e){var n=l.findNode("id="+e.id)[0];n&&"container"!=n.prop.nodeType&&v.addNode(n)}),$.each(e.node||e[s.node],function(t,e){var n=l.findNode("id="+e.id)[0];n&&v.addNode(n)}),p.container.exprop&&$.each(p.container.exprop,function(t,n){v.exprop[t]=e[n]}),l.addElement(v)})}return o.getToolBar().centerBtn.click(),o.getTools().progress({now:70,text:"正在绘制告警!"
}),u[l.prop.config.brush].drawAlarm(l,c),"success"}var l=a.scene,c=a.id,h=a.fn;o.getTools().progress({now:30,text:"30%"});var p=l.prop.config;if(!p.topo||!p.topo.url)return console.info("need config topo"),void o.getTools().progress({now:100,text:"need config topo",error:!0});var f=p.topo.url;if(p.topo.params){var m="";$.each(p.topo.params,function(t,e){if(d&&(m=i.getParameter(e.key)),f+=0==t?"?"+e.key+"=":"&"+e.key+"=",m)f+=m;else switch(e.type){case"scenePid":f+=c?c:e.value;break;case"fixed":f+=e.value}}),d=!1}$.ajax({url:f,async:!0,type:"POST",success:function(t){var e=s(t);l.prop.url=f,h&&$.isFunction(h)&&"success"==e&&h(t)},error:function(t){console.info("topo data empty"),o.getTools().progress({now:100,text:"topo data load empty",error:!0})}})}function s(t){return t.alarm&&t.alarm.url?(t.alarm.color||(t.alarm.color=["255,0,0","255, 102, 0","255,204,0","0,0,255"]),t.alarm.size||(t.alarm.size=20),t.alarm.font||(t.alarm.font="微软雅黑"),!0):(console.info("need config alarm_url"),o.getTools().progress({now:100,text:"100%"}),!1)}function l(t){function e(e){var i=e.node;return i?void $.each(i,function(e,i){var o=t.findNode("id="+i.id)[0];if(o){for(var r=0,a=n.alarm.color.length,s=n.alarm.color.length;s>0;s--)num=parseInt(i[s]),r+=num,num>0&&(a=s);o.drawAlarm({text:r,color:n.alarm.color[a-1],size:n.alarm.size,font:n.alarm.font,level:i.level})}}):(console.info("alarm data error"),!1)}var n=t.prop.config;s(n)&&(console.info("告警url:"+n.alarm.url),$.ajax({url:n.alarm.url,async:!0,type:"POST",success:function(t){console.info("告警数据:"),console.info(t),e(t),o.getTools().progress({now:100,text:"100%"})},error:function(t){console.info("no alarm to draw"),o.getTools().progress({now:100,text:"100%",error:!0})}}))}function c(t){function e(e){if(e=n(e),!e)return void console.info("alarm data error");var o=e.dev;$.each(o,function(e,n){var o=t.findNode("id="+e)[0];o&&o.drawAlarm({text:n.num,color:i.alarm.color[n.level-1],size:i.alarm.size,font:i.alarm.font,level:n.level})})}function n(t){return"string"==typeof t&&(t=$.parseJSON(t.replace(/'/g,'"'))),t.seg?($.each(t.seg,function(e,n){5==e?(t.seg[1]=n,delete t.seg[e]):4==e&&(t.seg[2]=n,delete t.seg[e])}),$.each(t.dev,function(t,e){5==e.level&&(e.level=1),4==e.level&&(e.level=2)}),t):void console.info("alarm data error")}var i=t.prop.config;if(s(i)){var r="",a="";$.each(t.findNode(),function(t,e){e.prop.id&&(r+=e.prop.id+",")}),$.each(t.findLink(),function(t,e){e.prop.id&&(r+=e.prop.id+",")});var l=i.alarm.url+"?objId="+r+"&linkId="+a+"&areaId=1";console.info("告警url:"+l),$.ajax({url:l,async:!0,type:"POST",success:function(t){console.info("告警数据:"),console.info(t),e(t),o.getTools().progress({now:100,text:"100%"})},error:function(t){console.info("no alarm to draw"),o.getTools().progress({now:100,text:"100%",error:!0})}})}}function h(t,e){var n=t.prop.config;if(n.save){var r=n.save.url;$.each(n.save.params,function(e,i){switch(r+=0==e?"?"+i.key+"=":"&"+i.key+"=",i.type){case"scene":r+=t.prop[i.value];break;case"fixed":r+=i.value;break;case"prop":var o=0,a=0;if(n.save.xy)switch(n.save.xy){case"minus":o=-t.prop.offsetX,a=-t.prop.offsetY;break;case"add":o=t.prop.offsetX,a=t.prop.offsetY}n.save.offsetX&&n.save.offsetY&&(o+=n.save.offsetX,a+=n.save.offsetY),$.each(t.findNode(),function(t,e){$.each(i.format.prop,function(t,n){switch(n){case"x":r+=parseInt(e.x)+o;break;case"y":r+=parseInt(e.y)+a;break;default:r+=e.prop[n]}t<i.format.prop.length-1&&(r+=i.format.divide)}),r+=i.divide})}})}i.ajax({url:r,do:function(t){e&&$.isFunction(e)&&e(t)},error:function(t){console.info(t),o.getTools().alert({content:"<h4>保存失败！</h4>"})}})}var d=!0,u=[{drawTopo:a,drawAlarm:l,saveTopo:h},{drawTopo:a,drawAlarm:c,saveTopo:h}];return u}),define("element/Scene",["tool/util","tool/brush","tool/winHandler","element/Link","JTopo"],function(t,e,n,i){function o(){r.call(this);var t=this;t.mode="drag",t.prop={name:"",id:"",pid:"",mode:"drag",eweight:1,path:[],mousemove:{target:"",x:0,y:0},offsetX:0,offsetY:0},t.exprop={},this.addEventListener("mousemove",function(e){t.prop.mousemove.target=e.target,t.prop.mousemove.x=e.x,t.prop.mousemove.y=e.y,t.prop.originX=-t.translateX,t.prop.originY=-t.translateY})}var r=JTopo.Scene;t.inherits(o,r),o.prototype.addElement=function(t){t.prop.scene=this,"container"==t.elementType&&this.add(t.prop.containerNode),this.add(t)},o.prototype.removeElement=function(t){var e=this;if(t){switch(t.prop&&(t.prop.scene="deleted"),t.elementType){case"container":t.show(),$.each(t.childs,function(t,e){e.prop.container=null}),this.remove(t.prop.containerNode);break;case"link":"child"!=t.prop.linkType&&t.prop.children&&$.each(t.prop.children,function(t,n){e.remove(n)})}this.remove(t)}},o.prototype.setMode=function(t){switch(t){case"select":this.mode=t,this.prop.mode=t;break;case"edit":this.mode=t,this.prop.mode=t;break;case"drag":this.mode=t,this.prop.mode=t;break;case"linkEdit":this.mode="select",this.prop.mode=t;break;default:this.mode="drag",this.prop.mode="drag"}},o.prototype.getAweight=function(){var t=0;switch(this.prop.mode){case"drag":t=0;break;case"select":t=1;break;case"edit":t=10;break;case"linkEdit":t=100}return t},o.prototype.findNode=function(t,e){var n=[];if(t)if($.isFunction(t))n=this.findElements(function(e){return"node"==e.elementType&&t(e)});else{var i=t.split("=");if(2==i.length){var o=i[0].trim(),r=i[1].trim();n=e?this.findElements(function(t){return"node"==t.elementType&&t.exprop[o]==r}):this.findElements(function(t){return"node"==t.elementType&&t.prop[o]==r})}}else n=this.findElements(function(t){return"node"==t.elementType&&"container"!=t.prop.nodeType});return n},o.prototype.findLink=function(t,e){var n=[];if(t)if($.isFunction(t))n=this.findElements(function(e){return"link"==e.elementType&&t(e)});else{var i=t.split("=");if(2==i.length){var o=i[0],r=i[1];n=e?this.findElements(function(t){return"link"==t.elementType&&t.exprop[o]==r}):this.findElements(function(t){return"link"==t.elementType&&t.prop[o]==r})}}else n=this.findElements(function(t){return"link"==t.elementType});return n},o.prototype.findContainer=function(t,e){var n=[];if(t)if($.isFunction(t))n=this.findElements(function(e){return"container"==e.elementType&&t(e)});else{var i=t.split("=");if(2==i.length){var o=i[0],r=i[1];n=e?this.findElements(function(t){return"container"==t.elementType&&t.exprop[o]==r}):this.findElements(function(t){return"container"==t.elementType&&t.prop[o]==r})}}else n=this.findElements(function(t){return"container"==t.elementType});return n},o.prototype.goBack=function(t){var i=this;if(this.prop.path.length>1){for(var o=this.prop.path[this.prop.path.length-2];o==this.prop.path[this.prop.path.length-1]&&this.prop.path.length-2>0;)i.prop.path.pop(),o=this.prop.path[this.prop.path.length-2];e[this.prop.config.brush].drawTopo({scene:this,id:o,type:"goBack",fn:function(e){i.prop.path.pop(),t&&$.isFunction(t)&&t(e)}})}else n.getTools().alert({content:"<h4>已到达最顶层</h4>"})},o.prototype.goDown=function(t,n){var i=this;e[this.prop.config.brush].drawTopo({scene:this,id:t,type:"goDown",fn:function(e){i.prop.path.push(t),n&&$.isFunction(n)&&n(e)}})},o.prototype.refresh=function(){e[this.prop.config.brush].drawTopo({scene:this,id:this.prop.pid,type:"refresh"})},o.prototype.saveTopo=function(){var t=this;e[t.prop.config.brush].saveTopo(t,function(t){1==t?n.getTools().alert({content:"<h4>保存成功！</h4>"}):n.getTools().alert({content:"<h4>保存失败!请登录后尝试！</h4>"})})};var a=!1;return o.prototype.initLinkEditMode=function(t){if(!a){a=!0;var e=this,n=null,o=new JTopo.Node;o.setSize(1,1);var r=new JTopo.Node;r.setSize(1,1);var s=i.directLink({start:o,end:r});e.mouseup(function(a){if("linkEdit"!=e.prop.mode||!t||!t._isClick||2==a.button)return void e.removeElement(s);if(null!=a.target&&(a.target instanceof JTopo.Node||a.target instanceof JTopo.Container))if(null==n)n=a.target,e.add(s),o.setLocation(a.x,a.y),r.setLocation(a.x,a.y);else if(n!==a.target){var l=a.target;if("node"==n.elementType&&"container"==n.prop.nodeType||"node"==l.elementType&&"container"==l.prop.nodeType);else if("node"==n.elementType&&n.prop.container&&"node"==l.elementType&&l.prop.container);else if("container"==n.elementType||"container"==l.elementType);else{var c=i.directLink({start:n,end:l});e.add(c),n=null,e.remove(s)}}else n=null;else n=null,e.remove(s)}),e.mousedown(function(i){(null==i.target||i.target===n||i.target===s)&&"linkEdit"==e.prop.mode&&t&&t._isClick&&e.remove(s)}),e.mousemove(function(n){"linkEdit"==e.prop.mode&&t&&t._isClick&&r.setLocation(n.x,n.y)})}},o}),define("window/Menu",[],function(){function t(t){this.body=$("<ul "+(t?"name="+t:"")+" class='dropdown-menu' role='menu' >"),this.item=[]}return t.prototype={setTrigger:function(t,e){function n(e){o.target=t.prop.mousemove.target,o.x=t.prop.mousemove.x,o.y=t.prop.mousemove.y,i(o.item,o.target),o.body.css({left:e.pageX-50,top:e.pageY-20}).show()}function i(t,e){$.each(t,function(t,n){n.filter&&"item"==n.type?n.filter(e)?(n.body.show(),n.divider?n.divider.show():""):(n.body.hide(),n.divider?n.divider.hide():""):"subMenu"==n.type&&(n.filter&&(n.filter(e)?(n.includer.show(),n.divider?n.divider.show():""):(n.includer.hide(),n.divider?n.divider.hide():"")),i(n.body.item,e))})}var o=this,r=e||{},a=r.filter,s=r.listener||t,l="undefined"!=typeof r.buttonKey?r.buttonKey:2,c=r.action||"mouseup";return this.trigger?($(this.trigger.listener).off(this.trigger.action,this.trigger.fn),this.trigger.listener=s,this.trigger.buttonKey=l,this.trigger.action=c,this.trigger.filter=a,void $(this.trigger.listener).on(this.trigger.action,this.trigger.fn)):(this.trigger={listener:s,action:c,buttonKey:l,filter:a,fn:function(t){a?a(t)&&n(t):t.button==o.trigger.buttonKey?n(t):o.trigger.buttonKey==-1&&n(t)}},$("body").append(this.body),$(this.trigger.listener).on(this.trigger.action,this.trigger.fn),void this.body.on("mouseleave mouseup click",function(t){t.stopPropagation(),o.body.hide()}))},addItem:function(t){var e,n=t||{},i=n.name||"NoName",o=n.icon||"",r=n.color||"bluelight";n.divide&&(e=$("<li class='divider'>"),this.body.append(e));var a=$("<li><div class='buttonSquare "+r+"'><i class='"+o+"'></i><span>"+i+"</span></div></li>");a.click(n.handler),this.body.append(a),this.item.push({body:a,type:"item",name:i,divider:e,filter:n.filter})},addSubMenu:function(e){var n,i=e||{},o=i.name||"NoName",r=i.icon||"fa fa-navicon",a=i.color||"bluelight",s=new t,l=$("<li class='dropdown-submenu'><div class='buttonSquare "+a+"'><i class='"+r+"'></i><span>"+o+"</span></div></li>");return i.divide&&(n=$("<li class='divider'>"),this.body.append(n)),this.body.append(l),l.append(s.body),this.item.push({body:s,type:"subMenu",name:o,divider:n,includer:l,filter:i.filter}),s},removeItem:function(){}},t}),define("tool/rightMenu",["tool/util","window/Menu","tool/winHandler","element/Node"],function(util,Menu,winHandler,Node){function filterForMenu(t){var e=[];return t&&$.each(t.menus.menu,function(t,n){"undefined"==typeof n.dblclick&&e.push(n)}),e}function isInclude(t,e){return!(!t||!e)&&("string"!=typeof t&&(t+=""),"string"!=typeof e&&(e+=""),"1"==t.charAt(t.length-e.length))}var STAGE,SCENE,storeElement,copyElement,mytarget,Default={item:{TopoEvent_DEBUG:function(t){return{name:"Debug",icon:"fa fa-info",handler:function(){var e="";element=t.target,element||(element=SCENE),console.info(element),"node"==element.elementType||"container"==element.elementType?e+="<h5>X:&nbsp;"+element.x+"&nbsp;&nbsp;Y:&nbsp;"+element.y+"</h5>":"link"==element.elementType&&"line"!=element.prop.useType?e+="<h4>From:</h4><h5>&nbsp;&nbsp;&nbsp;&nbsp;name:"+element.nodeA.prop.name+"</h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;id:"+element.nodeA.prop.id+"</h5><h4>To:</h4><h5>&nbsp;&nbsp;&nbsp;&nbsp;name:"+element.nodeZ.prop.name+"</h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;id:"+element.nodeZ.prop.id+"</h5>":"scene"==element.elementType&&(e+="<h4>Elements:"+element.childs.length+"</h4>"),e+="<h4>Prop:</h4>",$.each(element.prop,function(t,n){n instanceof Array?(e+="<h5>&nbsp;&nbsp;&nbsp;&nbsp;"+t+":&nbsp;[",$.each(n,function(t,n){e+="&nbsp;"+n}),e+="]</h5>"):n&&n.elementType&&("node"==n.elementType||"container"==n.elementType)?e+="<h5>&nbsp;&nbsp;&nbsp;&nbsp;"+t+":&nbsp;"+(n.prop.name||n)+"</h5>":n&&n instanceof Object&&!n._id?(e+="<h5>&nbsp;&nbsp;&nbsp;&nbsp;"+t+":&nbsp;[",$.each(n,function(t,n){e+="&nbsp;"+t+"&nbsp;:"+n+","}),e+="]</h5>"):e+="<h5>&nbsp;&nbsp;&nbsp;&nbsp;"+t+":&nbsp;"+n+"</h5>"}),winHandler.getTools().alert({title:"Debug",content:e})}}},TopoEvent_REFRESH:function(){return{name:"刷新",icon:"fa fa-refresh fa-spin",handler:function(){SCENE.refresh()},filter:function(t){return!t}}},TopoEvent_SHOWTOOLBAR:function(){return{name:"显示工具栏",icon:"fa fa-gears",handler:function(){winHandler.getToolBar().show()},filter:function(t){return!t&&"none"==winHandler.getToolBar().fatherBar.css("display")}}},TopoEvent_HIDETOOLBAR:function(){return{name:"隐藏工具栏",icon:"fa fa-gears",handler:function(){winHandler.getToolBar().hide()},filter:function(t){return!t&&"none"!=winHandler.getToolBar().fatherBar.css("display")}}},TopoEvent_DELETE:function(t){return{name:"删除对象",icon:"fa fa-trash-o",handler:function(){var e=SCENE.selectedElements;winHandler.getTools().confirm({content:"<h4>尝试删除"+e.length+"个对象？</h4>",width:300,handler:function(n){n&&e.length>1?$.each(e,function(t,e){SCENE.removeElement(e)}):n&&SCENE.removeElement(t.target)}})},filter:function(t){return t&&!("container"==t.elementType||"node"==t.elementType&&"container"==t.prop.nodeType)}}},TopoEvent_GO_BACK:function(){return{name:"返回上一层",icon:"fa fa-reply-all",handler:function(){SCENE.goBack()},filter:function(){return SCENE.prop.path.length>1}}},TopoEvent_CUT:function(t){return{name:"剪切单个节点",icon:"glyphicon glyphicon-copyright-mark",handler:function(){storeElement||t.target&&"node"==t.target.elementType&&(storeElement=t.target,storeElement.hide(),util.toggleElemnts(storeElement.inLinks),util.toggleElemnts(storeElement.outLinks))},filter:function(t){return t&&"node"==t.elementType&&"node"==t.prop.nodeType&&!storeElement}}},TopoEvent_CANCAL_CUT:function(){return{name:"取消剪切",icon:"fa fa-close",handler:function(){storeElement&&(storeElement.show(),util.toggleElemnts(storeElement.inLinks),util.toggleElemnts(storeElement.outLinks),storeElement="")},filter:function(){return storeElement&&!storeElement.visible}}},TopoEvent_PASTE:function(t){return{name:"黏贴剪切",icon:"fa fa-paypal",handler:function(){storeElement&&(storeElement.show(),SCENE.childs.indexOf(storeElement)>0?(util.toggleElemnts(storeElement.inLinks),util.toggleElemnts(storeElement.outLinks)):SCENE.addElement(storeElement),storeElement.setLocation(t.x,t.y),storeElement="")},filter:function(){return storeElement&&!storeElement.visible}}},TopoEvent_COPY:function(t){return{name:"复制单个对象",icon:"glyphicon glyphicon-copyright-mark",handler:function(e){var n=t.target;n&&"node"==n.elementType&&"node"==n.prop.nodeType&&(copyElement=Node.createNode({textPosition:n.textPosition,text:n.text,zIndex:n.zIndex,alpha:n.alpha,image:n.prop.image,width:n.width,height:n.height}),$.each(n.prop,function(t,e){copyElement.prop[t]=e}),$.each(n.exprop,function(t,e){copyElement.exprop[t]=e}))},filter:function(t){return t&&"node"==t.elementType&&"node"==t.prop.nodeType}}},TopoEvent_PASTE_COPY:function(t){return{name:"黏贴复制",icon:"fa fa-paypal",handler:function(e){copyElement&&(copyElement.setLocation(t.x,t.y),SCENE.addElement(copyElement),copyElement="")},filter:function(t){return copyElement&&copyElement.visible}}},TopoEvent_SELECT_ALL:function(){return{name:"全选",icon:"fa fa-filter",handler:function(){$.each(SCENE.childs,function(t,e){"node"==e.elementType&&"node"==e.prop.nodeType&&(e.selected=!0,SCENE.selectedElements.push(e))})},filter:function(t){return!t&&SCENE.getAweight()>0}}},TopoEvent_SELECT_UNSELECTED:function(){return{name:"反选",icon:"fa fa-close",handler:function(){$.each(SCENE.childs,function(t,e){"node"==e.elementType&&"node"==e.prop.nodeType&&(e.selected=!1)})},filter:function(t){return!t&&SCENE.getAweight()>0}}},TopoEvent_MODIFY_NODE:function(t){return{name:"编辑节点",icon:"fa fa-cog fa-spin",handler:function(){winHandler.editImage(t.target)},filter:function(t){return t&&"node"==t.elementType&&"node"==t.prop.nodeType}}},TopoEvent_MODIFY_TEXT:function(t){return{name:"编辑文本",icon:"fa fa-cog fa-spin",handler:function(){winHandler.editText(t.target)},filter:function(t){return t&&"TextNode"==t.elementType}}},TopoEvent_MODIFY_LINK:function(t){return{name:"编辑链路",icon:"fa fa-cog fa-spin",handler:function(){winHandler.editLink(t.target)},filter:function(t){return t&&"link"==t.elementType&&"line"!=t.prop.linkType&&"child"!=t.prop.linkType}}},TopoEvent_ELEMENT_VISIABLE_FALSE:function(t){return{name:"链路设为隐藏",icon:"glyphicon glyphicon-eye-close",handler:function(){t.target.hide()},filter:function(t){return t&&"link"==t.elementType}}},TopoEvent_ELEMENT_VISIABLE_TRUE:function(t){return{name:"显示全部",icon:"glyphicon glyphicon-eye-open",handler:function(){$.each(SCENE.childs,function(t,e){return"node"==e.elementType&&"container"==e.prop.nodeType||void(e.show&&e.show())})}}},TopoEvent_HIGHTLIGHT_CONNECT:function(t){return{name:"高亮相关网元",icon:"glyphicon glyphicon-eye-open",handler:function(){var e=t.target,n=[];n.push(e),$.each(SCENE.childs,function(t,e){"node"!=e.elementType&&"link"!=e.elementType||e.setAlpha()}),$.each(e.inLinks,function(t,e){util.arrayPush(n,e),util.arrayPush(n,e.nodeA),util.arrayPush(n,e.nodeZ)}),$.each(e.outLinks,function(t,e){util.arrayPush(n,e),util.arrayPush(n,e.nodeA),util.arrayPush(n,e.nodeZ)}),$.each(n,function(t,e){e.setAlpha(1)})},filter:function(t){return t&&"node"==t.elementType&&"container"!=t.prop.nodeType}}},TopoEvent_HIGHTLIGHT_CANCEL:function(t){return{name:"取消高亮",icon:"glyphicon glyphicon-eye-close",handler:function(){$.each(SCENE.childs,function(t,e){"node"!=e.elementType&&"link"!=e.elementType||e.setAlpha(1)})},filter:function(t){return t&&"node"==t.elementType&&"container"!=t.prop.nodeType}}},TopoEvent_OPENWINDOW:function(){return{name:"查看图层信息",icon:"glyphicon glyphicon-folder-open",handler:function(){SCENE.prop.url&&window.open(SCENE.prop.url,"_blank")},filter:function(t){return!t}}},TopoEvent_CREATE_GROUP:function(t){return{name:"创建分组",icon:"fa fa-plus",handler:function(){var e=SCENE.selectedElements;t.target&&winHandler.getTools().confirm({content:"<h4>将尝试为"+e.length+"个对象创建分组？</h4>",width:300,handler:function(t){t&&winHandler.createContainer(e)}})},filter:function(t){return t&&"node"==t.elementType&&!t.prop.container&&"container"!=t.prop.nodeType}}},TopoEvent_MODIFY_GROUP:function(t){return{name:"编辑分组",icon:"fa fa-cog fa-spin",handler:function(){var e=t.target;"container"==e.elementType?winHandler.editContainer(e):(console.info(),winHandler.editContainer(e.prop.expandTo))},filter:function(t){return t&&("container"==t.elementType||"node"==t.elementType&&"container"==t.prop.nodeType)}}},TopoEvent_REMOVE_FROM_GROUP:function(t){return{name:"从组中删除",icon:"fa fa-minus",handler:function(){t.target.prop.container.removeNode(t.target)},filter:function(t){return t&&t.prop.container}}},TopoEvent_DELETE_GROUP:function(t){return{name:"解散分组",icon:"fa fa-trash-o",handler:function(){var e;e="node"==t.target.elementType&&"container"==t.target.prop.nodeType?t.target.prop.expandTo:t.target,e.prop.setMember={showName:!0,showLink:!0},e.toggleExpand(),SCENE.removeElement(e)},filter:function(t){return t&&("container"==t.elementType||"node"==t.elementType&&"container"==t.prop.nodeType)}}},TopoEvent_CONFIG_PROPERTY:function(t){return{name:"配置业务属性",icon:"fa fa-cog fa-spin",handler:function(){t.target?winHandler.editExprop(t.target):winHandler.editExprop(SCENE)}}}},subItem:{}},rightMenu;return{init:function(t,e,n){if(STAGE=t,SCENE=e,rightMenu=new Menu("topo_rightMenu"),rightMenu.setTrigger(SCENE),$.each(Default.item,function(t,e){rightMenu.addItem(e(rightMenu))}),n){var i=filterForMenu(n),o=rightMenu.addSubMenu({name:"(参考)",divide:!0});$.each(i,function(t,e){o.addItem({name:e.name,handler:function(){console.info(e.action)},filter:function(t){return t||(t=SCENE),isInclude(e.aweight,SCENE.getAweight())&&isInclude(e.eweight,t.prop.eweight)}})})}},addUrlMenu:function(json){$.each(json,function(k,v){var level_Two=rightMenu.addSubMenu({name:k,filter:function(e){return e||(e=SCENE),!v.filter||eval("(function () {return "+v.filter+"})()")(e)}});$.each(v.item,function(i,m){level_Two.addItem({name:m.name,icon:"glyphicon glyphicon-folder-open",handler:function(){var param="";$.each(m.data,function(j,d){if(param+=j>0?"&":"?",param+=d.key+"=",d.fixed)d.value?param+=d.value:d.fn&&(param+=eval("(function () {return "+d.fn+"})()")());else if(d.fn)try{param+=eval("(function () {return "+d.fn+"})()")(rightMenu.target.prop[d.value])}catch(t){console.info(t),console.info("url menu run fn error")}else param+=rightMenu.target.prop[d.value]}),m.url?(window.open(m.url+param,"_blank"),console.info(m.url+param)):m.path&&(window.open("http://"+window.location.host+m.path+param,"_blank"),console.info("http://"+window.location.host+m.path+param))},filter:function(e){return e||(e=SCENE),!m.filter||eval("(function () {return "+m.filter+"})()")(e)}})})})}}}),define("controller/action",["tool/winHandler","tool/brush","tool/rightMenu","tool/util","JTopo"],function(t,e,n,i){var o=!1;return{loadTopo:function(o,r){t.getTools().progress({now:10,text:"10%"}),t.init(o,r,r.prop.config.toolbar),t.setMode(r.prop.config.default_mode||"drag"),i.ajax({url:r.prop.config.rightMenu_url,do:function(t){n.init(o,r,t),r.prop.config.urlMenu&&n.addUrlMenu(r.prop.config.urlMenu)}}),e[r.prop.config.brush].drawTopo({scene:r,fn:function(){r.prop.path.push(r.prop.pid)}})},addSceneListener:function(e){function n(t,n){t.ctrlKey?e.stage.wheelZoom||(n>0?e.stage.zoomOut():e.stage.zoomIn()):t.shiftKey?n>0?e.translateX+=200:e.translateX-=200:t.altKey||(n>0?e.translateY+=200:e.translateY-=200)}var r=function(t){o&&(t.preventDefault(),t=t||window.event,t.wheelDelta?(t.returnValue=!1,n(t,t.wheelDelta)):t.detail&&(t.returnValue=!1,n(t,t.detail)))};document.addEventListener&&document.addEventListener("DOMMouseScroll",r,!1),window.onmousewheel=document.onmousewheel=r,$(document).keydown(function(e){if(1==e.ctrlKey&&83==e.keyCode)return t.getToolBar().edit_save.click(),!1}),e.dbclick(function(t){var n=t.target;if(!n)return void console.info(this);if(console.info(n),n&&"container"==n.elementType)n.toggleExpand();else if(n&&"node"==n.elementType){if("node"==n.prop.nodeType)e.goDown(n.prop.id);else if("container"==n.prop.nodeType){var i=n.prop.expandTo;i.toggleExpand()}}else n&&"link"==n.elementType&&n.toggleExpend(e)}),e.mouseout(function(t){o=!1}),e.mousemove(function(e){o=!0;var n=e.target;if(n&&"node"==n.elementType){var r,a={name:n.prop.name,pid:n.prop.pid||"无"},s="",l=0;$.each(a,function(t,e){s+="<h5>&nbsp;&nbsp;"+t+":"+e+"</h5>",r=i.getStringWidth(t+":"+e)+20,r>l&&(l=r)}),t.getTools().tips({x:e.pageX+30,y:e.pageY+30,width:l,content:s})}else t.getTools().tips("hide")}),e.mouseup(function(n){if(0==n.button&&"edit"==this.prop.mode){var i=n.target;i&&"node"==i.elementType&&"container"!=i.prop.nodeType&&!i.prop.container&&$.each(e.findContainer(),function(e,n){if("container"==n.elementType&&n.isInside(i)&&n.prop.isExpand)return t.getTools().confirm({content:"是否加入分组?",handler:function(t){t&&(n.addNode(i),n.show())}}),!1})}}),e.mousedown(function(e){t.getTools().tips("hide")})}}}),require.config({paths:{JTopo:"core/jtopo/jtopo-min",template:"core/template/html",controller:"core/js/controller",element:"core/js/element",tool:"core/js/tool",window:"core/js/window"},waitSeconds:0,baseUrl:"./",urlArgs:"r="+(new Date).getTime(),shim:{controller:{deps:["JTopo"]},element:{deps:["JTopo"]},tool:{deps:["JTopo","bootstrap"]},window:{deps:["bootstrap"]}},map:{"*":{css:"resource/js/require/plugins/css.min",text:"resource/js/require/plugins/text"}}}),require(["element/Scene","controller/action","JTopo"],function(t,e){if("undefined"==typeof jQuery)throw new Error("topo_base's JavaScript requires jQuery");$(document).ready(function(){var n=document.getElementById("topo_base");n.setAttribute("width",$(window).width()),n.setAttribute("height",$(window).height()),$(window).resize(function(){n.setAttribute("width",$(window).width()),n.setAttribute("height",$(window).height())}),$.ajax({url:"topo.config",success:function(i){i=JSON.parse(i);var o=new JTopo.Stage(n),r=new t;r.prop.config=i,i.background?r.background=i.background:console.info("not config background"),o.add(r),e.addSceneListener(r),e.loadTopo(o,r)},error:function(t){console.error("need topo.config")}})})}),define("core/topo",function(){});