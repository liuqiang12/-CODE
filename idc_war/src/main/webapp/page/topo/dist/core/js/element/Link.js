define(["tool/util","JTopo"],function(t){function o(){this.visible=!0}function e(){this.visible=!1}function n(t,o){this.prop.num=t,o&&(this.prop.name=o,this.text=o),t>0?this.text="(+"+t+")":this.text=this.prop.name||""}function r(o){this.strokeColor=t.transHex(o.toLowerCase()),this.prop.color=o}function i(t){t?this.alpha=parseInt(t):this.alpha=.1}function s(t){"child"==this.prop.linkType?(this.prop.father.show(),$.each(this.prop.father.prop.children,function(o,e){t.removeElement(e)}),this.prop.father.prop.children=[]):this.prop.num>1&&(this.prop.children=a(this,this.prop.num,t),this.hide())}function a(t,o,e){for(var n,r=[],i=0;i<o;i++)n=new JTopo.Link(t.nodeA,t.nodeZ),h(n,{},"child"),n.prop.father=t,r.push(n),e.addElement(n);return r}function h(o,e,n){var r=e.num||0,i=e.name||"",s=e.id||"",a=e.pid||"",h=e.eweight||1e3,p=e.color||"22,124,255",l=e.arrowSize||null,u=e.arrowOffset||0,d=e.text||(r>0?"(+"+r+")":""),c=e.width||3,f=e.dashedPattern?parseInt(e.dashedPattern):null,x=e.fontSize||16,y=e.font||"微软雅黑",w=e.useType||"normal";o.text=d||i,o.lineWidth=c,o.arrowsRadius=l,o.arrowsOffset=u,o.bundleGap=20,o.textOffsetY=3,o.strokeColor=t.transHex(p.toLowerCase()),o.dashedPattern=f,o.zIndex=100,o.font=x+"px "+y,o.prop={id:s,pid:a,num:r,name:i,color:p,eweight:h,linkType:n,useType:w,sourceArrow:e.sourceArrow||!1,targetArrow:e.targetArrow||!1},o.exprop={}}return $.each(["Link","FoldLink","FlexionalLink","CurveLink"],function(t,a){JTopo[a].prototype.setNum=n,JTopo[a].prototype.setColor=r,JTopo[a].prototype.setAlpha=i,JTopo[a].prototype.show=o,JTopo[a].prototype.hide=e,JTopo[a].prototype.toggleExpend=s}),{directLink:function(t){var o=t||{},e=o.bundleOffset||60,n=new JTopo.Link(t.start,t.end),r=o.linkType||"direct";return h(n,o,r),n.bundleOffset=parseInt(e),n.getStartPosition=function(){var t;return null!=this.arrowsRadius&&(t=function(t){var o=t.nodeA,e=t.nodeZ,n=JTopo.util.lineF(o.cx,o.cy,e.cx,e.cy),r=o.getBound();return f=JTopo.util.intersectionLineBound(n,r)}(this)),null==t&&(t={x:this.nodeA.cx,y:this.nodeA.cy}),t},n.paintPath=function(t,o){if(this.nodeA===this.nodeZ)return void this.paintLoop(t);t.beginPath(),t.moveTo(o[0].x,o[0].y);for(var e=1;e<o.length;e++)null==this.dashedPattern?null==this.PointPathColor?t.lineTo(o[e].x,o[e].y):t.JtopoDrawPointPath(o[e-1].x,o[e-1].y,o[e].x,o[e].y,t.strokeStyle,this.PointPathColor):t.JTopoDashedLineTo(o[e-1].x,o[e-1].y,o[e].x,o[e].y,this.dashedPattern);t.stroke(),t.closePath(),null!=this.arrowsRadius&&(this.prop.targetArrow&&this.paintArrow(t,o[0],o[o.length-1]),this.prop.sourceArrow&&this.paintArrow(t,o[o.length-1],o[0]))},n},foldLink:function(t){var o=t||{},e=new JTopo.FoldLink(t.start,t.end),n=o.linkType||"fold";return h(e,t,n),e.direction=o.direction||"horizontal",e.paintPath=function(t,o){if(this.nodeA===this.nodeZ)return void this.paintLoop(t);t.beginPath(),t.moveTo(o[0].x,o[0].y);for(var e=1;e<o.length;e++)null==this.dashedPattern?t.lineTo(o[e].x,o[e].y):t.JTopoDashedLineTo(o[e-1].x,o[e-1].y,o[e].x,o[e].y,this.dashedPattern);t.stroke(),t.closePath(),null!=this.arrowsRadius&&(this.prop.targetArrow&&this.paintArrow(t,o[o.length-2],o[o.length-1]),this.prop.sourceArrow&&this.paintArrow(t,o[1],o[0]))},e},flexionalLink:function(t){var o=t||{},e=o.offsetGap||60,n=new JTopo.FlexionalLink(t.start,t.end),r=o.linkType||"flexional";return h(n,o,r),n.direction=o.direction||"horizontal",n.offsetGap=parseInt(e),n.paintPath=function(t,o){if(this.nodeA===this.nodeZ)return void this.paintLoop(t);t.beginPath(),t.moveTo(o[0].x,o[0].y);for(var e=1;e<o.length;e++)null==this.dashedPattern?t.lineTo(o[e].x,o[e].y):t.JTopoDashedLineTo(o[e-1].x,o[e-1].y,o[e].x,o[e].y,this.dashedPattern);t.stroke(),t.closePath(),null!=this.arrowsRadius&&(this.prop.targetArrow&&this.paintArrow(t,o[o.length-2],o[o.length-1]),this.prop.sourceArrow&&this.paintArrow(t,o[1],o[0]))},n},CurveLink:function(t){var o=t||{},e=new JTopo.CurveLink(t.start,t.end),n=o.linkType||"curve";return h(e,o,n),e.prop.cureOffset=t.cureOffset||200,e.getStartPosition=function(){var t;return t=function(t){var o=t.nodeA,e=t.nodeZ,n=JTopo.util.lineF(o.cx,o.cy,e.cx,e.cy),r=o.getBound();return f=JTopo.util.intersectionLineBound(n,r)}(this)},e.getEndPosition=function(){var t;return t=function(t){var o=t.nodeZ,e=t.nodeA,n=JTopo.util.lineF(o.cx,o.cy,e.cx,e.cy),r=o.getBound();return f=JTopo.util.intersectionLineBound(n,r)}(this)},e.paintPath=function(t,o){if(this.nodeA===this.nodeZ)return void this.paintLoop(t);var e=o[0],n=o[o.length-1];t.beginPath(),t.moveTo(e.x,e.y);var r=Math.atan(Math.abs(n.y-e.y)/Math.abs(n.x-e.x)),i=(e.x+n.x)/2+this.prop.cureOffset*Math.cos(r-Math.PI/2),s=(e.y+n.y)/2+this.prop.cureOffset*Math.sin(r-Math.PI/2);t.strokeStyle="rgba("+this.strokeColor+","+this.alpha+")",t.lineWidth=this.lineWidth,t.moveTo(e.x,e.cy),t.quadraticCurveTo(i,s,n.x,n.y),t.stroke(),t.stroke(),t.closePath(),null!=this.arrowsRadius&&(this.prop.targetArrow&&this.paintArrow(t,e,n),this.prop.sourceArrow&&this.paintArrow(t,n,e))},e}}});
//# sourceMappingURL=Link.js.map