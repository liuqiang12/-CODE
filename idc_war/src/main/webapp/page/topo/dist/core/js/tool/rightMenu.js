define(["tool/util","window/Menu","tool/winHandler","element/Node"],function(util,Menu,winHandler,Node){function filterForMenu(e){var n=[];return e&&$.each(e.menus.menu,function(e,t){"undefined"==typeof t.dblclick&&n.push(t)}),n}function isInclude(e,n){return!(!e||!n)&&("string"!=typeof e&&(e+=""),"string"!=typeof n&&(n+=""),"1"==e.charAt(e.length-n.length))}var STAGE,SCENE,storeElement,copyElement,mytarget,Default={item:{TopoEvent_DEBUG:function(e){return{name:"Debug",icon:"fa fa-info",handler:function(){var n="";element=e.target,element||(element=SCENE),console.info(element),"node"==element.elementType||"container"==element.elementType?n+="<h5>X:&nbsp;"+element.x+"&nbsp;&nbsp;Y:&nbsp;"+element.y+"</h5>":"link"==element.elementType&&"line"!=element.prop.useType?n+="<h4>From:</h4><h5>&nbsp;&nbsp;&nbsp;&nbsp;name:"+element.nodeA.prop.name+"</h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;id:"+element.nodeA.prop.id+"</h5><h4>To:</h4><h5>&nbsp;&nbsp;&nbsp;&nbsp;name:"+element.nodeZ.prop.name+"</h5><h5>&nbsp;&nbsp;&nbsp;&nbsp;id:"+element.nodeZ.prop.id+"</h5>":"scene"==element.elementType&&(n+="<h4>Elements:"+element.childs.length+"</h4>"),n+="<h4>Prop:</h4>",$.each(element.prop,function(e,t){t instanceof Array?(n+="<h5>&nbsp;&nbsp;&nbsp;&nbsp;"+e+":&nbsp;[",$.each(t,function(e,t){n+="&nbsp;"+t}),n+="]</h5>"):t&&t.elementType&&("node"==t.elementType||"container"==t.elementType)?n+="<h5>&nbsp;&nbsp;&nbsp;&nbsp;"+e+":&nbsp;"+(t.prop.name||t)+"</h5>":t&&t instanceof Object&&!t._id?(n+="<h5>&nbsp;&nbsp;&nbsp;&nbsp;"+e+":&nbsp;[",$.each(t,function(e,t){n+="&nbsp;"+e+"&nbsp;:"+t+","}),n+="]</h5>"):n+="<h5>&nbsp;&nbsp;&nbsp;&nbsp;"+e+":&nbsp;"+t+"</h5>"}),winHandler.getTools().alert({title:"Debug",content:n})}}},TopoEvent_REFRESH:function(){return{name:"刷新",icon:"fa fa-refresh fa-spin",handler:function(){SCENE.refresh()},filter:function(e){return!e}}},TopoEvent_SHOWTOOLBAR:function(){return{name:"显示工具栏",icon:"fa fa-gears",handler:function(){winHandler.getToolBar().show()},filter:function(e){return!e&&"none"==winHandler.getToolBar().fatherBar.css("display")}}},TopoEvent_HIDETOOLBAR:function(){return{name:"隐藏工具栏",icon:"fa fa-gears",handler:function(){winHandler.getToolBar().hide()},filter:function(e){return!e&&"none"!=winHandler.getToolBar().fatherBar.css("display")}}},TopoEvent_DELETE:function(e){return{name:"删除对象",icon:"fa fa-trash-o",handler:function(){var n=SCENE.selectedElements;winHandler.getTools().confirm({content:"<h4>尝试删除"+n.length+"个对象？</h4>",width:300,handler:function(t){t&&n.length>1?$.each(n,function(e,n){SCENE.removeElement(n)}):t&&SCENE.removeElement(e.target)}})},filter:function(e){return e&&!("container"==e.elementType||"node"==e.elementType&&"container"==e.prop.nodeType)}}},TopoEvent_GO_BACK:function(){return{name:"返回上一层",icon:"fa fa-reply-all",handler:function(){SCENE.goBack()},filter:function(){return SCENE.prop.path.length>1}}},TopoEvent_CUT:function(e){return{name:"剪切单个节点",icon:"glyphicon glyphicon-copyright-mark",handler:function(){storeElement||e.target&&"node"==e.target.elementType&&(storeElement=e.target,storeElement.hide(),util.toggleElemnts(storeElement.inLinks),util.toggleElemnts(storeElement.outLinks))},filter:function(e){return e&&"node"==e.elementType&&"node"==e.prop.nodeType&&!storeElement}}},TopoEvent_CANCAL_CUT:function(){return{name:"取消剪切",icon:"fa fa-close",handler:function(){storeElement&&(storeElement.show(),util.toggleElemnts(storeElement.inLinks),util.toggleElemnts(storeElement.outLinks),storeElement="")},filter:function(){return storeElement&&!storeElement.visible}}},TopoEvent_PASTE:function(e){return{name:"黏贴剪切",icon:"fa fa-paypal",handler:function(){storeElement&&(storeElement.show(),SCENE.childs.indexOf(storeElement)>0?(util.toggleElemnts(storeElement.inLinks),util.toggleElemnts(storeElement.outLinks)):SCENE.addElement(storeElement),storeElement.setLocation(e.x,e.y),storeElement="")},filter:function(){return storeElement&&!storeElement.visible}}},TopoEvent_COPY:function(e){return{name:"复制单个对象",icon:"glyphicon glyphicon-copyright-mark",handler:function(n){var t=e.target;t&&"node"==t.elementType&&"node"==t.prop.nodeType&&(copyElement=Node.createNode({textPosition:t.textPosition,text:t.text,zIndex:t.zIndex,alpha:t.alpha,image:t.prop.image,width:t.width,height:t.height}),$.each(t.prop,function(e,n){copyElement.prop[e]=n}),$.each(t.exprop,function(e,n){copyElement.exprop[e]=n}))},filter:function(e){return e&&"node"==e.elementType&&"node"==e.prop.nodeType}}},TopoEvent_PASTE_COPY:function(e){return{name:"黏贴复制",icon:"fa fa-paypal",handler:function(n){copyElement&&(copyElement.setLocation(e.x,e.y),SCENE.addElement(copyElement),copyElement="")},filter:function(e){return copyElement&&copyElement.visible}}},TopoEvent_SELECT_ALL:function(){return{name:"全选",icon:"fa fa-filter",handler:function(){$.each(SCENE.childs,function(e,n){"node"==n.elementType&&"node"==n.prop.nodeType&&(n.selected=!0,SCENE.selectedElements.push(n))})},filter:function(e){return!e&&SCENE.getAweight()>0}}},TopoEvent_SELECT_UNSELECTED:function(){return{name:"反选",icon:"fa fa-close",handler:function(){$.each(SCENE.childs,function(e,n){"node"==n.elementType&&"node"==n.prop.nodeType&&(n.selected=!1)})},filter:function(e){return!e&&SCENE.getAweight()>0}}},TopoEvent_MODIFY_NODE:function(e){return{name:"编辑节点",icon:"fa fa-cog fa-spin",handler:function(){winHandler.editImage(e.target)},filter:function(e){return e&&"node"==e.elementType&&"node"==e.prop.nodeType}}},TopoEvent_MODIFY_TEXT:function(e){return{name:"编辑文本",icon:"fa fa-cog fa-spin",handler:function(){winHandler.editText(e.target)},filter:function(e){return e&&"TextNode"==e.elementType}}},TopoEvent_MODIFY_LINK:function(e){return{name:"编辑链路",icon:"fa fa-cog fa-spin",handler:function(){winHandler.editLink(e.target)},filter:function(e){return e&&"link"==e.elementType&&"line"!=e.prop.linkType&&"child"!=e.prop.linkType}}},TopoEvent_ELEMENT_VISIABLE_FALSE:function(e){return{name:"链路设为隐藏",icon:"glyphicon glyphicon-eye-close",handler:function(){e.target.hide()},filter:function(e){return e&&"link"==e.elementType}}},TopoEvent_ELEMENT_VISIABLE_TRUE:function(e){return{name:"显示全部",icon:"glyphicon glyphicon-eye-open",handler:function(){$.each(SCENE.childs,function(e,n){return"node"==n.elementType&&"container"==n.prop.nodeType||void(n.show&&n.show())})}}},TopoEvent_HIGHTLIGHT_CONNECT:function(e){return{name:"高亮相关网元",icon:"glyphicon glyphicon-eye-open",handler:function(){var n=e.target,t=[];t.push(n),$.each(SCENE.childs,function(e,n){"node"!=n.elementType&&"link"!=n.elementType||n.setAlpha()}),$.each(n.inLinks,function(e,n){util.arrayPush(t,n),util.arrayPush(t,n.nodeA),util.arrayPush(t,n.nodeZ)}),$.each(n.outLinks,function(e,n){util.arrayPush(t,n),util.arrayPush(t,n.nodeA),util.arrayPush(t,n.nodeZ)}),$.each(t,function(e,n){n.setAlpha(1)})},filter:function(e){return e&&"node"==e.elementType&&"container"!=e.prop.nodeType}}},TopoEvent_HIGHTLIGHT_CANCEL:function(e){return{name:"取消高亮",icon:"glyphicon glyphicon-eye-close",handler:function(){$.each(SCENE.childs,function(e,n){"node"!=n.elementType&&"link"!=n.elementType||n.setAlpha(1)})},filter:function(e){return e&&"node"==e.elementType&&"container"!=e.prop.nodeType}}},TopoEvent_OPENWINDOW:function(){return{name:"查看图层信息",icon:"glyphicon glyphicon-folder-open",handler:function(){SCENE.prop.url&&window.open(SCENE.prop.url,"_blank")},filter:function(e){return!e}}},TopoEvent_CREATE_GROUP:function(e){return{name:"创建分组",icon:"fa fa-plus",handler:function(){var n=SCENE.selectedElements;e.target&&winHandler.getTools().confirm({content:"<h4>将尝试为"+n.length+"个对象创建分组？</h4>",width:300,handler:function(e){e&&winHandler.createContainer(n)}})},filter:function(e){return e&&"node"==e.elementType&&!e.prop.container&&"container"!=e.prop.nodeType}}},TopoEvent_MODIFY_GROUP:function(e){return{name:"编辑分组",icon:"fa fa-cog fa-spin",handler:function(){var n=e.target;"container"==n.elementType?winHandler.editContainer(n):(console.info(),winHandler.editContainer(n.prop.expandTo))},filter:function(e){return e&&("container"==e.elementType||"node"==e.elementType&&"container"==e.prop.nodeType)}}},TopoEvent_REMOVE_FROM_GROUP:function(e){return{name:"从组中删除",icon:"fa fa-minus",handler:function(){e.target.prop.container.removeNode(e.target)},filter:function(e){return e&&e.prop.container}}},TopoEvent_DELETE_GROUP:function(e){return{name:"解散分组",icon:"fa fa-trash-o",handler:function(){var n;n="node"==e.target.elementType&&"container"==e.target.prop.nodeType?e.target.prop.expandTo:e.target,n.prop.setMember={showName:!0,showLink:!0},n.toggleExpand(),SCENE.removeElement(n)},filter:function(e){return e&&("container"==e.elementType||"node"==e.elementType&&"container"==e.prop.nodeType)}}},TopoEvent_CONFIG_PROPERTY:function(e){return{name:"配置业务属性",icon:"fa fa-cog fa-spin",handler:function(){e.target?winHandler.editExprop(e.target):winHandler.editExprop(SCENE)}}}},subItem:{}},rightMenu;return{init:function(e,n,t){if(STAGE=e,SCENE=n,rightMenu=new Menu("topo_rightMenu"),rightMenu.setTrigger(SCENE),$.each(Default.item,function(e,n){rightMenu.addItem(n(rightMenu))}),t){var o=filterForMenu(t),r=rightMenu.addSubMenu({name:"(参考)",divide:!0});$.each(o,function(e,n){r.addItem({name:n.name,handler:function(){console.info(n.action)},filter:function(e){return e||(e=SCENE),isInclude(n.aweight,SCENE.getAweight())&&isInclude(n.eweight,e.prop.eweight)}})})}},addUrlMenu:function(json){$.each(json,function(k,v){var level_Two=rightMenu.addSubMenu({name:k,filter:function(e){return e||(e=SCENE),!v.filter||eval("(function () {return "+v.filter+"})()")(e)}});$.each(v.item,function(i,m){level_Two.addItem({name:m.name,icon:"glyphicon glyphicon-folder-open",handler:function(){var param="";$.each(m.data,function(j,d){if(param+=j>0?"&":"?",param+=d.key+"=",d.fixed)d.value?param+=d.value:d.fn&&(param+=eval("(function () {return "+d.fn+"})()")());else if(d.fn)try{param+=eval("(function () {return "+d.fn+"})()")(rightMenu.target.prop[d.value])}catch(e){console.info(e),console.info("url menu run fn error")}else param+=rightMenu.target.prop[d.value]}),m.url?(window.open(m.url+param,"_blank"),console.info(m.url+param)):m.path&&(window.open("http://"+window.location.host+m.path+param,"_blank"),console.info("http://"+window.location.host+m.path+param))},filter:function(e){return e||(e=SCENE),!m.filter||eval("(function () {return "+m.filter+"})()")(e)}})})})}}});
//# sourceMappingURL=rightMenu.js.map