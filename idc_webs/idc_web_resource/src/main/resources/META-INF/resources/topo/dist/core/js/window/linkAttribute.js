define(["text!template/linkAttribute.html","window/base","element/Link"],function(e,n,i){var t=$(e),a=t.find("[name=topo_link_attribute]").hide(),o=t.find("[name=topo_line_attribute]").hide();return $("body").append(t),{initLink:function(e){function t(e){switch(a.target=e,a.mode="edit",c.val(e.prop.name||""),s.val(e.prop.num||0),u.val(e.prop.linkType),u.trigger("change"),p.val(e.strokeColor),v.val(e.lineWidth),"normal"!=e.prop.useType&&"line"!=e.prop.useType&&(u.attr("disabled",!0),c.attr("disabled",!0)),e.prop.linkType){case"direct":w.val(e.bundleOffset||0);break;case"fold":_.val(e.direction);break;case"flexional":_.val(e.direction),w.val(e.offsetGap);break;case"curve":y.val(e.prop.cureOffset)}e.arrowsRadius&&e.arrowsRadius>0&&(e.prop.sourceArrow&&x.click(),e.prop.targetArrow&&L.click(),N.val(e.arrowsRadius),A.val(e.arrowsOffset)),e.dashedPattern&&(O.click(),S.val(e.dashedPattern)),o.find("span:first").html("编辑链路"),a.show()}a.css(n.defaultPosition);var o=a.find("[name=head]"),r=a.find("[name=ok]"),d=a.find("[name=cancel]"),c=a.find("[name=name]"),l=a.find("[name=name_group]"),s=a.find("[name=number_num]"),f=a.find("[name=number_group]"),u=a.find("[name=style]"),h=a.find("[name=style_group]"),p=a.find("[name=selected_color]"),m=a.find("[name=color_group]"),v=a.find("[name=width_num]"),k=a.find("[name=width_group]"),w=a.find("[name=gap_num]"),g=a.find("[name=gap_group]"),_=a.find("[name=direction]"),b=a.find("[name=direction_group]"),z=a.find("[name=cureOffset_group]"),y=a.find("[name=cureOffset_num]"),L=a.find("[name=arrow_check_target]"),x=a.find("[name=arrow_check_source]"),O=a.find("[name=dashed_check]"),N=(a.find("[name=check_group]"),a.find("[name=arrow_size_num]")),T=a.find("[name=arrow_size_group]"),A=a.find("[name=arrow_offset_num]"),P=a.find("[name=arrow_offset_group]"),S=a.find("[name=dashed_size_num]"),E=a.find("[name=dashed_size_group]"),I=[l,f,h,m,k,T,P,E,g,b,z],W=[c,s,u,p,v,N,A,S,w,_,y];return n.resetHide(W,I),n.colorSelect(p,a.find("[name=color_palette]")),n.resizeNum(k,{bottom:1}),n.resizeNum(T,{step:5,bottom:0}),n.resizeNum(P,{step:5}),n.resizeNum(E,{step:5,bottom:1}),n.resizeNum(g,{step:5,bottom:0}),n.resizeNum(z,{step:50}),n.resizeNum(f,{step:1,bottom:0}),n.moveable(o,a),a.find(".close").click(function(){d.click()}),_.hide(),N.hide(),A.hide(),S.hide(),L.click(function(e){x[0].checked||(N.toggle(this.checked),A.toggle(this.checked))}),x.click(function(e){L[0].checked||(N.toggle(this.checked),A.toggle(this.checked))}),O.click(function(e){S.toggle(this.checked)}),u.change(function(){switch(this.value){case"direct":_.hide(),w.show(),y.hide();break;case"fold":_.show(),w.hide(),y.hide();break;case"flexional":_.show(),w.show(),y.hide();break;case"curve":_.hide(),w.hide(),y.show()}}),a.on("resetWindow",function(e){e&&$.isFunction(e)&&e(),c.val(""),c.attr("disabled",!1),s.val(0),p.val(""),u.val("direct"),u.attr("disabled",!1),w.val(60),_.val("horizontal"),L.attr("checked",!1),x.attr("checked",!1),O.attr("checked",!1),N.val(10).hide(),A.val(0).hide(),S.val(6).hide(),y.val(200).hide(),a.hide(),a.css(n.defaultPosition)}),r.click(function(){if("edit"==a.mode){var n=a.target,t=n,o={name:c.val().trim(),num:s.val(),color:p.val(),width:parseInt(v.val()),arrowSize:parseInt(N.val()),arrowOffset:parseInt(A.val()),dashedPattern:O[0].checked?parseInt(S.val()):null,sourceArrow:x[0].checked,targetArrow:L[0].checked,cureOffset:y.val()};if(n.prop.linkType==u.val()){switch(n.setNum(o.num,o.name),n.setColor(o.color),n.lineWidth=o.width,n.prop.sourceArrow=o.sourceArrow,n.prop.targetArrow=o.targetArrow,u.val()){case"direct":n.bundleOffset=parseInt(w.val());break;case"fold":n.direction=_.val();break;case"flexional":n.direction=_.val(),n.offsetGap=parseInt(w.val());break;case"curve":n.prop.cureOffset=y.val()}x[0].checked||L[0].checked?(n.arrowsRadius=o.arrowSize,n.arrowsOffset=o.arrowOffset):n.arrowsRadius=null,O[0].checked?n.dashedPattern=o.dashedPattern:n.dashedPattern=null}else{switch(o.start=n.nodeA,o.end=n.nodeZ,u.val()){case"direct":o.bundleOffset=parseInt(w.val()),t=i.directLink(o);break;case"fold":o.direction=_.val(),t=i.foldLink(o);break;case"flexional":o.direction=_.val(),o.offsetGap=parseInt(w.val()),t=i.flexionalLink(o);break;case"curve":t=i.CurveLink(o)}t.prop.id=n.prop.id,t.prop.pid=n.prop.pid,t.prop.eweight=n.prop.eweight,t.exprop=n.exprop,e.removeElement(n),e.addElement(t)}a.trigger("resetWindow")}}),d.click(function(){a.trigger("resetWindow")}),{win:a,okBtn:r,cancelBtn:d,name:c,style:u,color:p,width:v,gapSize:w,direction:_,arrowCheck_target:L,arrowCheck_source:x,arrowSize:N,arrowOffset:A,dashedCheck:O,dashedSize:S,edit:t}},initLine:function(e){function t(){e.removeElement(w),w="",b=!0}o.css(n.defaultPosition);var a=o.find("[name=head]"),r=o.find(".ok"),d=o.find(".close"),c=o.find(".cancel_before"),l=o.find(".cancel_all"),s=o.find(".name"),f=o.find(".name_group"),u=o.find(".selected_color"),h=o.find(".color_group"),p=o.find("[name=width_num]"),m=o.find(".width_group"),v=[f,h,m],k=[s,u,p];n.resetHide(k,v),n.moveable(a,o),n.colorSelect(u,o.find(".color_palette")),n.resizeNum(m,{bottom:1});var w,g,_=[],b=!0,z=!1;return o.on("drawLine",function(e){z=!0,e&&$.isFunction(e)&&e(),o.show()}),e.click(function(n){z&&0==n.button&&(b?(_=[],w=(new JTopo.Node).setLocation(n.x,n.y),w.setSize(1,1),g=(new JTopo.Node).setLocation(n.x,n.y),g.setSize(1,1),e.addElement(i.directLink({start:g,end:w,name:s.val(),color:u.val(),width:p.val(),useType:"line"})),_.push(g),b=!1):(g=w,w=(new JTopo.Node).setLocation(n.x,n.y),w.setSize(1,1),g.setLocation(n.x,n.y),e.addElement(i.directLink({start:g,end:w,name:s.val(),color:u.val(),width:p.val(),useType:"line"})),_.push(g)))}),e.dbclick(function(e){t(),_.length>0&&(_.splice(_.length-1,1),1==_.length&&_.splice(_.length-1,1))}),e.mousemove(function(e){z&&0==e.button&&w&&w.setLocation(e.x,e.y)}),o.on("resetWindow",function(e){e&&$.isFunction(e)&&e(),t(),z=!1,s.val(""),u.val(""),p.val(3),o.hide(),o.css(n.defaultPosition)}),r.click(function(){t()}),c.click(function(){_.length>0&&(e.removeElement(_[_.length-1]),_.splice(_.length-1,1),_.length>0?w&&e.addElement(i.directLink({start:_[_.length-1],end:w,name:s.val(),color:u.val(),width:p.val(),useType:"line"})):t())}),l.click(function(){t(),_.length>0&&($.each(_,function(n,i){e.removeElement(i)}),_=[])}),d.click(function(){o.trigger("resetWindow")}),{win:o,name:s,color:u,width:p,head:a,okBtn:r,cancelBtn:d}}}});
//# sourceMappingURL=linkAttribute.js.map